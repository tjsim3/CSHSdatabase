!(function(e, t) {
    'object' == typeof exports && 'undefined' != typeof module
        ? t(require('@firebase/app'))
        : 'function' == typeof define && define.amd
        ? define(['@firebase/app'], t)
        : t((e = 'undefined' != typeof globalThis ? globalThis : e || self).firebase);
})(this, function(Us) {
    'use strict';
    try {
        (function() {
            var e,
                t = (e = Us) && 'object' == typeof e && 'default' in e ? e : {default: e},
                r = function(e, t) {
                    return (r =
                        Object.setPrototypeOf ||
                        ({__proto__: []} instanceof Array &&
                            function(e, t) {
                                e.__proto__ = t;
                            }) ||
                        function(e, t) {
                            for (var n in t)
                                Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]);
                        })(e, t);
                };
            function n(e, t) {
                if ('function' != typeof t && null !== t)
                    throw new TypeError(
                        'Class extends value ' + String(t) + ' is not a constructor or null'
                    );
                function n() {
                    this.constructor = e;
                }
                r(e, t),
                    (e.prototype =
                        null === t ? Object.create(t) : ((n.prototype = t.prototype), new n()));
            }
            var l = function() {
                return (l =
                    Object.assign ||
                    function(e) {
                        for (var t, n = 1, r = arguments.length; n < r; n++)
                            for (var i in (t = arguments[n]))
                                Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]);
                        return e;
                    }).apply(this, arguments);
            };
            function i(e, s, a, u) {
                return new (a = a || Promise)(function(n, t) {
                    function r(e) {
                        try {
                            o(u.next(e));
                        } catch (e) {
                            t(e);
                        }
                    }
                    function i(e) {
                        try {
                            o(u.throw(e));
                        } catch (e) {
                            t(e);
                        }
                    }
                    function o(e) {
                        var t;
                        e.done
                            ? n(e.value)
                            : ((t = e.value) instanceof a
                                  ? t
                                  : new a(function(e) {
                                        e(t);
                                    })
                              ).then(r, i);
                    }
                    o((u = u.apply(e, s || [])).next());
                });
            }
            function o(n, r) {
                var i,
                    o,
                    s,
                    a = {
                        label: 0,
                        sent: function() {
                            if (1 & s[0]) throw s[1];
                            return s[1];
                        },
                        trys: [],
                        ops: [],
                    },
                    e = {next: t(0), throw: t(1), return: t(2)};
                return (
                    'function' == typeof Symbol &&
                        (e[Symbol.iterator] = function() {
                            return this;
                        }),
                    e
                );
                function t(t) {
                    return function(e) {
                        return (function(t) {
                            if (i) throw new TypeError('Generator is already executing.');
                            for (; a; )
                                try {
                                    if (
                                        ((i = 1),
                                        o &&
                                            (s =
                                                2 & t[0]
                                                    ? o.return
                                                    : t[0]
                                                    ? o.throw || ((s = o.return) && s.call(o), 0)
                                                    : o.next) &&
                                            !(s = s.call(o, t[1])).done)
                                    )
                                        return s;
                                    switch (((o = 0), (t = s ? [2 & t[0], s.value] : t)[0])) {
                                        case 0:
                                        case 1:
                                            s = t;
                                            break;
                                        case 4:
                                            return a.label++, {value: t[1], done: !1};
                                        case 5:
                                            a.label++, (o = t[1]), (t = [0]);
                                            continue;
                                        case 7:
                                            (t = a.ops.pop()), a.trys.pop();
                                            continue;
                                        default:
                                            if (
                                                !(s = 0 < (s = a.trys).length && s[s.length - 1]) &&
                                                (6 === t[0] || 2 === t[0])
                                            ) {
                                                a = 0;
                                                continue;
                                            }
                                            if (
                                                3 === t[0] &&
                                                (!s || (t[1] > s[0] && t[1] < s[3]))
                                            ) {
                                                a.label = t[1];
                                                break;
                                            }
                                            if (6 === t[0] && a.label < s[1]) {
                                                (a.label = s[1]), (s = t);
                                                break;
                                            }
                                            if (s && a.label < s[2]) {
                                                (a.label = s[2]), a.ops.push(t);
                                                break;
                                            }
                                            s[2] && a.ops.pop(), a.trys.pop();
                                            continue;
                                    }
                                    t = r.call(n, a);
                                } catch (e) {
                                    (t = [6, e]), (o = 0);
                                } finally {
                                    i = s = 0;
                                }
                            if (5 & t[0]) throw t[1];
                            return {value: t[0] ? t[1] : void 0, done: !0};
                        })([t, e]);
                    };
                }
            }
            function _(e) {
                var t = 'function' == typeof Symbol && Symbol.iterator,
                    n = t && e[t],
                    r = 0;
                if (n) return n.call(e);
                if (e && 'number' == typeof e.length)
                    return {
                        next: function() {
                            return {
                                value: (e = e && r >= e.length ? void 0 : e) && e[r++],
                                done: !e,
                            };
                        },
                    };
                throw new TypeError(
                    t ? 'Object is not iterable.' : 'Symbol.iterator is not defined.'
                );
            }
            function y(e, t) {
                var n = 'function' == typeof Symbol && e[Symbol.iterator];
                if (!n) return e;
                var r,
                    i,
                    o = n.call(e),
                    s = [];
                try {
                    for (; (void 0 === t || 0 < t--) && !(r = o.next()).done; ) s.push(r.value);
                } catch (e) {
                    i = {error: e};
                } finally {
                    try {
                        r && !r.done && (n = o.return) && n.call(o);
                    } finally {
                        if (i) throw i.error;
                    }
                }
                return s;
            }
            function s(e, t) {
                for (var n = 0, r = t.length, i = e.length; n < r; n++, i++) e[i] = t[n];
                return e;
            }
            function a(e) {
                for (var t = [], n = 0, r = 0; r < e.length; r++) {
                    var i = e.charCodeAt(r);
                    i < 128
                        ? (t[n++] = i)
                        : (i < 2048
                              ? (t[n++] = (i >> 6) | 192)
                              : (55296 == (64512 & i) &&
                                r + 1 < e.length &&
                                56320 == (64512 & e.charCodeAt(r + 1))
                                    ? ((i =
                                          65536 + ((1023 & i) << 10) + (1023 & e.charCodeAt(++r))),
                                      (t[n++] = (i >> 18) | 240),
                                      (t[n++] = ((i >> 12) & 63) | 128))
                                    : (t[n++] = (i >> 12) | 224),
                                (t[n++] = ((i >> 6) & 63) | 128)),
                          (t[n++] = (63 & i) | 128));
                }
                return t;
            }
            function u(e) {
                try {
                    return c.decodeString(e, !0);
                } catch (e) {
                    console.error('base64Decode failed: ', e);
                }
                return null;
            }
            var h = {NODE_CLIENT: !1, NODE_ADMIN: !1, SDK_VERSION: '${JSCORE_VERSION}'},
                g = function(e, t) {
                    if (!e) throw m(t);
                },
                m = function(e) {
                    return new Error(
                        'Firebase Database (' + h.SDK_VERSION + ') INTERNAL ASSERT FAILED: ' + e
                    );
                },
                c = {
                    byteToCharMap_: null,
                    charToByteMap_: null,
                    byteToCharMapWebSafe_: null,
                    charToByteMapWebSafe_: null,
                    ENCODED_VALS_BASE:
                        'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',
                    get ENCODED_VALS() {
                        return this.ENCODED_VALS_BASE + '+/=';
                    },
                    get ENCODED_VALS_WEBSAFE() {
                        return this.ENCODED_VALS_BASE + '-_.';
                    },
                    HAS_NATIVE_SUPPORT: 'function' == typeof atob,
                    encodeByteArray: function(e, t) {
                        if (!Array.isArray(e))
                            throw Error('encodeByteArray takes an array as a parameter');
                        this.init_();
                        for (
                            var n = t ? this.byteToCharMapWebSafe_ : this.byteToCharMap_,
                                r = [],
                                i = 0;
                            i < e.length;
                            i += 3
                        ) {
                            var o = e[i],
                                s = i + 1 < e.length,
                                a = s ? e[i + 1] : 0,
                                u = i + 2 < e.length,
                                l = o >> 2,
                                o = ((3 & o) << 4) | (a >> 4),
                                a = ((15 & a) << 2) | ((h = u ? e[i + 2] : 0) >> 6),
                                h = 63 & h;
                            u || ((h = 64), s || (a = 64)), r.push(n[l], n[o], n[a], n[h]);
                        }
                        return r.join('');
                    },
                    encodeString: function(e, t) {
                        return this.HAS_NATIVE_SUPPORT && !t
                            ? btoa(e)
                            : this.encodeByteArray(a(e), t);
                    },
                    decodeString: function(e, t) {
                        return this.HAS_NATIVE_SUPPORT && !t
                            ? atob(e)
                            : (function(e) {
                                  for (var t = [], n = 0, r = 0; n < e.length; ) {
                                      var i,
                                          o,
                                          s,
                                          a = e[n++];
                                      a < 128
                                          ? (t[r++] = String.fromCharCode(a))
                                          : 191 < a && a < 224
                                          ? ((o = e[n++]),
                                            (t[r++] = String.fromCharCode(
                                                ((31 & a) << 6) | (63 & o)
                                            )))
                                          : 239 < a && a < 365
                                          ? ((i =
                                                (((7 & a) << 18) |
                                                    ((63 & (o = e[n++])) << 12) |
                                                    ((63 & (s = e[n++])) << 6) |
                                                    (63 & e[n++])) -
                                                65536),
                                            (t[r++] = String.fromCharCode(55296 + (i >> 10))),
                                            (t[r++] = String.fromCharCode(56320 + (1023 & i))))
                                          : ((o = e[n++]),
                                            (s = e[n++]),
                                            (t[r++] = String.fromCharCode(
                                                ((15 & a) << 12) | ((63 & o) << 6) | (63 & s)
                                            )));
                                  }
                                  return t.join('');
                              })(this.decodeStringToByteArray(e, t));
                    },
                    decodeStringToByteArray: function(e, t) {
                        this.init_();
                        for (
                            var n = t ? this.charToByteMapWebSafe_ : this.charToByteMap_,
                                r = [],
                                i = 0;
                            i < e.length;

                        ) {
                            var o = n[e.charAt(i++)],
                                s = i < e.length ? n[e.charAt(i)] : 0,
                                a = ++i < e.length ? n[e.charAt(i)] : 64,
                                u = ++i < e.length ? n[e.charAt(i)] : 64;
                            if ((++i, null == o || null == s || null == a || null == u))
                                throw Error();
                            (o = (o << 2) | (s >> 4)),
                                r.push(o),
                                64 !== a &&
                                    ((s = ((s << 4) & 240) | (a >> 2)),
                                    r.push(s),
                                    64 !== u && ((u |= (a << 6) & 192), r.push(u)));
                        }
                        return r;
                    },
                    init_: function() {
                        if (!this.byteToCharMap_) {
                            (this.byteToCharMap_ = {}),
                                (this.charToByteMap_ = {}),
                                (this.byteToCharMapWebSafe_ = {}),
                                (this.charToByteMapWebSafe_ = {});
                            for (var e = 0; e < this.ENCODED_VALS.length; e++)
                                (this.byteToCharMap_[e] = this.ENCODED_VALS.charAt(e)),
                                    (this.charToByteMap_[this.byteToCharMap_[e]] = e),
                                    (this.byteToCharMapWebSafe_[
                                        e
                                    ] = this.ENCODED_VALS_WEBSAFE.charAt(e)),
                                    (this.charToByteMapWebSafe_[
                                        this.byteToCharMapWebSafe_[e]
                                    ] = e) >= this.ENCODED_VALS_BASE.length &&
                                        ((this.charToByteMap_[
                                            this.ENCODED_VALS_WEBSAFE.charAt(e)
                                        ] = e),
                                        (this.charToByteMapWebSafe_[
                                            this.ENCODED_VALS.charAt(e)
                                        ] = e));
                        }
                    },
                };
            var d =
                ((p.prototype.wrapCallback = function(n) {
                    var r = this;
                    return function(e, t) {
                        e ? r.reject(e) : r.resolve(t),
                            'function' == typeof n &&
                                (r.promise.catch(function() {}), 1 === n.length ? n(e) : n(e, t));
                    };
                }),
                p);
            function p() {
                var n = this;
                (this.reject = function() {}),
                    (this.resolve = function() {}),
                    (this.promise = new Promise(function(e, t) {
                        (n.resolve = e), (n.reject = t);
                    }));
            }
            function f() {
                return (
                    'undefined' != typeof window &&
                    (window.cordova || window.phonegap || window.PhoneGap) &&
                    /ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(
                        'undefined' != typeof navigator && 'string' == typeof navigator.userAgent
                            ? navigator.userAgent
                            : ''
                    )
                );
            }
            function v() {
                return !0 === h.NODE_ADMIN;
            }
            var w,
                C = 'FirebaseError',
                b = (n(E, (w = Error)), E);
            function E(e, t, n) {
                return (
                    ((t = w.call(this, t) || this).code = e),
                    (t.customData = n),
                    (t.name = C),
                    Object.setPrototypeOf(t, E.prototype),
                    Error.captureStackTrace && Error.captureStackTrace(t, S.prototype.create),
                    t
                );
            }
            var S =
                ((T.prototype.create = function(e) {
                    for (var t = [], n = 1; n < arguments.length; n++) t[n - 1] = arguments[n];
                    var r,
                        i = t[0] || {},
                        o = this.service + '/' + e,
                        e = (e = this.errors[e])
                            ? ((r = i),
                              e.replace(I, function(e, t) {
                                  var n = r[t];
                                  return null != n ? String(n) : '<' + t + '?>';
                              }))
                            : 'Error',
                        e = this.serviceName + ': ' + e + ' (' + o + ').';
                    return new b(o, e, i);
                }),
                T);
            function T(e, t, n) {
                (this.service = e), (this.serviceName = t), (this.errors = n);
            }
            var I = /\{\$([^}]+)}/g;
            function P(e) {
                return JSON.parse(e);
            }
            function N(e) {
                return JSON.stringify(e);
            }
            function R(e) {
                var t = {},
                    n = {},
                    r = {},
                    i = '';
                try {
                    var o = e.split('.'),
                        t = P(u(o[0]) || ''),
                        n = P(u(o[1]) || ''),
                        i = o[2],
                        r = n.d || {};
                    delete n.d;
                } catch (e) {}
                return {header: t, claims: n, data: r, signature: i};
            }
            function x(e, t) {
                return Object.prototype.hasOwnProperty.call(e, t);
            }
            function k(e, t) {
                if (Object.prototype.hasOwnProperty.call(e, t)) return e[t];
            }
            function D(e) {
                for (var t in e) if (Object.prototype.hasOwnProperty.call(e, t)) return !1;
                return !0;
            }
            function O(e, t, n) {
                var r,
                    i = {};
                for (r in e)
                    Object.prototype.hasOwnProperty.call(e, r) && (i[r] = t.call(n, e[r], r, e));
                return i;
            }
            var A =
                ((L.prototype.reset = function() {
                    (this.chain_[0] = 1732584193),
                        (this.chain_[1] = 4023233417),
                        (this.chain_[2] = 2562383102),
                        (this.chain_[3] = 271733878),
                        (this.chain_[4] = 3285377520),
                        (this.inbuf_ = 0),
                        (this.total_ = 0);
                }),
                (L.prototype.compress_ = function(e, t) {
                    t = t || 0;
                    var n = this.W_;
                    if ('string' == typeof e)
                        for (var r = 0; r < 16; r++)
                            (n[r] =
                                (e.charCodeAt(t) << 24) |
                                (e.charCodeAt(t + 1) << 16) |
                                (e.charCodeAt(t + 2) << 8) |
                                e.charCodeAt(t + 3)),
                                (t += 4);
                    else
                        for (r = 0; r < 16; r++)
                            (n[r] = (e[t] << 24) | (e[t + 1] << 16) | (e[t + 2] << 8) | e[t + 3]),
                                (t += 4);
                    for (r = 16; r < 80; r++) {
                        var i = n[r - 3] ^ n[r - 8] ^ n[r - 14] ^ n[r - 16];
                        n[r] = 4294967295 & ((i << 1) | (i >>> 31));
                    }
                    for (
                        var o,
                            s = this.chain_[0],
                            a = this.chain_[1],
                            u = this.chain_[2],
                            l = this.chain_[3],
                            h = this.chain_[4],
                            r = 0;
                        r < 80;
                        r++
                    )
                        var c =
                                r < 40
                                    ? r < 20
                                        ? ((o = l ^ (a & (u ^ l))), 1518500249)
                                        : ((o = a ^ u ^ l), 1859775393)
                                    : r < 60
                                    ? ((o = (a & u) | (l & (a | u))), 2400959708)
                                    : ((o = a ^ u ^ l), 3395469782),
                            i = (((s << 5) | (s >>> 27)) + o + h + c + n[r]) & 4294967295,
                            h = l,
                            l = u,
                            u = 4294967295 & ((a << 30) | (a >>> 2)),
                            a = s,
                            s = i;
                    (this.chain_[0] = (this.chain_[0] + s) & 4294967295),
                        (this.chain_[1] = (this.chain_[1] + a) & 4294967295),
                        (this.chain_[2] = (this.chain_[2] + u) & 4294967295),
                        (this.chain_[3] = (this.chain_[3] + l) & 4294967295),
                        (this.chain_[4] = (this.chain_[4] + h) & 4294967295);
                }),
                (L.prototype.update = function(e, t) {
                    if (null != e) {
                        for (
                            var n = (t = void 0 === t ? e.length : t) - this.blockSize,
                                r = 0,
                                i = this.buf_,
                                o = this.inbuf_;
                            r < t;

                        ) {
                            if (0 === o)
                                for (; r <= n; ) this.compress_(e, r), (r += this.blockSize);
                            if ('string' == typeof e) {
                                for (; r < t; )
                                    if (((i[o] = e.charCodeAt(r)), ++r, ++o === this.blockSize)) {
                                        this.compress_(i), (o = 0);
                                        break;
                                    }
                            } else
                                for (; r < t; )
                                    if (((i[o] = e[r]), ++r, ++o === this.blockSize)) {
                                        this.compress_(i), (o = 0);
                                        break;
                                    }
                        }
                        (this.inbuf_ = o), (this.total_ += t);
                    }
                }),
                (L.prototype.digest = function() {
                    var e = [],
                        t = 8 * this.total_;
                    this.inbuf_ < 56
                        ? this.update(this.pad_, 56 - this.inbuf_)
                        : this.update(this.pad_, this.blockSize - (this.inbuf_ - 56));
                    for (var n = this.blockSize - 1; 56 <= n; n--)
                        (this.buf_[n] = 255 & t), (t /= 256);
                    this.compress_(this.buf_);
                    for (var r = 0, n = 0; n < 5; n++)
                        for (var i = 24; 0 <= i; i -= 8) (e[r] = (this.chain_[n] >> i) & 255), ++r;
                    return e;
                }),
                L);
            function L() {
                (this.chain_ = []),
                    (this.buf_ = []),
                    (this.W_ = []),
                    (this.pad_ = []),
                    (this.inbuf_ = 0),
                    (this.total_ = 0),
                    (this.blockSize = 64),
                    (this.pad_[0] = 128);
                for (var e = 1; e < this.blockSize; ++e) this.pad_[e] = 0;
                this.reset();
            }
            function M(e, t, n, r) {
                var i;
                if (
                    (r < t
                        ? (i = 'at least ' + t)
                        : n < r && (i = 0 === n ? 'none' : 'no more than ' + n),
                    i)
                )
                    throw new Error(
                        e +
                            ' failed: Was called with ' +
                            r +
                            (1 === r ? ' argument.' : ' arguments.') +
                            ' Expects ' +
                            i +
                            '.'
                    );
            }
            function F(e, t, n) {
                var r = '';
                switch (t) {
                    case 1:
                        r = n ? 'first' : 'First';
                        break;
                    case 2:
                        r = n ? 'second' : 'Second';
                        break;
                    case 3:
                        r = n ? 'third' : 'Third';
                        break;
                    case 4:
                        r = n ? 'fourth' : 'Fourth';
                        break;
                    default:
                        throw new Error(
                            'errorPrefix called with argumentNumber > 4.  Need to update it?'
                        );
                }
                return (e += ' failed: ') + (r + ' argument ');
            }
            function q(e, t, n, r) {
                if ((!r || n) && 'function' != typeof n)
                    throw new Error(F(e, t, r) + 'must be a valid function.');
            }
            function W(e, t, n, r) {
                if ((!r || n) && ('object' != typeof n || null === n))
                    throw new Error(F(e, t, r) + 'must be a valid context object.');
            }
            function Q(e) {
                for (var t = 0, n = 0; n < e.length; n++) {
                    var r = e.charCodeAt(n);
                    r < 128
                        ? t++
                        : r < 2048
                        ? (t += 2)
                        : 55296 <= r && r <= 56319
                        ? ((t += 4), n++)
                        : (t += 3);
                }
                return t;
            }
            var j =
                ((U.prototype.setInstantiationMode = function(e) {
                    return (this.instantiationMode = e), this;
                }),
                (U.prototype.setMultipleInstances = function(e) {
                    return (this.multipleInstances = e), this;
                }),
                (U.prototype.setServiceProps = function(e) {
                    return (this.serviceProps = e), this;
                }),
                U);
            function U(e, t, n) {
                (this.name = e),
                    (this.instanceFactory = t),
                    (this.type = n),
                    (this.multipleInstances = !1),
                    (this.serviceProps = {}),
                    (this.instantiationMode = 'LAZY');
            }
            var B = '[DEFAULT]',
                H =
                    ((V.prototype.get = function(e) {
                        void 0 === e && (e = B);
                        var t = this.normalizeInstanceIdentifier(e);
                        if (!this.instancesDeferred.has(t)) {
                            var n = new d();
                            this.instancesDeferred.set(t, n);
                            try {
                                var r = this.getOrInitializeService({instanceIdentifier: t});
                                r && n.resolve(r);
                            } catch (e) {}
                        }
                        return this.instancesDeferred.get(t).promise;
                    }),
                    (V.prototype.getImmediate = function(e) {
                        var t = l({identifier: B, optional: !1}, e),
                            e = t.identifier,
                            n = t.optional,
                            r = this.normalizeInstanceIdentifier(e);
                        try {
                            var i = this.getOrInitializeService({instanceIdentifier: r});
                            if (i) return i;
                            if (n) return null;
                            throw Error('Service ' + this.name + ' is not available');
                        } catch (e) {
                            if (n) return null;
                            throw e;
                        }
                    }),
                    (V.prototype.getComponent = function() {
                        return this.component;
                    }),
                    (V.prototype.setComponent = function(e) {
                        var t, n;
                        if (e.name !== this.name)
                            throw Error(
                                'Mismatching Component ' +
                                    e.name +
                                    ' for Provider ' +
                                    this.name +
                                    '.'
                            );
                        if (this.component)
                            throw Error(
                                'Component for ' + this.name + ' has already been provided'
                            );
                        if ('EAGER' === (this.component = e).instantiationMode)
                            try {
                                this.getOrInitializeService({instanceIdentifier: B});
                            } catch (e) {}
                        try {
                            for (
                                var r = _(this.instancesDeferred.entries()), i = r.next();
                                !i.done;
                                i = r.next()
                            ) {
                                var o = y(i.value, 2),
                                    s = o[0],
                                    a = o[1],
                                    u = this.normalizeInstanceIdentifier(s);
                                try {
                                    var l = this.getOrInitializeService({instanceIdentifier: u});
                                    a.resolve(l);
                                } catch (e) {}
                            }
                        } catch (e) {
                            t = {error: e};
                        } finally {
                            try {
                                i && !i.done && (n = r.return) && n.call(r);
                            } finally {
                                if (t) throw t.error;
                            }
                        }
                    }),
                    (V.prototype.clearInstance = function(e) {
                        void 0 === e && (e = B),
                            this.instancesDeferred.delete(e),
                            this.instances.delete(e);
                    }),
                    (V.prototype.delete = function() {
                        return i(this, void 0, void 0, function() {
                            var t;
                            return o(this, function(e) {
                                switch (e.label) {
                                    case 0:
                                        return (
                                            (t = Array.from(this.instances.values())),
                                            [
                                                4,
                                                Promise.all(
                                                    s(
                                                        s(
                                                            [],
                                                            y(
                                                                t
                                                                    .filter(function(e) {
                                                                        return 'INTERNAL' in e;
                                                                    })
                                                                    .map(function(e) {
                                                                        return e.INTERNAL.delete();
                                                                    })
                                                            )
                                                        ),
                                                        y(
                                                            t
                                                                .filter(function(e) {
                                                                    return '_delete' in e;
                                                                })
                                                                .map(function(e) {
                                                                    return e._delete();
                                                                })
                                                        )
                                                    )
                                                ),
                                            ]
                                        );
                                    case 1:
                                        return e.sent(), [2];
                                }
                            });
                        });
                    }),
                    (V.prototype.isComponentSet = function() {
                        return null != this.component;
                    }),
                    (V.prototype.isInitialized = function(e) {
                        return void 0 === e && (e = B), this.instances.has(e);
                    }),
                    (V.prototype.initialize = function(e) {
                        var t =
                                void 0 === (t = (e = void 0 === e ? {} : e).instanceIdentifier)
                                    ? B
                                    : t,
                            e = void 0 === (e = e.options) ? {} : e,
                            t = this.normalizeInstanceIdentifier(t);
                        if (this.isInitialized(t))
                            throw Error(this.name + '(' + t + ') has already been initialized');
                        if (!this.isComponentSet())
                            throw Error('Component ' + this.name + ' has not been registered yet');
                        return this.getOrInitializeService({instanceIdentifier: t, options: e});
                    }),
                    (V.prototype.getOrInitializeService = function(e) {
                        var t = e.instanceIdentifier,
                            n = e.options,
                            r = void 0 === n ? {} : n;
                        return (
                            !(e = this.instances.get(t)) &&
                                this.component &&
                                ((e = this.component.instanceFactory(this.container, {
                                    instanceIdentifier: (n = t) === B ? void 0 : n,
                                    options: r,
                                })),
                                this.instances.set(t, e)),
                            e || null
                        );
                    }),
                    (V.prototype.normalizeInstanceIdentifier = function(e) {
                        return !this.component || this.component.multipleInstances ? e : B;
                    }),
                    V);
            function V(e, t) {
                (this.name = e),
                    (this.container = t),
                    (this.component = null),
                    (this.instances = new Map()),
                    (this.instancesDeferred = new Map());
            }
            var z,
                K =
                    ((Y.prototype.addComponent = function(e) {
                        var t = this.getProvider(e.name);
                        if (t.isComponentSet())
                            throw new Error(
                                'Component ' +
                                    e.name +
                                    ' has already been registered with ' +
                                    this.name
                            );
                        t.setComponent(e);
                    }),
                    (Y.prototype.addOrOverwriteComponent = function(e) {
                        this.getProvider(e.name).isComponentSet() && this.providers.delete(e.name),
                            this.addComponent(e);
                    }),
                    (Y.prototype.getProvider = function(e) {
                        if (this.providers.has(e)) return this.providers.get(e);
                        var t = new H(e, this);
                        return this.providers.set(e, t), t;
                    }),
                    (Y.prototype.getProviders = function() {
                        return Array.from(this.providers.values());
                    }),
                    Y);
            function Y(e) {
                (this.name = e), (this.providers = new Map());
            }
            function G(e, t) {
                for (var n = [], r = 2; r < arguments.length; r++) n[r - 2] = arguments[r];
                if (!(t < e.logLevel)) {
                    var i = new Date().toISOString(),
                        o = X[t];
                    if (!o)
                        throw new Error(
                            'Attempted to log a message with an invalid logType (value: ' + t + ')'
                        );
                    console[o].apply(console, s(['[' + i + ']  ' + e.name + ':'], n));
                }
            }
            ((_t = z = {})[(_t.DEBUG = 0)] = 'DEBUG'),
                (_t[(_t.VERBOSE = 1)] = 'VERBOSE'),
                (_t[(_t.INFO = 2)] = 'INFO'),
                (_t[(_t.WARN = 3)] = 'WARN'),
                (_t[(_t.ERROR = 4)] = 'ERROR'),
                (_t[(_t.SILENT = 5)] = 'SILENT');
            var $ = {
                    debug: z.DEBUG,
                    verbose: z.VERBOSE,
                    info: z.INFO,
                    warn: z.WARN,
                    error: z.ERROR,
                    silent: z.SILENT,
                },
                J = z.INFO,
                X =
                    (((vt = {})[z.DEBUG] = 'log'),
                    (vt[z.VERBOSE] = 'log'),
                    (vt[z.INFO] = 'info'),
                    (vt[z.WARN] = 'warn'),
                    (vt[z.ERROR] = 'error'),
                    vt),
                Z =
                    (Object.defineProperty(ee.prototype, 'logLevel', {
                        get: function() {
                            return this._logLevel;
                        },
                        set: function(e) {
                            if (!(e in z))
                                throw new TypeError(
                                    'Invalid value "' + e + '" assigned to `logLevel`'
                                );
                            this._logLevel = e;
                        },
                        enumerable: !1,
                        configurable: !0,
                    }),
                    (ee.prototype.setLogLevel = function(e) {
                        this._logLevel = 'string' == typeof e ? $[e] : e;
                    }),
                    Object.defineProperty(ee.prototype, 'logHandler', {
                        get: function() {
                            return this._logHandler;
                        },
                        set: function(e) {
                            if ('function' != typeof e)
                                throw new TypeError(
                                    'Value assigned to `logHandler` must be a function'
                                );
                            this._logHandler = e;
                        },
                        enumerable: !1,
                        configurable: !0,
                    }),
                    Object.defineProperty(ee.prototype, 'userLogHandler', {
                        get: function() {
                            return this._userLogHandler;
                        },
                        set: function(e) {
                            this._userLogHandler = e;
                        },
                        enumerable: !1,
                        configurable: !0,
                    }),
                    (ee.prototype.debug = function() {
                        for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
                        this._userLogHandler &&
                            this._userLogHandler.apply(this, s([this, z.DEBUG], e)),
                            this._logHandler.apply(this, s([this, z.DEBUG], e));
                    }),
                    (ee.prototype.log = function() {
                        for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
                        this._userLogHandler &&
                            this._userLogHandler.apply(this, s([this, z.VERBOSE], e)),
                            this._logHandler.apply(this, s([this, z.VERBOSE], e));
                    }),
                    (ee.prototype.info = function() {
                        for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
                        this._userLogHandler &&
                            this._userLogHandler.apply(this, s([this, z.INFO], e)),
                            this._logHandler.apply(this, s([this, z.INFO], e));
                    }),
                    (ee.prototype.warn = function() {
                        for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
                        this._userLogHandler &&
                            this._userLogHandler.apply(this, s([this, z.WARN], e)),
                            this._logHandler.apply(this, s([this, z.WARN], e));
                    }),
                    (ee.prototype.error = function() {
                        for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
                        this._userLogHandler &&
                            this._userLogHandler.apply(this, s([this, z.ERROR], e)),
                            this._logHandler.apply(this, s([this, z.ERROR], e));
                    }),
                    ee);
            function ee(e) {
                (this.name = e),
                    (this._logLevel = J),
                    (this._logHandler = G),
                    (this._userLogHandler = null);
            }
            var te =
                ((ne.prototype.set = function(e, t) {
                    null == t
                        ? this.domStorage_.removeItem(this.prefixedName_(e))
                        : this.domStorage_.setItem(this.prefixedName_(e), N(t));
                }),
                (ne.prototype.get = function(e) {
                    return null == (e = this.domStorage_.getItem(this.prefixedName_(e)))
                        ? null
                        : P(e);
                }),
                (ne.prototype.remove = function(e) {
                    this.domStorage_.removeItem(this.prefixedName_(e));
                }),
                (ne.prototype.prefixedName_ = function(e) {
                    return this.prefix_ + e;
                }),
                (ne.prototype.toString = function() {
                    return this.domStorage_.toString();
                }),
                ne);
            function ne(e) {
                (this.domStorage_ = e), (this.prefix_ = 'firebase:');
            }
            var re =
                ((ie.prototype.set = function(e, t) {
                    null == t ? delete this.cache_[e] : (this.cache_[e] = t);
                }),
                (ie.prototype.get = function(e) {
                    return x(this.cache_, e) ? this.cache_[e] : null;
                }),
                (ie.prototype.remove = function(e) {
                    delete this.cache_[e];
                }),
                ie);
            function ie() {
                (this.cache_ = {}), (this.isInMemoryStorage = !0);
            }
            function oe(e) {
                var t = (function(e) {
                    for (var t = [], n = 0, r = 0; r < e.length; r++) {
                        var i,
                            o = e.charCodeAt(r);
                        55296 <= o &&
                            o <= 56319 &&
                            ((i = o - 55296),
                            g(++r < e.length, 'Surrogate pair missing trail surrogate.'),
                            (o = 65536 + (i << 10) + (e.charCodeAt(r) - 56320))),
                            o < 128
                                ? (t[n++] = o)
                                : (o < 2048
                                      ? (t[n++] = (o >> 6) | 192)
                                      : (o < 65536
                                            ? (t[n++] = (o >> 12) | 224)
                                            : ((t[n++] = (o >> 18) | 240),
                                              (t[n++] = ((o >> 12) & 63) | 128)),
                                        (t[n++] = ((o >> 6) & 63) | 128)),
                                  (t[n++] = (63 & o) | 128));
                    }
                    return t;
                })(e);
                return (e = new A()).update(t), (e = e.digest()), c.encodeByteArray(e);
            }
            function se(e, t) {
                g(!t || !0 === e || !1 === e, "Can't turn on custom loggers persistently."),
                    !0 === e
                        ? ((ye.logLevel = z.VERBOSE),
                          (me = ye.log.bind(ye)),
                          t && _e.set('logging_enabled', !0))
                        : 'function' == typeof e
                        ? (me = e)
                        : ((me = null), _e.remove('logging_enabled'));
            }
            function ae() {
                for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
                var n = 'FIREBASE INTERNAL ERROR: ' + ge.apply(void 0, s([], y(e)));
                ye.error(n);
            }
            function ue(e) {
                return (
                    'number' == typeof e &&
                    (e != e || e === Number.POSITIVE_INFINITY || e === Number.NEGATIVE_INFINITY)
                );
            }
            function le(e, t) {
                return e === t ? 0 : e < t ? -1 : 1;
            }
            function he(e, t) {
                if (t && e in t) return t[e];
                throw new Error('Missing required key (' + e + ') in object: ' + N(t));
            }
            function ce(e, t) {
                var n = e.length;
                if (n <= t) return [e];
                for (var r = [], i = 0; i < n; i += t)
                    n < i + t ? r.push(e.substring(i, n)) : r.push(e.substring(i, i + t));
                return r;
            }
            function de() {
                for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
                var n = 'FIREBASE FATAL ERROR: ' + ge.apply(void 0, s([], y(e)));
                throw (ye.error(n), new Error(n));
            }
            var pe,
                fe = (Xt = function(e) {
                    try {
                        if ('undefined' != typeof window && void 0 !== window[e]) {
                            var t = window[e];
                            return (
                                t.setItem('firebase:sentinel', 'cache'),
                                t.removeItem('firebase:sentinel'),
                                new te(t)
                            );
                        }
                    } catch (e) {}
                    return new re();
                })('localStorage'),
                _e = Xt('sessionStorage'),
                ye = new Z('@firebase/database'),
                ve =
                    ((pe = 1),
                    function() {
                        return pe++;
                    }),
                ge = function() {
                    for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
                    for (var n = '', r = 0; r < e.length; r++) {
                        var i = e[r];
                        Array.isArray(i) ||
                        (i && 'object' == typeof i && 'number' == typeof i.length)
                            ? (n += ge.apply(null, i))
                            : (n += 'object' == typeof i ? N(i) : i),
                            (n += ' ');
                    }
                    return n;
                },
                me = null,
                we = !0,
                Ce = function() {
                    for (var e, t = [], n = 0; n < arguments.length; n++) t[n] = arguments[n];
                    !0 === we &&
                        ((we = !1), null === me && !0 === _e.get('logging_enabled') && se(!0)),
                        me && ((e = ge.apply(null, t)), me(e));
                },
                be = function(n) {
                    return function() {
                        for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
                        Ce.apply(void 0, s([n], y(e)));
                    };
                },
                Ee = function() {
                    for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
                    var n = 'FIREBASE WARNING: ' + ge.apply(void 0, s([], y(e)));
                    ye.warn(n);
                },
                Se = '[MIN_NAME]',
                Te = '[MAX_NAME]',
                Ie = function(e, t) {
                    if (e === t) return 0;
                    if (e === Se || t === Te) return -1;
                    if (t === Se || e === Te) return 1;
                    var n = Le(e),
                        r = Le(t);
                    return null !== n
                        ? null !== r
                            ? n - r == 0
                                ? e.length - t.length
                                : n - r
                            : -1
                        : null === r && e < t
                        ? -1
                        : 1;
                },
                Pe = function(e) {
                    if ('object' != typeof e || null === e) return N(e);
                    var t,
                        n = [];
                    for (t in e) n.push(t);
                    n.sort();
                    for (var r = '{', i = 0; i < n.length; i++)
                        0 !== i && (r += ','), (r += N(n[i])), (r += ':'), (r += Pe(e[n[i]]));
                    return r + '}';
                };
            function Ne(e, t) {
                for (var n in e) e.hasOwnProperty(n) && t(n, e[n]);
            }
            function Re(e) {
                var t, n, r, i;
                g(!ue(e), 'Invalid JSON number'),
                    0 === e
                        ? (t = 1 / e == -1 / (r = n = 0) ? 1 : 0)
                        : ((t = e < 0),
                          (r =
                              (e = Math.abs(e)) >= Math.pow(2, -1022)
                                  ? ((n =
                                        (i = Math.min(Math.floor(Math.log(e) / Math.LN2), 1023)) +
                                        1023),
                                    Math.round(e * Math.pow(2, 52 - i) - Math.pow(2, 52)))
                                  : ((n = 0), Math.round(e / Math.pow(2, -1074)))));
                for (var o = [], s = 52; s; --s) o.push(r % 2 ? 1 : 0), (r = Math.floor(r / 2));
                for (s = 11; s; --s) o.push(n % 2 ? 1 : 0), (n = Math.floor(n / 2));
                o.push(t ? 1 : 0), o.reverse();
                for (var a = o.join(''), u = '', s = 0; s < 64; s += 8) {
                    var l = parseInt(a.substr(s, 8), 2).toString(16);
                    u += l = 1 === l.length ? '0' + l : l;
                }
                return u.toLowerCase();
            }
            function xe(e, t) {
                return 'object' == typeof (t = setTimeout(e, t)) && t.unref && t.unref(), t;
            }
            var ke = function(e, t) {
                    var n = 'Unknown Error';
                    return (
                        'too_big' === e
                            ? (n =
                                  'The data requested exceeds the maximum size that can be accessed with a single request.')
                            : 'permission_denied' === e
                            ? (n = "Client doesn't have permission to access the desired data.")
                            : 'unavailable' === e && (n = 'The service is unavailable'),
                        ((n = new Error(
                            e + ' at ' + t.path.toString() + ': ' + n
                        )).code = e.toUpperCase()),
                        n
                    );
                },
                De = new RegExp('^-?(0*)\\d{1,10}$'),
                Oe = -2147483648,
                Ae = 2147483647,
                Le = function(e) {
                    return De.test(e) && ((e = Number(e)), Oe <= e && e <= Ae) ? e : null;
                },
                Me = function(e) {
                    try {
                        e();
                    } catch (t) {
                        setTimeout(function() {
                            var e = t.stack || '';
                            throw (Ee('Exception was thrown by user callback.', e), t);
                        }, Math.floor(0));
                    }
                },
                Fe =
                    ((qe.prototype.getToken = function(e) {
                        return this.auth_
                            ? this.auth_.getToken(e).catch(function(e) {
                                  return e && 'auth/token-not-initialized' === e.code
                                      ? (Ce(
                                            'Got auth/token-not-initialized error.  Treating as null token.'
                                        ),
                                        null)
                                      : Promise.reject(e);
                              })
                            : Promise.resolve(null);
                    }),
                    (qe.prototype.addTokenChangeListener = function(t) {
                        this.auth_
                            ? this.auth_.addAuthTokenListener(t)
                            : (setTimeout(function() {
                                  return t(null);
                              }, 0),
                              this.authProvider_.get().then(function(e) {
                                  return e.addAuthTokenListener(t);
                              }));
                    }),
                    (qe.prototype.removeTokenChangeListener = function(t) {
                        this.authProvider_.get().then(function(e) {
                            return e.removeAuthTokenListener(t);
                        });
                    }),
                    (qe.prototype.notifyForInvalidToken = function() {
                        var e =
                            'Provided authentication credentials for the app named "' +
                            this.app_.name +
                            '" are invalid. This usually indicates your app was not initialized correctly. ';
                        'credential' in this.app_.options
                            ? (e +=
                                  'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.')
                            : 'serviceAccount' in this.app_.options
                            ? (e +=
                                  'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.')
                            : (e +=
                                  'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.'),
                            Ee(e);
                    }),
                    qe);
            function qe(e, t) {
                var n = this;
                (this.app_ = e),
                    (this.authProvider_ = t),
                    (this.auth_ = null),
                    (this.auth_ = t.getImmediate({optional: !0})),
                    this.auth_ ||
                        t.get().then(function(e) {
                            return (n.auth_ = e);
                        });
            }
            var We =
                ((Qe.prototype.getToken = function(e) {
                    return Promise.resolve({accessToken: Qe.EMULATOR_AUTH_TOKEN});
                }),
                (Qe.prototype.addTokenChangeListener = function(e) {
                    e(Qe.EMULATOR_AUTH_TOKEN);
                }),
                (Qe.prototype.removeTokenChangeListener = function(e) {}),
                (Qe.prototype.notifyForInvalidToken = function() {}),
                (Qe.EMULATOR_AUTH_TOKEN = 'owner'),
                Qe);
            function Qe() {}
            var je = /(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,
                Ue = 'websocket',
                Be = 'long_polling',
                He =
                    ((Ve.prototype.isCacheableHost = function() {
                        return 's-' === this.internalHost.substr(0, 2);
                    }),
                    (Ve.prototype.isCustomHost = function() {
                        return (
                            'firebaseio.com' !== this._domain &&
                            'firebaseio-demo.com' !== this._domain
                        );
                    }),
                    Object.defineProperty(Ve.prototype, 'host', {
                        get: function() {
                            return this._host;
                        },
                        set: function(e) {
                            e !== this.internalHost &&
                                ((this.internalHost = e),
                                this.isCacheableHost() &&
                                    fe.set('host:' + this._host, this.internalHost));
                        },
                        enumerable: !1,
                        configurable: !0,
                    }),
                    (Ve.prototype.toString = function() {
                        var e = this.toURLString();
                        return this.persistenceKey && (e += '<' + this.persistenceKey + '>'), e;
                    }),
                    (Ve.prototype.toURLString = function() {
                        var e = this.secure ? 'https://' : 'http://',
                            t = this.includeNamespaceInQueryParams ? '?ns=' + this.namespace : '';
                        return e + this.host + '/' + t;
                    }),
                    Ve);
            function Ve(e, t, n, r, i, o, s) {
                void 0 === i && (i = !1),
                    void 0 === o && (o = ''),
                    void 0 === s && (s = !1),
                    (this.secure = t),
                    (this.namespace = n),
                    (this.webSocketOnly = r),
                    (this.nodeAdmin = i),
                    (this.persistenceKey = o),
                    (this.includeNamespaceInQueryParams = s),
                    (this._host = e.toLowerCase()),
                    (this._domain = this._host.substr(this._host.indexOf('.') + 1)),
                    (this.internalHost = fe.get('host:' + e) || this._host);
            }
            function ze(e, t, n) {
                var r;
                if (
                    (g('string' == typeof t, 'typeof type must == string'),
                    g('object' == typeof n, 'typeof params must == object'),
                    t === Ue)
                )
                    r = (e.secure ? 'wss://' : 'ws://') + e.internalHost + '/.ws?';
                else {
                    if (t !== Be) throw new Error('Unknown connection type: ' + t);
                    r = (e.secure ? 'https://' : 'http://') + e.internalHost + '/.lp?';
                }
                ((t = e).host !== t.internalHost ||
                    t.isCustomHost() ||
                    t.includeNamespaceInQueryParams) &&
                    (n.ns = e.namespace);
                var i = [];
                return (
                    Ne(n, function(e, t) {
                        i.push(e + '=' + t);
                    }),
                    r + i.join('&')
                );
            }
            var Ke =
                ((Ye.prototype.incrementCounter = function(e, t) {
                    void 0 === t && (t = 1),
                        x(this.counters_, e) || (this.counters_[e] = 0),
                        (this.counters_[e] += t);
                }),
                (Ye.prototype.get = function() {
                    return (function e(t, n) {
                        if (!(n instanceof Object)) return n;
                        switch (n.constructor) {
                            case Date:
                                return new Date(n.getTime());
                            case Object:
                                void 0 === t && (t = {});
                                break;
                            case Array:
                                t = [];
                                break;
                            default:
                                return n;
                        }
                        for (var r in n)
                            n.hasOwnProperty(r) && '__proto__' !== r && (t[r] = e(t[r], n[r]));
                        return t;
                    })(void 0, this.counters_);
                }),
                Ye);
            function Ye() {
                this.counters_ = {};
            }
            var Ge = {},
                $e = {};
            function Je(e) {
                return (e = e.toString()), Ge[e] || (Ge[e] = new Ke()), Ge[e];
            }
            var Xe =
                ((Ze.prototype.closeAfter = function(e, t) {
                    (this.closeAfterResponse = e),
                        (this.onClose = t),
                        this.closeAfterResponse < this.currentResponseNum &&
                            (this.onClose(), (this.onClose = null));
                }),
                (Ze.prototype.handleResponse = function(e, t) {
                    var n = this;
                    this.pendingResponses[e] = t;
                    for (
                        var r = this;
                        this.pendingResponses[this.currentResponseNum] &&
                        'break' !==
                            (function() {
                                var t = r.pendingResponses[r.currentResponseNum];
                                delete r.pendingResponses[r.currentResponseNum];
                                for (var e = 0; e < t.length; ++e)
                                    !(function(e) {
                                        t[e] &&
                                            Me(function() {
                                                n.onMessage_(t[e]);
                                            });
                                    })(e);
                                if (r.currentResponseNum === r.closeAfterResponse)
                                    return r.onClose && (r.onClose(), (r.onClose = null)), 'break';
                                r.currentResponseNum++;
                            })();

                    );
                }),
                Ze);
            function Ze(e) {
                (this.onMessage_ = e),
                    (this.pendingResponses = []),
                    (this.currentResponseNum = 0),
                    (this.closeAfterResponse = -1),
                    (this.onClose = null);
            }
            var et = 'pLPCommand',
                tt = 'pRTLPCB',
                nt =
                    ((rt.prototype.open = function(e, t) {
                        var n,
                            r,
                            i,
                            s = this;
                        (this.curSegmentNum = 0),
                            (this.onDisconnect_ = t),
                            (this.myPacketOrderer = new Xe(e)),
                            (this.isClosed_ = !1),
                            (this.connectTimeoutTimer_ = setTimeout(function() {
                                s.log_('Timed out trying to connect.'),
                                    s.onClosed_(),
                                    (s.connectTimeoutTimer_ = null);
                            }, Math.floor(3e4))),
                            (n = function() {
                                var e;
                                s.isClosed_ ||
                                    ((s.scriptTagHolder = new it(
                                        function() {
                                            for (var e = [], t = 0; t < arguments.length; t++)
                                                e[t] = arguments[t];
                                            var n = y(e, 5),
                                                r = n[0],
                                                i = n[1],
                                                o = n[2];
                                            if (
                                                (n[3],
                                                n[4],
                                                s.incrementIncomingBytes_(e),
                                                s.scriptTagHolder)
                                            )
                                                if (
                                                    (s.connectTimeoutTimer_ &&
                                                        (clearTimeout(s.connectTimeoutTimer_),
                                                        (s.connectTimeoutTimer_ = null)),
                                                    (s.everConnected_ = !0),
                                                    'start' === r)
                                                )
                                                    (s.id = i), (s.password = o);
                                                else {
                                                    if ('close' !== r)
                                                        throw new Error(
                                                            'Unrecognized command received: ' + r
                                                        );
                                                    i
                                                        ? ((s.scriptTagHolder.sendNewPolls = !1),
                                                          s.myPacketOrderer.closeAfter(
                                                              i,
                                                              function() {
                                                                  s.onClosed_();
                                                              }
                                                          ))
                                                        : s.onClosed_();
                                                }
                                        },
                                        function() {
                                            for (var e = [], t = 0; t < arguments.length; t++)
                                                e[t] = arguments[t];
                                            var n = (r = y(e, 2))[0],
                                                r = r[1];
                                            s.incrementIncomingBytes_(e),
                                                s.myPacketOrderer.handleResponse(n, r);
                                        },
                                        function() {
                                            s.onClosed_();
                                        },
                                        s.urlFn
                                    )),
                                    ((e = {start: 't'}).ser = Math.floor(1e8 * Math.random())),
                                    s.scriptTagHolder.uniqueCallbackIdentifier &&
                                        (e.cb = s.scriptTagHolder.uniqueCallbackIdentifier),
                                    (e.v = '5'),
                                    s.transportSessionId && (e.s = s.transportSessionId),
                                    s.lastSessionId && (e.ls = s.lastSessionId),
                                    s.applicationId && (e.p = s.applicationId),
                                    'undefined' != typeof location &&
                                        location.hostname &&
                                        je.test(location.hostname) &&
                                        (e.r = 'f'),
                                    (e = s.urlFn(e)),
                                    s.log_('Connecting via long-poll to ' + e),
                                    s.scriptTagHolder.addTag(e, function() {}));
                            }),
                            'complete' === document.readyState
                                ? n()
                                : ((r = !1),
                                  (i = function() {
                                      document.body
                                          ? r || ((r = !0), n())
                                          : setTimeout(i, Math.floor(10));
                                  }),
                                  document.addEventListener
                                      ? (document.addEventListener('DOMContentLoaded', i, !1),
                                        window.addEventListener('load', i, !1))
                                      : document.attachEvent &&
                                        (document.attachEvent('onreadystatechange', function() {
                                            'complete' === document.readyState && i();
                                        }),
                                        window.attachEvent('onload', i)));
                    }),
                    (rt.prototype.start = function() {
                        this.scriptTagHolder.startLongPoll(this.id, this.password),
                            this.addDisconnectPingFrame(this.id, this.password);
                    }),
                    (rt.forceAllow = function() {
                        rt.forceAllow_ = !0;
                    }),
                    (rt.forceDisallow = function() {
                        rt.forceDisallow_ = !0;
                    }),
                    (rt.isAvailable = function() {
                        return (
                            !!rt.forceAllow_ ||
                            !(
                                rt.forceDisallow_ ||
                                'undefined' == typeof document ||
                                null == document.createElement ||
                                ('object' == typeof window &&
                                    window.chrome &&
                                    window.chrome.extension &&
                                    !/^chrome/.test(window.location.href)) ||
                                ('object' == typeof Windows && 'object' == typeof Windows.UI)
                            )
                        );
                    }),
                    (rt.prototype.markConnectionHealthy = function() {}),
                    (rt.prototype.shutdown_ = function() {
                        (this.isClosed_ = !0),
                            this.scriptTagHolder &&
                                (this.scriptTagHolder.close(), (this.scriptTagHolder = null)),
                            this.myDisconnFrame &&
                                (document.body.removeChild(this.myDisconnFrame),
                                (this.myDisconnFrame = null)),
                            this.connectTimeoutTimer_ &&
                                (clearTimeout(this.connectTimeoutTimer_),
                                (this.connectTimeoutTimer_ = null));
                    }),
                    (rt.prototype.onClosed_ = function() {
                        this.isClosed_ ||
                            (this.log_('Longpoll is closing itself'),
                            this.shutdown_(),
                            this.onDisconnect_ &&
                                (this.onDisconnect_(this.everConnected_),
                                (this.onDisconnect_ = null)));
                    }),
                    (rt.prototype.close = function() {
                        this.isClosed_ ||
                            (this.log_('Longpoll is being closed.'), this.shutdown_());
                    }),
                    (rt.prototype.send = function(e) {
                        (e = N(e)),
                            (this.bytesSent += e.length),
                            this.stats_.incrementCounter('bytes_sent', e.length);
                        for (
                            var t,
                                n = ce((e = ((t = a((t = e))), c.encodeByteArray(t, !0))), 1840),
                                r = 0;
                            r < n.length;
                            r++
                        )
                            this.scriptTagHolder.enqueueSegment(this.curSegmentNum, n.length, n[r]),
                                this.curSegmentNum++;
                    }),
                    (rt.prototype.addDisconnectPingFrame = function(e, t) {
                        this.myDisconnFrame = document.createElement('iframe');
                        var n = {dframe: 't'};
                        (n.id = e),
                            (n.pw = t),
                            (this.myDisconnFrame.src = this.urlFn(n)),
                            (this.myDisconnFrame.style.display = 'none'),
                            document.body.appendChild(this.myDisconnFrame);
                    }),
                    (rt.prototype.incrementIncomingBytes_ = function(e) {
                        (e = N(e).length),
                            (this.bytesReceived += e),
                            this.stats_.incrementCounter('bytes_received', e);
                    }),
                    rt);
            function rt(e, t, n, r, i) {
                (this.connId = e),
                    (this.repoInfo = t),
                    (this.applicationId = n),
                    (this.transportSessionId = r),
                    (this.lastSessionId = i),
                    (this.bytesSent = 0),
                    (this.bytesReceived = 0),
                    (this.everConnected_ = !1),
                    (this.log_ = be(e)),
                    (this.stats_ = Je(t)),
                    (this.urlFn = function(e) {
                        return ze(t, Be, e);
                    });
            }
            var it =
                ((ot.createIFrame_ = function() {
                    var t = document.createElement('iframe');
                    if (((t.style.display = 'none'), !document.body))
                        throw 'Document body has not initialized. Wait to initialize Firebase until after the document is ready.';
                    document.body.appendChild(t);
                    try {
                        t.contentWindow.document || Ce('No IE domain setting required');
                    } catch (e) {
                        var n = document.domain;
                        t.src =
                            "javascript:void((function(){document.open();document.domain='" +
                            n +
                            "';document.close();})())";
                    }
                    return (
                        t.contentDocument
                            ? (t.doc = t.contentDocument)
                            : t.contentWindow
                            ? (t.doc = t.contentWindow.document)
                            : t.document && (t.doc = t.document),
                        t
                    );
                }),
                (ot.prototype.close = function() {
                    var e = this;
                    (this.alive = !1),
                        this.myIFrame &&
                            ((this.myIFrame.doc.body.innerHTML = ''),
                            setTimeout(function() {
                                null !== e.myIFrame &&
                                    (document.body.removeChild(e.myIFrame), (e.myIFrame = null));
                            }, Math.floor(0)));
                    var t = this.onDisconnect;
                    t && ((this.onDisconnect = null), t());
                }),
                (ot.prototype.startLongPoll = function(e, t) {
                    for (this.myID = e, this.myPW = t, this.alive = !0; this.newRequest_(); );
                }),
                (ot.prototype.newRequest_ = function() {
                    if (
                        this.alive &&
                        this.sendNewPolls &&
                        this.outstandingRequests.size < (0 < this.pendingSegs.length ? 2 : 1)
                    ) {
                        this.currentSerial++,
                            ((e = {}).id = this.myID),
                            (e.pw = this.myPW),
                            (e.ser = this.currentSerial);
                        for (
                            var e = this.urlFn(e), t = '', n = 0;
                            0 < this.pendingSegs.length &&
                            this.pendingSegs[0].d.length + 30 + t.length <= 1870;

                        ) {
                            var r = this.pendingSegs.shift(),
                                t =
                                    t +
                                    '&seg' +
                                    n +
                                    '=' +
                                    r.seg +
                                    '&ts' +
                                    n +
                                    '=' +
                                    r.ts +
                                    '&d' +
                                    n +
                                    '=' +
                                    r.d;
                            n++;
                        }
                        return (e += t), this.addLongPollTag_(e, this.currentSerial), !0;
                    }
                    return !1;
                }),
                (ot.prototype.enqueueSegment = function(e, t, n) {
                    this.pendingSegs.push({seg: e, ts: t, d: n}), this.alive && this.newRequest_();
                }),
                (ot.prototype.addLongPollTag_ = function(e, t) {
                    var n = this;
                    function r() {
                        n.outstandingRequests.delete(t), n.newRequest_();
                    }
                    this.outstandingRequests.add(t);
                    var i = setTimeout(r, Math.floor(25e3));
                    this.addTag(e, function() {
                        clearTimeout(i), r();
                    });
                }),
                (ot.prototype.addTag = function(e, n) {
                    var r = this;
                    setTimeout(function() {
                        try {
                            if (!r.sendNewPolls) return;
                            var t = r.myIFrame.doc.createElement('script');
                            (t.type = 'text/javascript'),
                                (t.async = !0),
                                (t.src = e),
                                (t.onload = t.onreadystatechange = function() {
                                    var e = t.readyState;
                                    (e && 'loaded' !== e && 'complete' !== e) ||
                                        ((t.onload = t.onreadystatechange = null),
                                        t.parentNode && t.parentNode.removeChild(t),
                                        n());
                                }),
                                (t.onerror = function() {
                                    Ce('Long-poll script failed to load: ' + e),
                                        (r.sendNewPolls = !1),
                                        r.close();
                                }),
                                r.myIFrame.doc.body.appendChild(t);
                        } catch (e) {}
                    }, Math.floor(1));
                }),
                ot);
            function ot(e, t, n, r) {
                (this.onDisconnect = n),
                    (this.urlFn = r),
                    (this.outstandingRequests = new Set()),
                    (this.pendingSegs = []),
                    (this.currentSerial = Math.floor(1e8 * Math.random())),
                    (this.sendNewPolls = !0),
                    (this.uniqueCallbackIdentifier = ve()),
                    (window[et + this.uniqueCallbackIdentifier] = e),
                    (window[tt + this.uniqueCallbackIdentifier] = t),
                    (this.myIFrame = ot.createIFrame_());
                var t = '',
                    i =
                        '<html><body>' +
                        (t =
                            this.myIFrame.src &&
                            'javascript:' === this.myIFrame.src.substr(0, 'javascript:'.length)
                                ? '<script>document.domain="' + document.domain + '";</script>'
                                : t) +
                        '</body></html>';
                try {
                    this.myIFrame.doc.open(), this.myIFrame.doc.write(i), this.myIFrame.doc.close();
                } catch (e) {
                    Ce('frame writing exception'), e.stack && Ce(e.stack), Ce(e);
                }
            }
            var st = '';
            function at(e) {
                st = e;
            }
            var ut = null;
            'undefined' != typeof MozWebSocket
                ? (ut = MozWebSocket)
                : 'undefined' != typeof WebSocket && (ut = WebSocket);
            var lt =
                ((ht.connectionURL_ = function(e, t, n) {
                    var r = {v: '5'};
                    return (
                        'undefined' != typeof location &&
                            location.hostname &&
                            je.test(location.hostname) &&
                            (r.r = 'f'),
                        t && (r.s = t),
                        n && (r.ls = n),
                        ze(e, Ue, r)
                    );
                }),
                (ht.prototype.open = function(e, t) {
                    var n,
                        r = this;
                    (this.onDisconnect = t),
                        (this.onMessage = e),
                        this.log_('Websocket connecting to ' + this.connURL),
                        (this.everConnected_ = !1),
                        fe.set('previous_websocket_failure', !0);
                    try {
                        v() ||
                            ((n = {headers: {'X-Firebase-GMPID': this.applicationId || ''}}),
                            (this.mySock = new ut(this.connURL, [], n)));
                    } catch (t) {
                        return (
                            this.log_('Error instantiating WebSocket.'),
                            (e = t.message || t.data) && this.log_(e),
                            void this.onClosed_()
                        );
                    }
                    (this.mySock.onopen = function() {
                        r.log_('Websocket connected.'), (r.everConnected_ = !0);
                    }),
                        (this.mySock.onclose = function() {
                            r.log_('Websocket connection was disconnected.'),
                                (r.mySock = null),
                                r.onClosed_();
                        }),
                        (this.mySock.onmessage = function(e) {
                            r.handleIncomingFrame(e);
                        }),
                        (this.mySock.onerror = function(e) {
                            r.log_('WebSocket error.  Closing connection.'),
                                (e = e.message || e.data) && r.log_(e),
                                r.onClosed_();
                        });
                }),
                (ht.prototype.start = function() {}),
                (ht.forceDisallow = function() {
                    ht.forceDisallow_ = !0;
                }),
                (ht.isAvailable = function() {
                    var e,
                        t = !1;
                    return (
                        'undefined' != typeof navigator &&
                            navigator.userAgent &&
                            (e = navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/)) &&
                            1 < e.length &&
                            parseFloat(e[1]) < 4.4 &&
                            (t = !0),
                        !t && null !== ut && !ht.forceDisallow_
                    );
                }),
                (ht.previouslyFailed = function() {
                    return fe.isInMemoryStorage || !0 === fe.get('previous_websocket_failure');
                }),
                (ht.prototype.markConnectionHealthy = function() {
                    fe.remove('previous_websocket_failure');
                }),
                (ht.prototype.appendFrame_ = function(e) {
                    this.frames.push(e),
                        this.frames.length === this.totalFrames &&
                            ((e = this.frames.join('')),
                            (this.frames = null),
                            (e = P(e)),
                            this.onMessage(e));
                }),
                (ht.prototype.handleNewFrameCount_ = function(e) {
                    (this.totalFrames = e), (this.frames = []);
                }),
                (ht.prototype.extractFrameCount_ = function(e) {
                    if (
                        (g(null === this.frames, 'We already have a frame buffer'), e.length <= 6)
                    ) {
                        var t = Number(e);
                        if (!isNaN(t)) return this.handleNewFrameCount_(t), null;
                    }
                    return this.handleNewFrameCount_(1), e;
                }),
                (ht.prototype.handleIncomingFrame = function(e) {
                    null !== this.mySock &&
                        ((e = e.data),
                        (this.bytesReceived += e.length),
                        this.stats_.incrementCounter('bytes_received', e.length),
                        this.resetKeepAlive(),
                        (null === this.frames && null === (e = this.extractFrameCount_(e))) ||
                            this.appendFrame_(e));
                }),
                (ht.prototype.send = function(e) {
                    this.resetKeepAlive(),
                        (e = N(e)),
                        (this.bytesSent += e.length),
                        this.stats_.incrementCounter('bytes_sent', e.length);
                    var t = ce(e, 16384);
                    1 < t.length && this.sendString_(String(t.length));
                    for (var n = 0; n < t.length; n++) this.sendString_(t[n]);
                }),
                (ht.prototype.shutdown_ = function() {
                    (this.isClosed_ = !0),
                        this.keepaliveTimer &&
                            (clearInterval(this.keepaliveTimer), (this.keepaliveTimer = null)),
                        this.mySock && (this.mySock.close(), (this.mySock = null));
                }),
                (ht.prototype.onClosed_ = function() {
                    this.isClosed_ ||
                        (this.log_('WebSocket is closing itself'),
                        this.shutdown_(),
                        this.onDisconnect &&
                            (this.onDisconnect(this.everConnected_), (this.onDisconnect = null)));
                }),
                (ht.prototype.close = function() {
                    this.isClosed_ || (this.log_('WebSocket is being closed'), this.shutdown_());
                }),
                (ht.prototype.resetKeepAlive = function() {
                    var e = this;
                    clearInterval(this.keepaliveTimer),
                        (this.keepaliveTimer = setInterval(function() {
                            e.mySock && e.sendString_('0'), e.resetKeepAlive();
                        }, Math.floor(45e3)));
                }),
                (ht.prototype.sendString_ = function(e) {
                    try {
                        this.mySock.send(e);
                    } catch (e) {
                        this.log_(
                            'Exception thrown from WebSocket.send():',
                            e.message || e.data,
                            'Closing connection.'
                        ),
                            setTimeout(this.onClosed_.bind(this), 0);
                    }
                }),
                (ht.responsesRequiredToBeHealthy = 2),
                (ht.healthyTimeout = 3e4),
                ht);
            function ht(e, t, n, r, i) {
                (this.connId = e),
                    (this.applicationId = n),
                    (this.keepaliveTimer = null),
                    (this.frames = null),
                    (this.totalFrames = 0),
                    (this.bytesSent = 0),
                    (this.bytesReceived = 0),
                    (this.log_ = be(this.connId)),
                    (this.stats_ = Je(t)),
                    (this.connURL = ht.connectionURL_(t, r, i)),
                    (this.nodeAdmin = t.nodeAdmin);
            }
            var ct =
                (Object.defineProperty(dt, 'ALL_TRANSPORTS', {
                    get: function() {
                        return [nt, lt];
                    },
                    enumerable: !1,
                    configurable: !0,
                }),
                (dt.prototype.initTransports_ = function(e) {
                    var t,
                        n,
                        r = lt && lt.isAvailable(),
                        i = r && !lt.previouslyFailed();
                    if (
                        (e.webSocketOnly &&
                            (r ||
                                Ee(
                                    "wss:// URL used, but browser isn't known to support websockets.  Trying anyway."
                                ),
                            (i = !0)),
                        i)
                    )
                        this.transports_ = [lt];
                    else {
                        var o = (this.transports_ = []);
                        try {
                            for (
                                var s = _(dt.ALL_TRANSPORTS), a = s.next();
                                !a.done;
                                a = s.next()
                            ) {
                                var u = a.value;
                                u && u.isAvailable() && o.push(u);
                            }
                        } catch (e) {
                            t = {error: e};
                        } finally {
                            try {
                                a && !a.done && (n = s.return) && n.call(s);
                            } finally {
                                if (t) throw t.error;
                            }
                        }
                    }
                }),
                (dt.prototype.initialTransport = function() {
                    if (0 < this.transports_.length) return this.transports_[0];
                    throw new Error('No transports available');
                }),
                (dt.prototype.upgradeTransport = function() {
                    return 1 < this.transports_.length ? this.transports_[1] : null;
                }),
                dt);
            function dt(e) {
                this.initTransports_(e);
            }
            var pt =
                ((ft.prototype.start_ = function() {
                    var e = this,
                        t = this.transportManager_.initialTransport();
                    (this.conn_ = new t(
                        this.nextTransportId_(),
                        this.repoInfo_,
                        this.applicationId_,
                        void 0,
                        this.lastSessionId
                    )),
                        (this.primaryResponsesRequired_ = t.responsesRequiredToBeHealthy || 0);
                    var n = this.connReceiver_(this.conn_),
                        r = this.disconnReceiver_(this.conn_);
                    (this.tx_ = this.conn_),
                        (this.rx_ = this.conn_),
                        (this.secondaryConn_ = null),
                        (this.isHealthy_ = !1),
                        setTimeout(function() {
                            e.conn_ && e.conn_.open(n, r);
                        }, Math.floor(0)),
                        0 < (t = t.healthyTimeout || 0) &&
                            (this.healthyTimeout_ = xe(function() {
                                (e.healthyTimeout_ = null),
                                    e.isHealthy_ ||
                                        (e.conn_ && 102400 < e.conn_.bytesReceived
                                            ? (e.log_(
                                                  'Connection exceeded healthy timeout but has received ' +
                                                      e.conn_.bytesReceived +
                                                      ' bytes.  Marking connection healthy.'
                                              ),
                                              (e.isHealthy_ = !0),
                                              e.conn_.markConnectionHealthy())
                                            : e.conn_ && 10240 < e.conn_.bytesSent
                                            ? e.log_(
                                                  'Connection exceeded healthy timeout but has sent ' +
                                                      e.conn_.bytesSent +
                                                      ' bytes.  Leaving connection alive.'
                                              )
                                            : (e.log_(
                                                  'Closing unhealthy connection after timeout.'
                                              ),
                                              e.close()));
                            }, Math.floor(t)));
                }),
                (ft.prototype.nextTransportId_ = function() {
                    return 'c:' + this.id + ':' + this.connectionCount++;
                }),
                (ft.prototype.disconnReceiver_ = function(t) {
                    var n = this;
                    return function(e) {
                        t === n.conn_
                            ? n.onConnectionLost_(e)
                            : t === n.secondaryConn_
                            ? (n.log_('Secondary connection lost.'), n.onSecondaryConnectionLost_())
                            : n.log_('closing an old connection');
                    };
                }),
                (ft.prototype.connReceiver_ = function(t) {
                    var n = this;
                    return function(e) {
                        2 !== n.state_ &&
                            (t === n.rx_
                                ? n.onPrimaryMessageReceived_(e)
                                : t === n.secondaryConn_
                                ? n.onSecondaryMessageReceived_(e)
                                : n.log_('message on old connection'));
                    };
                }),
                (ft.prototype.sendRequest = function(e) {
                    (e = {t: 'd', d: e}), this.sendData_(e);
                }),
                (ft.prototype.tryCleanupConnection = function() {
                    this.tx_ === this.secondaryConn_ &&
                        this.rx_ === this.secondaryConn_ &&
                        (this.log_(
                            'cleaning up and promoting a connection: ' + this.secondaryConn_.connId
                        ),
                        (this.conn_ = this.secondaryConn_),
                        (this.secondaryConn_ = null));
                }),
                (ft.prototype.onSecondaryControl_ = function(e) {
                    't' in e &&
                        ('a' === (e = e.t)
                            ? this.upgradeIfSecondaryHealthy_()
                            : 'r' === e
                            ? (this.log_('Got a reset on secondary, closing it'),
                              this.secondaryConn_.close(),
                              (this.tx_ !== this.secondaryConn_ &&
                                  this.rx_ !== this.secondaryConn_) ||
                                  this.close())
                            : 'o' === e &&
                              (this.log_('got pong on secondary.'),
                              this.secondaryResponsesRequired_--,
                              this.upgradeIfSecondaryHealthy_()));
                }),
                (ft.prototype.onSecondaryMessageReceived_ = function(e) {
                    var t = he('t', e),
                        e = he('d', e);
                    if ('c' === t) this.onSecondaryControl_(e);
                    else {
                        if ('d' !== t) throw new Error('Unknown protocol layer: ' + t);
                        this.pendingDataMessages.push(e);
                    }
                }),
                (ft.prototype.upgradeIfSecondaryHealthy_ = function() {
                    this.secondaryResponsesRequired_ <= 0
                        ? (this.log_('Secondary connection is healthy.'),
                          (this.isHealthy_ = !0),
                          this.secondaryConn_.markConnectionHealthy(),
                          this.proceedWithUpgrade_())
                        : (this.log_('sending ping on secondary.'),
                          this.secondaryConn_.send({t: 'c', d: {t: 'p', d: {}}}));
                }),
                (ft.prototype.proceedWithUpgrade_ = function() {
                    this.secondaryConn_.start(),
                        this.log_('sending client ack on secondary'),
                        this.secondaryConn_.send({t: 'c', d: {t: 'a', d: {}}}),
                        this.log_('Ending transmission on primary'),
                        this.conn_.send({t: 'c', d: {t: 'n', d: {}}}),
                        (this.tx_ = this.secondaryConn_),
                        this.tryCleanupConnection();
                }),
                (ft.prototype.onPrimaryMessageReceived_ = function(e) {
                    var t = he('t', e),
                        e = he('d', e);
                    'c' === t ? this.onControl_(e) : 'd' === t && this.onDataMessage_(e);
                }),
                (ft.prototype.onDataMessage_ = function(e) {
                    this.onPrimaryResponse_(), this.onMessage_(e);
                }),
                (ft.prototype.onPrimaryResponse_ = function() {
                    this.isHealthy_ ||
                        (this.primaryResponsesRequired_--,
                        this.primaryResponsesRequired_ <= 0 &&
                            (this.log_('Primary connection is healthy.'),
                            (this.isHealthy_ = !0),
                            this.conn_.markConnectionHealthy()));
                }),
                (ft.prototype.onControl_ = function(e) {
                    var t = he('t', e);
                    if ('d' in e)
                        if (((e = e.d), 'h' === t)) this.onHandshake_(e);
                        else if ('n' === t) {
                            this.log_('recvd end transmission on primary'),
                                (this.rx_ = this.secondaryConn_);
                            for (var n = 0; n < this.pendingDataMessages.length; ++n)
                                this.onDataMessage_(this.pendingDataMessages[n]);
                            (this.pendingDataMessages = []), this.tryCleanupConnection();
                        } else
                            's' === t
                                ? this.onConnectionShutdown_(e)
                                : 'r' === t
                                ? this.onReset_(e)
                                : 'e' === t
                                ? ae('Server Error: ' + e)
                                : 'o' === t
                                ? (this.log_('got pong on primary.'),
                                  this.onPrimaryResponse_(),
                                  this.sendPingOnPrimaryIfNecessary_())
                                : ae('Unknown control packet command: ' + t);
                }),
                (ft.prototype.onHandshake_ = function(e) {
                    var t = e.ts,
                        n = e.v,
                        r = e.h;
                    (this.sessionId = e.s),
                        (this.repoInfo_.host = r),
                        0 === this.state_ &&
                            (this.conn_.start(),
                            this.onConnectionEstablished_(this.conn_, t),
                            '5' !== n && Ee('Protocol version mismatch detected'),
                            this.tryStartUpgrade_());
                }),
                (ft.prototype.tryStartUpgrade_ = function() {
                    var e = this.transportManager_.upgradeTransport();
                    e && this.startUpgrade_(e);
                }),
                (ft.prototype.startUpgrade_ = function(e) {
                    var t = this;
                    (this.secondaryConn_ = new e(
                        this.nextTransportId_(),
                        this.repoInfo_,
                        this.applicationId_,
                        this.sessionId
                    )),
                        (this.secondaryResponsesRequired_ = e.responsesRequiredToBeHealthy || 0);
                    var n = this.connReceiver_(this.secondaryConn_),
                        e = this.disconnReceiver_(this.secondaryConn_);
                    this.secondaryConn_.open(n, e),
                        xe(function() {
                            t.secondaryConn_ &&
                                (t.log_('Timed out trying to upgrade.'), t.secondaryConn_.close());
                        }, Math.floor(6e4));
                }),
                (ft.prototype.onReset_ = function(e) {
                    this.log_('Reset packet received.  New host: ' + e),
                        (this.repoInfo_.host = e),
                        1 === this.state_
                            ? this.close()
                            : (this.closeConnections_(), this.start_());
                }),
                (ft.prototype.onConnectionEstablished_ = function(e, t) {
                    var n = this;
                    this.log_('Realtime connection established.'),
                        (this.conn_ = e),
                        (this.state_ = 1),
                        this.onReady_ && (this.onReady_(t, this.sessionId), (this.onReady_ = null)),
                        0 === this.primaryResponsesRequired_
                            ? (this.log_('Primary connection is healthy.'), (this.isHealthy_ = !0))
                            : xe(function() {
                                  n.sendPingOnPrimaryIfNecessary_();
                              }, Math.floor(5e3));
                }),
                (ft.prototype.sendPingOnPrimaryIfNecessary_ = function() {
                    this.isHealthy_ ||
                        1 !== this.state_ ||
                        (this.log_('sending ping on primary.'),
                        this.sendData_({t: 'c', d: {t: 'p', d: {}}}));
                }),
                (ft.prototype.onSecondaryConnectionLost_ = function() {
                    var e = this.secondaryConn_;
                    (this.secondaryConn_ = null),
                        (this.tx_ !== e && this.rx_ !== e) || this.close();
                }),
                (ft.prototype.onConnectionLost_ = function(e) {
                    (this.conn_ = null),
                        e || 0 !== this.state_
                            ? 1 === this.state_ && this.log_('Realtime connection lost.')
                            : (this.log_('Realtime connection failed.'),
                              this.repoInfo_.isCacheableHost() &&
                                  (fe.remove('host:' + this.repoInfo_.host),
                                  (this.repoInfo_.internalHost = this.repoInfo_.host))),
                        this.close();
                }),
                (ft.prototype.onConnectionShutdown_ = function(e) {
                    this.log_('Connection shutdown command received. Shutting down...'),
                        this.onKill_ && (this.onKill_(e), (this.onKill_ = null)),
                        (this.onDisconnect_ = null),
                        this.close();
                }),
                (ft.prototype.sendData_ = function(e) {
                    if (1 !== this.state_) throw 'Connection is not connected';
                    this.tx_.send(e);
                }),
                (ft.prototype.close = function() {
                    2 !== this.state_ &&
                        (this.log_('Closing realtime connection.'),
                        (this.state_ = 2),
                        this.closeConnections_(),
                        this.onDisconnect_ && (this.onDisconnect_(), (this.onDisconnect_ = null)));
                }),
                (ft.prototype.closeConnections_ = function() {
                    this.log_('Shutting down all connections'),
                        this.conn_ && (this.conn_.close(), (this.conn_ = null)),
                        this.secondaryConn_ &&
                            (this.secondaryConn_.close(), (this.secondaryConn_ = null)),
                        this.healthyTimeout_ &&
                            (clearTimeout(this.healthyTimeout_), (this.healthyTimeout_ = null));
                }),
                ft);
            function ft(e, t, n, r, i, o, s, a) {
                (this.id = e),
                    (this.repoInfo_ = t),
                    (this.applicationId_ = n),
                    (this.onMessage_ = r),
                    (this.onReady_ = i),
                    (this.onDisconnect_ = o),
                    (this.onKill_ = s),
                    (this.lastSessionId = a),
                    (this.connectionCount = 0),
                    (this.pendingDataMessages = []),
                    (this.state_ = 0),
                    (this.log_ = be('c:' + this.id + ':')),
                    (this.transportManager_ = new ct(t)),
                    this.log_('Connection created'),
                    this.start_();
            }
            var _t =
                ((yt.prototype.put = function(e, t, n, r) {}),
                (yt.prototype.merge = function(e, t, n, r) {}),
                (yt.prototype.refreshAuthToken = function(e) {}),
                (yt.prototype.onDisconnectPut = function(e, t, n) {}),
                (yt.prototype.onDisconnectMerge = function(e, t, n) {}),
                (yt.prototype.onDisconnectCancel = function(e, t) {}),
                (yt.prototype.reportStats = function(e) {}),
                yt);
            function yt() {}
            var vt =
                ((gt.prototype.trigger = function(e) {
                    for (var t = [], n = 1; n < arguments.length; n++) t[n - 1] = arguments[n];
                    if (Array.isArray(this.listeners_[e]))
                        for (var r = s([], y(this.listeners_[e])), i = 0; i < r.length; i++)
                            r[i].callback.apply(r[i].context, t);
                }),
                (gt.prototype.on = function(e, t, n) {
                    this.validateEventType_(e),
                        (this.listeners_[e] = this.listeners_[e] || []),
                        this.listeners_[e].push({callback: t, context: n}),
                        (e = this.getInitialEvent(e)) && t.apply(n, e);
                }),
                (gt.prototype.off = function(e, t, n) {
                    this.validateEventType_(e);
                    for (var r = this.listeners_[e] || [], i = 0; i < r.length; i++)
                        if (r[i].callback === t && (!n || n === r[i].context))
                            return void r.splice(i, 1);
                }),
                (gt.prototype.validateEventType_ = function(t) {
                    g(
                        this.allowedEvents_.find(function(e) {
                            return e === t;
                        }),
                        'Unknown event: ' + t
                    );
                }),
                gt);
            function gt(e) {
                (this.allowedEvents_ = e),
                    (this.listeners_ = {}),
                    g(Array.isArray(e) && 0 < e.length, 'Requires a non-empty array');
            }
            var mt,
                wt =
                    (n(Ct, (mt = vt)),
                    (Ct.getInstance = function() {
                        return new Ct();
                    }),
                    (Ct.prototype.getInitialEvent = function(e) {
                        return g('online' === e, 'Unknown event type: ' + e), [this.online_];
                    }),
                    (Ct.prototype.currentlyOnline = function() {
                        return this.online_;
                    }),
                    Ct);
            function Ct() {
                var e = mt.call(this, ['online']) || this;
                return (
                    (e.online_ = !0),
                    'undefined' == typeof window ||
                        void 0 === window.addEventListener ||
                        f() ||
                        (window.addEventListener(
                            'online',
                            function() {
                                e.online_ || ((e.online_ = !0), e.trigger('online', !0));
                            },
                            !1
                        ),
                        window.addEventListener(
                            'offline',
                            function() {
                                e.online_ && ((e.online_ = !1), e.trigger('online', !1));
                            },
                            !1
                        )),
                    e
                );
            }
            var bt =
                ((Et.prototype.toString = function() {
                    for (var e = '', t = this.pieceNum_; t < this.pieces_.length; t++)
                        '' !== this.pieces_[t] && (e += '/' + this.pieces_[t]);
                    return e || '/';
                }),
                Et);
            function Et(e, t) {
                if (void 0 === t) {
                    this.pieces_ = e.split('/');
                    for (var n = 0, r = 0; r < this.pieces_.length; r++)
                        0 < this.pieces_[r].length && ((this.pieces_[n] = this.pieces_[r]), n++);
                    (this.pieces_.length = n), (this.pieceNum_ = 0);
                } else (this.pieces_ = e), (this.pieceNum_ = t);
            }
            function St() {
                return new bt('');
            }
            function Tt(e) {
                return e.pieceNum_ >= e.pieces_.length ? null : e.pieces_[e.pieceNum_];
            }
            function It(e) {
                return e.pieces_.length - e.pieceNum_;
            }
            function Pt(e) {
                var t = e.pieceNum_;
                return t < e.pieces_.length && t++, new bt(e.pieces_, t);
            }
            function Nt(e) {
                return e.pieceNum_ < e.pieces_.length ? e.pieces_[e.pieces_.length - 1] : null;
            }
            function Rt(e, t) {
                return void 0 === t && (t = 0), e.pieces_.slice(e.pieceNum_ + t);
            }
            function xt(e) {
                if (e.pieceNum_ >= e.pieces_.length) return null;
                for (var t = [], n = e.pieceNum_; n < e.pieces_.length - 1; n++)
                    t.push(e.pieces_[n]);
                return new bt(t, 0);
            }
            function kt(e, t) {
                for (var n = [], r = e.pieceNum_; r < e.pieces_.length; r++) n.push(e.pieces_[r]);
                if (t instanceof bt)
                    for (r = t.pieceNum_; r < t.pieces_.length; r++) n.push(t.pieces_[r]);
                else
                    for (var i = t.split('/'), r = 0; r < i.length; r++)
                        0 < i[r].length && n.push(i[r]);
                return new bt(n, 0);
            }
            function Dt(e) {
                return e.pieceNum_ >= e.pieces_.length;
            }
            function Ot(e, t) {
                var n = Tt(e),
                    r = Tt(t);
                if (null === n) return t;
                if (n === r) return Ot(Pt(e), Pt(t));
                throw new Error(
                    'INTERNAL ERROR: innerPath (' + t + ') is not within outerPath (' + e + ')'
                );
            }
            function At(e, t) {
                for (var n = Rt(e, 0), r = Rt(t, 0), i = 0; i < n.length && i < r.length; i++) {
                    var o = Ie(n[i], r[i]);
                    if (0 !== o) return o;
                }
                return n.length === r.length ? 0 : n.length < r.length ? -1 : 1;
            }
            function Lt(e, t) {
                if (It(e) !== It(t)) return !1;
                for (var n = e.pieceNum_, r = t.pieceNum_; n <= e.pieces_.length; n++, r++)
                    if (e.pieces_[n] !== t.pieces_[r]) return !1;
                return !0;
            }
            function Mt(e, t) {
                var n = e.pieceNum_,
                    r = t.pieceNum_;
                if (It(e) > It(t)) return !1;
                for (; n < e.pieces_.length; ) {
                    if (e.pieces_[n] !== t.pieces_[r]) return !1;
                    ++n, ++r;
                }
                return !0;
            }
            function Ft(e, t) {
                (this.errorPrefix_ = t),
                    (this.parts_ = Rt(e, 0)),
                    (this.byteLength_ = Math.max(1, this.parts_.length));
                for (var n = 0; n < this.parts_.length; n++) this.byteLength_ += Q(this.parts_[n]);
                qt(this);
            }
            function qt(e) {
                if (768 < e.byteLength_)
                    throw new Error(
                        e.errorPrefix_ +
                            'has a key path longer than 768 bytes (' +
                            e.byteLength_ +
                            ').'
                    );
                if (32 < e.parts_.length)
                    throw new Error(
                        e.errorPrefix_ +
                            'path specified exceeds the maximum depth that can be written (32) or object contains a cycle ' +
                            Wt(e)
                    );
            }
            function Wt(e) {
                return 0 === e.parts_.length ? '' : "in property '" + e.parts_.join('.') + "'";
            }
            var Qt,
                jt =
                    (n(Ut, (Qt = vt)),
                    (Ut.getInstance = function() {
                        return new Ut();
                    }),
                    (Ut.prototype.getInitialEvent = function(e) {
                        return g('visible' === e, 'Unknown event type: ' + e), [this.visible_];
                    }),
                    Ut);
            function Ut() {
                var t,
                    e,
                    n = Qt.call(this, ['visible']) || this;
                return (
                    'undefined' != typeof document &&
                        void 0 !== document.addEventListener &&
                        (void 0 !== document.hidden
                            ? ((e = 'visibilitychange'), (t = 'hidden'))
                            : void 0 !== document.mozHidden
                            ? ((e = 'mozvisibilitychange'), (t = 'mozHidden'))
                            : void 0 !== document.msHidden
                            ? ((e = 'msvisibilitychange'), (t = 'msHidden'))
                            : void 0 !== document.webkitHidden &&
                              ((e = 'webkitvisibilitychange'), (t = 'webkitHidden'))),
                    (n.visible_ = !0),
                    e &&
                        document.addEventListener(
                            e,
                            function() {
                                var e = !document[t];
                                e !== n.visible_ && ((n.visible_ = e), n.trigger('visible', e));
                            },
                            !1
                        ),
                    n
                );
            }
            var Bt,
                Ht = 1e3,
                Vt = 3e5,
                zt =
                    (n(Kt, (Bt = _t)),
                    (Kt.prototype.sendRequest = function(e, t, n) {
                        var r = ++this.requestNumber_,
                            t = {r: r, a: e, b: t};
                        this.log_(N(t)),
                            g(
                                this.connected_,
                                "sendRequest call when we're not connected not allowed."
                            ),
                            this.realtime_.sendRequest(t),
                            n && (this.requestCBHash_[r] = n);
                    }),
                    (Kt.prototype.get = function(e) {
                        var n = this,
                            r = new d(),
                            i = {p: e.path.toString(), q: e.queryObject()},
                            t = {
                                action: 'g',
                                request: i,
                                onComplete: function(e) {
                                    var t = e.d;
                                    'ok' === e.s
                                        ? (n.onDataUpdate_(i.p, t, !1, null), r.resolve(t))
                                        : r.reject(t);
                                },
                            };
                        this.outstandingGets_.push(t), this.outstandingGetCount_++;
                        var o = this.outstandingGets_.length - 1;
                        return (
                            this.connected_ ||
                                setTimeout(function() {
                                    var e = n.outstandingGets_[o];
                                    void 0 !== e &&
                                        t === e &&
                                        (delete n.outstandingGets_[o],
                                        n.outstandingGetCount_--,
                                        0 === n.outstandingGetCount_ && (n.outstandingGets_ = []),
                                        n.log_('get ' + o + ' timed out on connection'),
                                        r.reject(new Error('Client is offline.')));
                                }, 3e3),
                            this.connected_ && this.sendGet_(o),
                            r.promise
                        );
                    }),
                    (Kt.prototype.listen = function(e, t, n, r) {
                        var i = e.queryIdentifier(),
                            o = e.path.toString();
                        this.log_('Listen called for ' + o + ' ' + i),
                            this.listens.has(o) || this.listens.set(o, new Map()),
                            g(
                                e.getQueryParams().isDefault() ||
                                    !e.getQueryParams().loadsAllData(),
                                'listen() called for non-default but complete query'
                            ),
                            g(
                                !this.listens.get(o).has(i),
                                'listen() called twice for same path/queryId.'
                            ),
                            (n = {onComplete: r, hashFn: t, query: e, tag: n}),
                            this.listens.get(o).set(i, n),
                            this.connected_ && this.sendListen_(n);
                    }),
                    (Kt.prototype.sendGet_ = function(t) {
                        var n = this,
                            r = this.outstandingGets_[t];
                        this.sendRequest('g', r.request, function(e) {
                            delete n.outstandingGets_[t],
                                n.outstandingGetCount_--,
                                0 === n.outstandingGetCount_ && (n.outstandingGets_ = []),
                                r.onComplete && r.onComplete(e);
                        });
                    }),
                    (Kt.prototype.sendListen_ = function(r) {
                        var i = this,
                            o = r.query,
                            s = o.path.toString(),
                            a = o.queryIdentifier();
                        this.log_('Listen on ' + s + ' for ' + a);
                        var e = {p: s};
                        r.tag && ((e.q = o.queryObject()), (e.t = r.tag)),
                            (e.h = r.hashFn()),
                            this.sendRequest('q', e, function(e) {
                                var t = e.d,
                                    n = e.s;
                                Kt.warnOnListenWarnings_(t, o),
                                    (i.listens.get(s) && i.listens.get(s).get(a)) === r &&
                                        (i.log_('listen response', e),
                                        'ok' !== n && i.removeListen_(s, a),
                                        r.onComplete && r.onComplete(n, t));
                            });
                    }),
                    (Kt.warnOnListenWarnings_ = function(e, t) {
                        e &&
                            'object' == typeof e &&
                            x(e, 'w') &&
                            ((e = k(e, 'w')),
                            Array.isArray(e) &&
                                ~e.indexOf('no_index') &&
                                ((e =
                                    '".indexOn": "' +
                                    t
                                        .getQueryParams()
                                        .getIndex()
                                        .toString() +
                                    '"'),
                                (t = t.path.toString()),
                                Ee(
                                    'Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ' +
                                        e +
                                        ' at ' +
                                        t +
                                        ' to your security rules for better performance.'
                                )));
                    }),
                    (Kt.prototype.refreshAuthToken = function(e) {
                        (this.authToken_ = e),
                            this.log_('Auth token refreshed'),
                            this.authToken_
                                ? this.tryAuth()
                                : this.connected_ && this.sendRequest('unauth', {}, function() {}),
                            this.reduceReconnectDelayIfAdminCredential_(e);
                    }),
                    (Kt.prototype.reduceReconnectDelayIfAdminCredential_ = function(e) {
                        ((e && 40 === e.length) ||
                            ('object' == typeof (e = R((e = e)).claims) && !0 === e.admin)) &&
                            (this.log_(
                                'Admin auth credential detected.  Reducing max reconnect time.'
                            ),
                            (this.maxReconnectDelay_ = 3e4));
                    }),
                    (Kt.prototype.tryAuth = function() {
                        var n,
                            e,
                            t,
                            r = this;
                        this.connected_ &&
                            this.authToken_ &&
                            ((e =
                                (t = R((t = n = this.authToken_)).claims) &&
                                'object' == typeof t &&
                                t.hasOwnProperty('iat')
                                    ? 'auth'
                                    : 'gauth'),
                            (t = {cred: n}),
                            null === this.authOverride_
                                ? (t.noauth = !0)
                                : 'object' == typeof this.authOverride_ &&
                                  (t.authvar = this.authOverride_),
                            this.sendRequest(e, t, function(e) {
                                var t = e.s,
                                    e = e.d || 'error';
                                r.authToken_ === n &&
                                    ('ok' === t
                                        ? (r.invalidAuthTokenCount_ = 0)
                                        : r.onAuthRevoked_(t, e));
                            }));
                    }),
                    (Kt.prototype.unlisten = function(e, t) {
                        var n = e.path.toString(),
                            r = e.queryIdentifier();
                        this.log_('Unlisten called for ' + n + ' ' + r),
                            g(
                                e.getQueryParams().isDefault() ||
                                    !e.getQueryParams().loadsAllData(),
                                'unlisten() called for non-default but complete query'
                            ),
                            this.removeListen_(n, r) &&
                                this.connected_ &&
                                this.sendUnlisten_(n, r, e.queryObject(), t);
                    }),
                    (Kt.prototype.sendUnlisten_ = function(e, t, n, r) {
                        this.log_('Unlisten on ' + e + ' for ' + t),
                            (e = {p: e}),
                            r && ((e.q = n), (e.t = r)),
                            this.sendRequest('n', e);
                    }),
                    (Kt.prototype.onDisconnectPut = function(e, t, n) {
                        this.connected_
                            ? this.sendOnDisconnect_('o', e, t, n)
                            : this.onDisconnectRequestQueue_.push({
                                  pathString: e,
                                  action: 'o',
                                  data: t,
                                  onComplete: n,
                              });
                    }),
                    (Kt.prototype.onDisconnectMerge = function(e, t, n) {
                        this.connected_
                            ? this.sendOnDisconnect_('om', e, t, n)
                            : this.onDisconnectRequestQueue_.push({
                                  pathString: e,
                                  action: 'om',
                                  data: t,
                                  onComplete: n,
                              });
                    }),
                    (Kt.prototype.onDisconnectCancel = function(e, t) {
                        this.connected_
                            ? this.sendOnDisconnect_('oc', e, null, t)
                            : this.onDisconnectRequestQueue_.push({
                                  pathString: e,
                                  action: 'oc',
                                  data: null,
                                  onComplete: t,
                              });
                    }),
                    (Kt.prototype.sendOnDisconnect_ = function(e, t, n, r) {
                        (n = {p: t, d: n}),
                            this.log_('onDisconnect ' + e, n),
                            this.sendRequest(e, n, function(e) {
                                r &&
                                    setTimeout(function() {
                                        r(e.s, e.d);
                                    }, Math.floor(0));
                            });
                    }),
                    (Kt.prototype.put = function(e, t, n, r) {
                        this.putInternal('p', e, t, n, r);
                    }),
                    (Kt.prototype.merge = function(e, t, n, r) {
                        this.putInternal('m', e, t, n, r);
                    }),
                    (Kt.prototype.putInternal = function(e, t, n, r, i) {
                        (n = {p: t, d: n}),
                            void 0 !== i && (n.h = i),
                            this.outstandingPuts_.push({action: e, request: n, onComplete: r}),
                            this.outstandingPutCount_++,
                            (r = this.outstandingPuts_.length - 1),
                            this.connected_ ? this.sendPut_(r) : this.log_('Buffering put: ' + t);
                    }),
                    (Kt.prototype.sendPut_ = function(t) {
                        var n = this,
                            r = this.outstandingPuts_[t].action,
                            e = this.outstandingPuts_[t].request,
                            i = this.outstandingPuts_[t].onComplete;
                        (this.outstandingPuts_[t].queued = this.connected_),
                            this.sendRequest(r, e, function(e) {
                                n.log_(r + ' response', e),
                                    delete n.outstandingPuts_[t],
                                    n.outstandingPutCount_--,
                                    0 === n.outstandingPutCount_ && (n.outstandingPuts_ = []),
                                    i && i(e.s, e.d);
                            });
                    }),
                    (Kt.prototype.reportStats = function(e) {
                        var t = this;
                        this.connected_ &&
                            ((e = {c: e}),
                            this.log_('reportStats', e),
                            this.sendRequest('s', e, function(e) {
                                'ok' !== e.s &&
                                    ((e = e.d), t.log_('reportStats', 'Error sending stats: ' + e));
                            }));
                    }),
                    (Kt.prototype.onDataMessage_ = function(e) {
                        if ('r' in e) {
                            this.log_('from server: ' + N(e));
                            var t = e.r,
                                n = this.requestCBHash_[t];
                            n && (delete this.requestCBHash_[t], n(e.b));
                        } else {
                            if ('error' in e) throw 'A server-side error has occurred: ' + e.error;
                            'a' in e && this.onDataPush_(e.a, e.b);
                        }
                    }),
                    (Kt.prototype.onDataPush_ = function(e, t) {
                        this.log_('handleServerMessage', e, t),
                            'd' === e
                                ? this.onDataUpdate_(t.p, t.d, !1, t.t)
                                : 'm' === e
                                ? this.onDataUpdate_(t.p, t.d, !0, t.t)
                                : 'c' === e
                                ? this.onListenRevoked_(t.p, t.q)
                                : 'ac' === e
                                ? this.onAuthRevoked_(t.s, t.d)
                                : 'sd' === e
                                ? this.onSecurityDebugPacket_(t)
                                : ae(
                                      'Unrecognized action received from server: ' +
                                          N(e) +
                                          '\nAre you using the latest client?'
                                  );
                    }),
                    (Kt.prototype.onReady_ = function(e, t) {
                        this.log_('connection ready'),
                            (this.connected_ = !0),
                            (this.lastConnectionEstablishedTime_ = new Date().getTime()),
                            this.handleTimestamp_(e),
                            (this.lastSessionId = t),
                            this.firstConnection_ && this.sendConnectStats_(),
                            this.restoreState_(),
                            (this.firstConnection_ = !1),
                            this.onConnectStatus_(!0);
                    }),
                    (Kt.prototype.scheduleConnect_ = function(e) {
                        var t = this;
                        g(
                            !this.realtime_,
                            "Scheduling a connect when we're already connected/ing?"
                        ),
                            this.establishConnectionTimer_ &&
                                clearTimeout(this.establishConnectionTimer_),
                            (this.establishConnectionTimer_ = setTimeout(function() {
                                (t.establishConnectionTimer_ = null), t.establishConnection_();
                            }, Math.floor(e)));
                    }),
                    (Kt.prototype.onVisible_ = function(e) {
                        e &&
                            !this.visible_ &&
                            this.reconnectDelay_ === this.maxReconnectDelay_ &&
                            (this.log_('Window became visible.  Reducing delay.'),
                            (this.reconnectDelay_ = Ht),
                            this.realtime_ || this.scheduleConnect_(0)),
                            (this.visible_ = e);
                    }),
                    (Kt.prototype.onOnline_ = function(e) {
                        e
                            ? (this.log_('Browser went online.'),
                              (this.reconnectDelay_ = Ht),
                              this.realtime_ || this.scheduleConnect_(0))
                            : (this.log_('Browser went offline.  Killing connection.'),
                              this.realtime_ && this.realtime_.close());
                    }),
                    (Kt.prototype.onRealtimeDisconnect_ = function() {
                        var e;
                        this.log_('data client disconnected'),
                            (this.connected_ = !1),
                            (this.realtime_ = null),
                            this.cancelSentTransactions_(),
                            (this.requestCBHash_ = {}),
                            this.shouldReconnect_() &&
                                (this.visible_
                                    ? this.lastConnectionEstablishedTime_ &&
                                      (3e4 <
                                          new Date().getTime() -
                                              this.lastConnectionEstablishedTime_ &&
                                          (this.reconnectDelay_ = Ht),
                                      (this.lastConnectionEstablishedTime_ = null))
                                    : (this.log_("Window isn't visible.  Delaying reconnect."),
                                      (this.reconnectDelay_ = this.maxReconnectDelay_),
                                      (this.lastConnectionAttemptTime_ = new Date().getTime())),
                                (e = new Date().getTime() - this.lastConnectionAttemptTime_),
                                (e = Math.max(0, this.reconnectDelay_ - e)),
                                (e = Math.random() * e),
                                this.log_('Trying to reconnect in ' + e + 'ms'),
                                this.scheduleConnect_(e),
                                (this.reconnectDelay_ = Math.min(
                                    this.maxReconnectDelay_,
                                    1.3 * this.reconnectDelay_
                                ))),
                            this.onConnectStatus_(!1);
                    }),
                    (Kt.prototype.establishConnection_ = function() {
                        var t,
                            n,
                            r,
                            i,
                            o,
                            s,
                            a,
                            u,
                            l,
                            e,
                            h = this;
                        this.shouldReconnect_() &&
                            (this.log_('Making a connection attempt'),
                            (this.lastConnectionAttemptTime_ = new Date().getTime()),
                            (this.lastConnectionEstablishedTime_ = null),
                            (t = this.onDataMessage_.bind(this)),
                            (n = this.onReady_.bind(this)),
                            (r = this.onRealtimeDisconnect_.bind(this)),
                            (i = this.id + ':' + Kt.nextConnectionId_++),
                            (s = (o = this).lastSessionId),
                            (a = !1),
                            (u = null),
                            (l = function() {
                                u ? u.close() : ((a = !0), r());
                            }),
                            (this.realtime_ = {
                                close: l,
                                sendRequest: function(e) {
                                    g(u, "sendRequest call when we're not connected not allowed."),
                                        u.sendRequest(e);
                                },
                            }),
                            (e = this.forceTokenRefresh_),
                            (this.forceTokenRefresh_ = !1),
                            this.authTokenProvider_
                                .getToken(e)
                                .then(function(e) {
                                    a
                                        ? Ce('getToken() completed but was canceled')
                                        : (Ce('getToken() completed. Creating connection.'),
                                          (o.authToken_ = e && e.accessToken),
                                          (u = new pt(
                                              i,
                                              o.repoInfo_,
                                              o.applicationId_,
                                              t,
                                              n,
                                              r,
                                              function(e) {
                                                  Ee(e + ' (' + o.repoInfo_.toString() + ')'),
                                                      o.interrupt('server_kill');
                                              },
                                              s
                                          )));
                                })
                                .then(null, function(e) {
                                    o.log_('Failed to get token: ' + e),
                                        a || (h.repoInfo_.nodeAdmin && Ee(e), l());
                                }));
                    }),
                    (Kt.prototype.interrupt = function(e) {
                        Ce('Interrupting connection for reason: ' + e),
                            (this.interruptReasons_[e] = !0),
                            this.realtime_
                                ? this.realtime_.close()
                                : (this.establishConnectionTimer_ &&
                                      (clearTimeout(this.establishConnectionTimer_),
                                      (this.establishConnectionTimer_ = null)),
                                  this.connected_ && this.onRealtimeDisconnect_());
                    }),
                    (Kt.prototype.resume = function(e) {
                        Ce('Resuming connection for reason: ' + e),
                            delete this.interruptReasons_[e],
                            D(this.interruptReasons_) &&
                                ((this.reconnectDelay_ = Ht),
                                this.realtime_ || this.scheduleConnect_(0));
                    }),
                    (Kt.prototype.handleTimestamp_ = function(e) {
                        (e -= new Date().getTime()),
                            this.onServerInfoUpdate_({serverTimeOffset: e});
                    }),
                    (Kt.prototype.cancelSentTransactions_ = function() {
                        for (var e = 0; e < this.outstandingPuts_.length; e++) {
                            var t = this.outstandingPuts_[e];
                            t &&
                                'h' in t.request &&
                                t.queued &&
                                (t.onComplete && t.onComplete('disconnect'),
                                delete this.outstandingPuts_[e],
                                this.outstandingPutCount_--);
                        }
                        0 === this.outstandingPutCount_ && (this.outstandingPuts_ = []);
                    }),
                    (Kt.prototype.onListenRevoked_ = function(e, t) {
                        (t = t
                            ? t
                                  .map(function(e) {
                                      return Pe(e);
                                  })
                                  .join('$')
                            : 'default'),
                            (t = this.removeListen_(e, t)) &&
                                t.onComplete &&
                                t.onComplete('permission_denied');
                    }),
                    (Kt.prototype.removeListen_ = function(e, t) {
                        var n,
                            r = new bt(e).toString();
                        return (
                            this.listens.has(r)
                                ? ((n = (e = this.listens.get(r)).get(t)),
                                  e.delete(t),
                                  0 === e.size && this.listens.delete(r))
                                : (n = void 0),
                            n
                        );
                    }),
                    (Kt.prototype.onAuthRevoked_ = function(e, t) {
                        Ce('Auth token revoked: ' + e + '/' + t),
                            (this.authToken_ = null),
                            (this.forceTokenRefresh_ = !0),
                            this.realtime_.close(),
                            ('invalid_token' !== e && 'permission_denied' !== e) ||
                                (this.invalidAuthTokenCount_++,
                                3 <= this.invalidAuthTokenCount_ &&
                                    ((this.reconnectDelay_ = 3e4),
                                    this.authTokenProvider_.notifyForInvalidToken()));
                    }),
                    (Kt.prototype.onSecurityDebugPacket_ = function(e) {
                        this.securityDebugCallback_
                            ? this.securityDebugCallback_(e)
                            : 'msg' in e &&
                              console.log('FIREBASE: ' + e.msg.replace('\n', '\nFIREBASE: '));
                    }),
                    (Kt.prototype.restoreState_ = function() {
                        var e, t, n, r;
                        this.tryAuth();
                        try {
                            for (
                                var i = _(this.listens.values()), o = i.next();
                                !o.done;
                                o = i.next()
                            ) {
                                var s = o.value;
                                try {
                                    for (
                                        var a = ((n = void 0), _(s.values())), u = a.next();
                                        !u.done;
                                        u = a.next()
                                    ) {
                                        var l = u.value;
                                        this.sendListen_(l);
                                    }
                                } catch (t) {
                                    n = {error: t};
                                } finally {
                                    try {
                                        u && !u.done && (r = a.return) && r.call(a);
                                    } finally {
                                        if (n) throw n.error;
                                    }
                                }
                            }
                        } catch (t) {
                            e = {error: t};
                        } finally {
                            try {
                                o && !o.done && (t = i.return) && t.call(i);
                            } finally {
                                if (e) throw e.error;
                            }
                        }
                        for (var h = 0; h < this.outstandingPuts_.length; h++)
                            this.outstandingPuts_[h] && this.sendPut_(h);
                        for (; this.onDisconnectRequestQueue_.length; ) {
                            var c = this.onDisconnectRequestQueue_.shift();
                            this.sendOnDisconnect_(c.action, c.pathString, c.data, c.onComplete);
                        }
                        for (h = 0; h < this.outstandingGets_.length; h++)
                            this.outstandingGets_[h] && this.sendGet_(h);
                    }),
                    (Kt.prototype.sendConnectStats_ = function() {
                        var e = {};
                        (e['sdk.js.' + st.replace(/\./g, '-')] = 1),
                            f()
                                ? (e['framework.cordova'] = 1)
                                : 'object' == typeof navigator &&
                                  'ReactNative' === navigator.product &&
                                  (e['framework.reactnative'] = 1),
                            this.reportStats(e);
                    }),
                    (Kt.prototype.shouldReconnect_ = function() {
                        var e = wt.getInstance().currentlyOnline();
                        return D(this.interruptReasons_) && e;
                    }),
                    (Kt.nextPersistentConnectionId_ = 0),
                    (Kt.nextConnectionId_ = 0),
                    Kt);
            function Kt(e, t, n, r, i, o, s) {
                var a = Bt.call(this) || this;
                if (
                    ((a.repoInfo_ = e),
                    (a.applicationId_ = t),
                    (a.onDataUpdate_ = n),
                    (a.onConnectStatus_ = r),
                    (a.onServerInfoUpdate_ = i),
                    (a.authTokenProvider_ = o),
                    (a.authOverride_ = s),
                    (a.id = Kt.nextPersistentConnectionId_++),
                    (a.log_ = be('p:' + a.id + ':')),
                    (a.interruptReasons_ = {}),
                    (a.listens = new Map()),
                    (a.outstandingPuts_ = []),
                    (a.outstandingGets_ = []),
                    (a.outstandingPutCount_ = 0),
                    (a.outstandingGetCount_ = 0),
                    (a.onDisconnectRequestQueue_ = []),
                    (a.connected_ = !1),
                    (a.reconnectDelay_ = Ht),
                    (a.maxReconnectDelay_ = Vt),
                    (a.securityDebugCallback_ = null),
                    (a.lastSessionId = null),
                    (a.establishConnectionTimer_ = null),
                    (a.visible_ = !1),
                    (a.requestCBHash_ = {}),
                    (a.requestNumber_ = 0),
                    (a.realtime_ = null),
                    (a.authToken_ = null),
                    (a.forceTokenRefresh_ = !1),
                    (a.invalidAuthTokenCount_ = 0),
                    (a.firstConnection_ = !0),
                    (a.lastConnectionAttemptTime_ = null),
                    (a.lastConnectionEstablishedTime_ = null),
                    s && !v())
                )
                    throw new Error(
                        'Auth override specified in options, but not supported on non Node.js platforms'
                    );
                return (
                    a.scheduleConnect_(0),
                    jt.getInstance().on('visible', a.onVisible_, a),
                    -1 === e.host.indexOf('fblocal') &&
                        wt.getInstance().on('online', a.onOnline_, a),
                    a
                );
            }
            var Yt =
                ((Gt.Wrap = function(e, t) {
                    return new Gt(e, t);
                }),
                Gt);
            function Gt(e, t) {
                (this.name = e), (this.node = t);
            }
            var $t,
                Jt,
                Xt =
                    ((Zt.prototype.getCompare = function() {
                        return this.compare.bind(this);
                    }),
                    (Zt.prototype.indexedValueChanged = function(e, t) {
                        return (e = new Yt(Se, e)), (t = new Yt(Se, t)), 0 !== this.compare(e, t);
                    }),
                    (Zt.prototype.minPost = function() {
                        return Yt.MIN;
                    }),
                    Zt);
            function Zt() {}
            function en() {
                return (null !== Jt && Jt.apply(this, arguments)) || this;
            }
            var tn = new (Z =
                    (n(en, (Jt = Xt)),
                    Object.defineProperty(en, '__EMPTY_NODE', {
                        get: function() {
                            return $t;
                        },
                        set: function(e) {
                            $t = e;
                        },
                        enumerable: !1,
                        configurable: !0,
                    }),
                    (en.prototype.compare = function(e, t) {
                        return Ie(e.name, t.name);
                    }),
                    (en.prototype.isDefinedOn = function(e) {
                        throw m('KeyIndex.isDefinedOn not expected to be called.');
                    }),
                    (en.prototype.indexedValueChanged = function(e, t) {
                        return !1;
                    }),
                    (en.prototype.minPost = function() {
                        return Yt.MIN;
                    }),
                    (en.prototype.maxPost = function() {
                        return new Yt(Te, $t);
                    }),
                    (en.prototype.makePost = function(e, t) {
                        return (
                            g('string' == typeof e, 'KeyIndex indexValue must always be a string.'),
                            new Yt(e, $t)
                        );
                    }),
                    (en.prototype.toString = function() {
                        return '.key';
                    }),
                    en))(),
                nn =
                    ((rn.prototype.getNext = function() {
                        if (0 === this.nodeStack_.length) return null;
                        var e = this.nodeStack_.pop(),
                            t = this.resultGenerator_
                                ? this.resultGenerator_(e.key, e.value)
                                : {key: e.key, value: e.value};
                        if (this.isReverse_)
                            for (e = e.left; !e.isEmpty(); ) this.nodeStack_.push(e), (e = e.right);
                        else
                            for (e = e.right; !e.isEmpty(); ) this.nodeStack_.push(e), (e = e.left);
                        return t;
                    }),
                    (rn.prototype.hasNext = function() {
                        return 0 < this.nodeStack_.length;
                    }),
                    (rn.prototype.peek = function() {
                        if (0 === this.nodeStack_.length) return null;
                        var e = this.nodeStack_[this.nodeStack_.length - 1];
                        return this.resultGenerator_
                            ? this.resultGenerator_(e.key, e.value)
                            : {key: e.key, value: e.value};
                    }),
                    rn);
            function rn(e, t, n, r, i) {
                void 0 === i && (i = null),
                    (this.isReverse_ = r),
                    (this.resultGenerator_ = i),
                    (this.nodeStack_ = []);
                for (var o = 1; !e.isEmpty(); )
                    if (((o = t ? n(e.key, t) : 1), r && (o *= -1), o < 0))
                        e = this.isReverse_ ? e.left : e.right;
                    else {
                        if (0 === o) {
                            this.nodeStack_.push(e);
                            break;
                        }
                        this.nodeStack_.push(e), (e = this.isReverse_ ? e.right : e.left);
                    }
            }
            var on =
                ((sn.prototype.copy = function(e, t, n, r, i) {
                    return new sn(
                        null != e ? e : this.key,
                        null != t ? t : this.value,
                        null != n ? n : this.color,
                        null != r ? r : this.left,
                        null != i ? i : this.right
                    );
                }),
                (sn.prototype.count = function() {
                    return this.left.count() + 1 + this.right.count();
                }),
                (sn.prototype.isEmpty = function() {
                    return !1;
                }),
                (sn.prototype.inorderTraversal = function(e) {
                    return (
                        this.left.inorderTraversal(e) ||
                        !!e(this.key, this.value) ||
                        this.right.inorderTraversal(e)
                    );
                }),
                (sn.prototype.reverseTraversal = function(e) {
                    return (
                        this.right.reverseTraversal(e) ||
                        e(this.key, this.value) ||
                        this.left.reverseTraversal(e)
                    );
                }),
                (sn.prototype.min_ = function() {
                    return this.left.isEmpty() ? this : this.left.min_();
                }),
                (sn.prototype.minKey = function() {
                    return this.min_().key;
                }),
                (sn.prototype.maxKey = function() {
                    return this.right.isEmpty() ? this.key : this.right.maxKey();
                }),
                (sn.prototype.insert = function(e, t, n) {
                    var r = this,
                        i = n(e, r.key);
                    return (r =
                        i < 0
                            ? r.copy(null, null, null, r.left.insert(e, t, n), null)
                            : 0 === i
                            ? r.copy(null, t, null, null, null)
                            : r.copy(null, null, null, null, r.right.insert(e, t, n))).fixUp_();
                }),
                (sn.prototype.removeMin_ = function() {
                    if (this.left.isEmpty()) return ln.EMPTY_NODE;
                    var e = this;
                    return (e = (e =
                        e.left.isRed_() || e.left.left.isRed_() ? e : e.moveRedLeft_()).copy(
                        null,
                        null,
                        null,
                        e.left.removeMin_(),
                        null
                    )).fixUp_();
                }),
                (sn.prototype.remove = function(e, t) {
                    var n,
                        r = this;
                    if (t(e, r.key) < 0)
                        r = (r =
                            r.left.isEmpty() || r.left.isRed_() || r.left.left.isRed_()
                                ? r
                                : r.moveRedLeft_()).copy(
                            null,
                            null,
                            null,
                            r.left.remove(e, t),
                            null
                        );
                    else {
                        if (
                            0 ===
                            t(
                                e,
                                (r =
                                    (r = r.left.isRed_() ? r.rotateRight_() : r).right.isEmpty() ||
                                    r.right.isRed_() ||
                                    r.right.left.isRed_()
                                        ? r
                                        : r.moveRedRight_()).key
                            )
                        ) {
                            if (r.right.isEmpty()) return ln.EMPTY_NODE;
                            (n = r.right.min_()),
                                (r = r.copy(n.key, n.value, null, null, r.right.removeMin_()));
                        }
                        r = r.copy(null, null, null, null, r.right.remove(e, t));
                    }
                    return r.fixUp_();
                }),
                (sn.prototype.isRed_ = function() {
                    return this.color;
                }),
                (sn.prototype.fixUp_ = function() {
                    var e = this;
                    return (e =
                        (e =
                            e.right.isRed_() && !e.left.isRed_()
                                ? e.rotateLeft_()
                                : e).left.isRed_() && e.left.left.isRed_()
                            ? e.rotateRight_()
                            : e).left.isRed_() && e.right.isRed_()
                        ? e.colorFlip_()
                        : e;
                }),
                (sn.prototype.moveRedLeft_ = function() {
                    var e = this.colorFlip_();
                    return e.right.left.isRed_()
                        ? (e = (e = e.copy(
                              null,
                              null,
                              null,
                              null,
                              e.right.rotateRight_()
                          )).rotateLeft_()).colorFlip_()
                        : e;
                }),
                (sn.prototype.moveRedRight_ = function() {
                    var e = this.colorFlip_();
                    return e.left.left.isRed_() ? (e = e.rotateRight_()).colorFlip_() : e;
                }),
                (sn.prototype.rotateLeft_ = function() {
                    var e = this.copy(null, null, sn.RED, null, this.right.left);
                    return this.right.copy(null, null, this.color, e, null);
                }),
                (sn.prototype.rotateRight_ = function() {
                    var e = this.copy(null, null, sn.RED, this.left.right, null);
                    return this.left.copy(null, null, this.color, null, e);
                }),
                (sn.prototype.colorFlip_ = function() {
                    var e = this.left.copy(null, null, !this.left.color, null, null),
                        t = this.right.copy(null, null, !this.right.color, null, null);
                    return this.copy(null, null, !this.color, e, t);
                }),
                (sn.prototype.checkMaxDepth_ = function() {
                    var e = this.check_();
                    return Math.pow(2, e) <= this.count() + 1;
                }),
                (sn.prototype.check_ = function() {
                    if (this.isRed_() && this.left.isRed_())
                        throw new Error(
                            'Red node has red child(' + this.key + ',' + this.value + ')'
                        );
                    if (this.right.isRed_())
                        throw new Error(
                            'Right child of (' + this.key + ',' + this.value + ') is red'
                        );
                    var e = this.left.check_();
                    if (e !== this.right.check_()) throw new Error('Black depths differ');
                    return e + (this.isRed_() ? 0 : 1);
                }),
                (sn.RED = !0),
                (sn.BLACK = !1),
                sn);
            function sn(e, t, n, r, i) {
                (this.key = e),
                    (this.value = t),
                    (this.color = null != n ? n : sn.RED),
                    (this.left = null != r ? r : ln.EMPTY_NODE),
                    (this.right = null != i ? i : ln.EMPTY_NODE);
            }
            function an() {}
            (an.prototype.copy = function(e, t, n, r, i) {
                return this;
            }),
                (an.prototype.insert = function(e, t, n) {
                    return new on(e, t, null);
                }),
                (an.prototype.remove = function(e, t) {
                    return this;
                }),
                (an.prototype.count = function() {
                    return 0;
                }),
                (an.prototype.isEmpty = function() {
                    return !0;
                }),
                (an.prototype.inorderTraversal = function(e) {
                    return !1;
                }),
                (an.prototype.reverseTraversal = function(e) {
                    return !1;
                }),
                (an.prototype.minKey = function() {
                    return null;
                }),
                (an.prototype.maxKey = function() {
                    return null;
                }),
                (an.prototype.check_ = function() {
                    return 0;
                }),
                (an.prototype.isRed_ = function() {
                    return !1;
                }),
                (vt = an);
            var un,
                ln =
                    ((hn.prototype.insert = function(e, t) {
                        return new hn(
                            this.comparator_,
                            this.root_
                                .insert(e, t, this.comparator_)
                                .copy(null, null, on.BLACK, null, null)
                        );
                    }),
                    (hn.prototype.remove = function(e) {
                        return new hn(
                            this.comparator_,
                            this.root_
                                .remove(e, this.comparator_)
                                .copy(null, null, on.BLACK, null, null)
                        );
                    }),
                    (hn.prototype.get = function(e) {
                        for (var t, n = this.root_; !n.isEmpty(); ) {
                            if (0 === (t = this.comparator_(e, n.key))) return n.value;
                            t < 0 ? (n = n.left) : 0 < t && (n = n.right);
                        }
                        return null;
                    }),
                    (hn.prototype.getPredecessorKey = function(e) {
                        for (var t, n = this.root_, r = null; !n.isEmpty(); ) {
                            if (0 === (t = this.comparator_(e, n.key))) {
                                if (n.left.isEmpty()) return r ? r.key : null;
                                for (n = n.left; !n.right.isEmpty(); ) n = n.right;
                                return n.key;
                            }
                            t < 0 ? (n = n.left) : 0 < t && (n = (r = n).right);
                        }
                        throw new Error(
                            'Attempted to find predecessor key for a nonexistent key.  What gives?'
                        );
                    }),
                    (hn.prototype.isEmpty = function() {
                        return this.root_.isEmpty();
                    }),
                    (hn.prototype.count = function() {
                        return this.root_.count();
                    }),
                    (hn.prototype.minKey = function() {
                        return this.root_.minKey();
                    }),
                    (hn.prototype.maxKey = function() {
                        return this.root_.maxKey();
                    }),
                    (hn.prototype.inorderTraversal = function(e) {
                        return this.root_.inorderTraversal(e);
                    }),
                    (hn.prototype.reverseTraversal = function(e) {
                        return this.root_.reverseTraversal(e);
                    }),
                    (hn.prototype.getIterator = function(e) {
                        return new nn(this.root_, null, this.comparator_, !1, e);
                    }),
                    (hn.prototype.getIteratorFrom = function(e, t) {
                        return new nn(this.root_, e, this.comparator_, !1, t);
                    }),
                    (hn.prototype.getReverseIteratorFrom = function(e, t) {
                        return new nn(this.root_, e, this.comparator_, !0, t);
                    }),
                    (hn.prototype.getReverseIterator = function(e) {
                        return new nn(this.root_, null, this.comparator_, !0, e);
                    }),
                    (hn.EMPTY_NODE = new vt()),
                    hn);
            function hn(e, t) {
                void 0 === t && (t = hn.EMPTY_NODE), (this.comparator_ = e), (this.root_ = t);
            }
            function cn(e, t) {
                return Ie(e.name, t.name);
            }
            function dn(e, t) {
                return Ie(e, t);
            }
            function pn(e) {
                return 'number' == typeof e ? 'number:' + Re(e) : 'string:' + e;
            }
            var fn,
                _n,
                yn,
                vn,
                gn = function(e) {
                    var t;
                    e.isLeafNode()
                        ? ((t = e.val()),
                          g(
                              'string' == typeof t ||
                                  'number' == typeof t ||
                                  ('object' == typeof t && x(t, '.sv')),
                              'Priority must be a string or number.'
                          ))
                        : g(e === un || e.isEmpty(), 'priority of unexpected type.'),
                        g(
                            e === un || e.getPriority().isEmpty(),
                            "Priority nodes can't have a priority of their own."
                        );
                },
                mn =
                    (Object.defineProperty(wn, '__childrenNodeConstructor', {
                        get: function() {
                            return fn;
                        },
                        set: function(e) {
                            fn = e;
                        },
                        enumerable: !1,
                        configurable: !0,
                    }),
                    (wn.prototype.isLeafNode = function() {
                        return !0;
                    }),
                    (wn.prototype.getPriority = function() {
                        return this.priorityNode_;
                    }),
                    (wn.prototype.updatePriority = function(e) {
                        return new wn(this.value_, e);
                    }),
                    (wn.prototype.getImmediateChild = function(e) {
                        return '.priority' === e
                            ? this.priorityNode_
                            : wn.__childrenNodeConstructor.EMPTY_NODE;
                    }),
                    (wn.prototype.getChild = function(e) {
                        return Dt(e)
                            ? this
                            : '.priority' === Tt(e)
                            ? this.priorityNode_
                            : wn.__childrenNodeConstructor.EMPTY_NODE;
                    }),
                    (wn.prototype.hasChild = function() {
                        return !1;
                    }),
                    (wn.prototype.getPredecessorChildName = function(e, t) {
                        return null;
                    }),
                    (wn.prototype.updateImmediateChild = function(e, t) {
                        return '.priority' === e
                            ? this.updatePriority(t)
                            : t.isEmpty() && '.priority' !== e
                            ? this
                            : wn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(
                                  e,
                                  t
                              ).updatePriority(this.priorityNode_);
                    }),
                    (wn.prototype.updateChild = function(e, t) {
                        var n = Tt(e);
                        return null === n
                            ? t
                            : t.isEmpty() && '.priority' !== n
                            ? this
                            : (g(
                                  '.priority' !== n || 1 === It(e),
                                  '.priority must be the last token in a path'
                              ),
                              this.updateImmediateChild(
                                  n,
                                  wn.__childrenNodeConstructor.EMPTY_NODE.updateChild(Pt(e), t)
                              ));
                    }),
                    (wn.prototype.isEmpty = function() {
                        return !1;
                    }),
                    (wn.prototype.numChildren = function() {
                        return 0;
                    }),
                    (wn.prototype.forEachChild = function(e, t) {
                        return !1;
                    }),
                    (wn.prototype.val = function(e) {
                        return e && !this.getPriority().isEmpty()
                            ? {'.value': this.getValue(), '.priority': this.getPriority().val()}
                            : this.getValue();
                    }),
                    (wn.prototype.hash = function() {
                        var e, t;
                        return (
                            null === this.lazyHash_ &&
                                ((e = ''),
                                this.priorityNode_.isEmpty() ||
                                    (e += 'priority:' + pn(this.priorityNode_.val()) + ':'),
                                (e += (t = typeof this.value_) + ':'),
                                (e += 'number' == t ? Re(this.value_) : this.value_),
                                (this.lazyHash_ = oe(e))),
                            this.lazyHash_
                        );
                    }),
                    (wn.prototype.getValue = function() {
                        return this.value_;
                    }),
                    (wn.prototype.compareTo = function(e) {
                        return e === wn.__childrenNodeConstructor.EMPTY_NODE
                            ? 1
                            : e instanceof wn.__childrenNodeConstructor
                            ? -1
                            : (g(e.isLeafNode(), 'Unknown node type'), this.compareToLeafNode_(e));
                    }),
                    (wn.prototype.compareToLeafNode_ = function(e) {
                        var t = typeof e.value_,
                            n = typeof this.value_,
                            r = wn.VALUE_TYPE_ORDER.indexOf(t),
                            i = wn.VALUE_TYPE_ORDER.indexOf(n);
                        return (
                            g(0 <= r, 'Unknown leaf type: ' + t),
                            g(0 <= i, 'Unknown leaf type: ' + n),
                            r === i
                                ? 'object' == n
                                    ? 0
                                    : this.value_ < e.value_
                                    ? -1
                                    : this.value_ === e.value_
                                    ? 0
                                    : 1
                                : i - r
                        );
                    }),
                    (wn.prototype.withIndex = function() {
                        return this;
                    }),
                    (wn.prototype.isIndexed = function() {
                        return !0;
                    }),
                    (wn.prototype.equals = function(e) {
                        return (
                            e === this ||
                            (!!e.isLeafNode() &&
                                this.value_ === e.value_ &&
                                this.priorityNode_.equals(e.priorityNode_))
                        );
                    }),
                    (wn.VALUE_TYPE_ORDER = ['object', 'boolean', 'number', 'string']),
                    wn);
            function wn(e, t) {
                void 0 === t && (t = wn.__childrenNodeConstructor.EMPTY_NODE),
                    (this.value_ = e),
                    (this.priorityNode_ = t),
                    (this.lazyHash_ = null),
                    g(
                        void 0 !== this.value_ && null !== this.value_,
                        "LeafNode shouldn't be created with null/undefined value."
                    ),
                    gn(this.priorityNode_);
            }
            function Cn() {
                return (null !== vn && vn.apply(this, arguments)) || this;
            }
            var bn =
                    (n(Cn, (vn = Xt)),
                    (Cn.prototype.compare = function(e, t) {
                        var n = e.node.getPriority(),
                            r = t.node.getPriority();
                        return 0 === (r = n.compareTo(r)) ? Ie(e.name, t.name) : r;
                    }),
                    (Cn.prototype.isDefinedOn = function(e) {
                        return !e.getPriority().isEmpty();
                    }),
                    (Cn.prototype.indexedValueChanged = function(e, t) {
                        return !e.getPriority().equals(t.getPriority());
                    }),
                    (Cn.prototype.minPost = function() {
                        return Yt.MIN;
                    }),
                    (Cn.prototype.maxPost = function() {
                        return new Yt(Te, new mn('[PRIORITY-POST]', yn));
                    }),
                    (Cn.prototype.makePost = function(e, t) {
                        return (e = _n(e)), new Yt(t, new mn('[PRIORITY-POST]', e));
                    }),
                    (Cn.prototype.toString = function() {
                        return '.priority';
                    }),
                    new Cn()),
                En = Math.log(2),
                Sn =
                    ((Tn.prototype.nextBitIsOne = function() {
                        var e = !(this.bits_ & (1 << this.current_));
                        return this.current_--, e;
                    }),
                    Tn);
            function Tn(e) {
                (this.count = ((t = e + 1), parseInt(Math.log(t) / En, 10))),
                    (this.current_ = this.count - 1);
                var t = ((t = this.count), parseInt(Array(t + 1).join('1'), 2));
                this.bits_ = (e + 1) & t;
            }
            var In,
                Pn,
                Nn = function(l, e, h, t) {
                    l.sort(e);
                    var c = function(e, t) {
                            if (0 == (n = t - e)) return null;
                            if (1 == n)
                                return (
                                    (r = l[e]),
                                    (i = h ? h(r) : r),
                                    new on(i, r.node, on.BLACK, null, null)
                                );
                            var n = parseInt(n / 2, 10) + e,
                                e = c(e, n),
                                t = c(n + 1, t),
                                r = l[n],
                                i = h ? h(r) : r;
                            return new on(i, r.node, on.BLACK, e, t);
                        },
                        n = (function(e) {
                            for (
                                var t = null,
                                    n = null,
                                    i = l.length,
                                    r = function(e, t) {
                                        var n = i - e,
                                            r = i;
                                        (i -= e),
                                            (e = c(1 + n, r)),
                                            (r = l[n]),
                                            (n = h ? h(r) : r),
                                            o(new on(n, r.node, t, null, e));
                                    },
                                    o = function(e) {
                                        t = t ? (t.left = e) : (n = e);
                                    },
                                    s = 0;
                                s < e.count;
                                ++s
                            ) {
                                var a = e.nextBitIsOne(),
                                    u = Math.pow(2, e.count - (s + 1));
                                a ? r(u, on.BLACK) : (r(u, on.BLACK), r(u, on.RED));
                            }
                            return n;
                        })(new Sn(l.length));
                    return new ln(t || e, n);
                },
                Rn = {},
                xn =
                    (Object.defineProperty(kn, 'Default', {
                        get: function() {
                            return (
                                g(bn, 'ChildrenNode.ts has not been loaded'),
                                (In = In || new kn({'.priority': Rn}, {'.priority': bn}))
                            );
                        },
                        enumerable: !1,
                        configurable: !0,
                    }),
                    (kn.prototype.get = function(e) {
                        var t = k(this.indexes_, e);
                        if (!t) throw new Error('No index defined for ' + e);
                        return t instanceof ln ? t : null;
                    }),
                    (kn.prototype.hasIndex = function(e) {
                        return x(this.indexSet_, e.toString());
                    }),
                    (kn.prototype.addIndex = function(e, t) {
                        g(
                            e !== tn,
                            "KeyIndex always exists and isn't meant to be added to the IndexMap."
                        );
                        for (var n = [], r = !1, i = t.getIterator(Yt.Wrap), o = i.getNext(); o; )
                            (r = r || e.isDefinedOn(o.node)), n.push(o), (o = i.getNext());
                        var s = r ? Nn(n, e.getCompare()) : Rn,
                            a = e.toString(),
                            u = l({}, this.indexSet_);
                        return (u[a] = e), ((t = l({}, this.indexes_))[a] = s), new kn(t, u);
                    }),
                    (kn.prototype.addToIndexes = function(s, a) {
                        var u = this;
                        return new kn(
                            O(this.indexes_, function(e, t) {
                                var n = k(u.indexSet_, t);
                                if ((g(n, 'Missing index implementation for ' + t), e !== Rn))
                                    return (e = (n = a.get(s.name))
                                        ? e.remove(new Yt(s.name, n))
                                        : e).insert(s, s.node);
                                if (n.isDefinedOn(s.node)) {
                                    for (
                                        var r = [], i = a.getIterator(Yt.Wrap), o = i.getNext();
                                        o;

                                    )
                                        o.name !== s.name && r.push(o), (o = i.getNext());
                                    return r.push(s), Nn(r, n.getCompare());
                                }
                                return Rn;
                            }),
                            this.indexSet_
                        );
                    }),
                    (kn.prototype.removeFromIndexes = function(n, r) {
                        return new kn(
                            O(this.indexes_, function(e) {
                                if (e === Rn) return e;
                                var t = r.get(n.name);
                                return t ? e.remove(new Yt(n.name, t)) : e;
                            }),
                            this.indexSet_
                        );
                    }),
                    kn);
            function kn(e, t) {
                (this.indexes_ = e), (this.indexSet_ = t);
            }
            var Dn,
                On =
                    (Object.defineProperty(An, 'EMPTY_NODE', {
                        get: function() {
                            return (Pn = Pn || new An(new ln(dn), null, xn.Default));
                        },
                        enumerable: !1,
                        configurable: !0,
                    }),
                    (An.prototype.isLeafNode = function() {
                        return !1;
                    }),
                    (An.prototype.getPriority = function() {
                        return this.priorityNode_ || Pn;
                    }),
                    (An.prototype.updatePriority = function(e) {
                        return this.children_.isEmpty()
                            ? this
                            : new An(this.children_, e, this.indexMap_);
                    }),
                    (An.prototype.getImmediateChild = function(e) {
                        return '.priority' === e
                            ? this.getPriority()
                            : null === (e = this.children_.get(e))
                            ? Pn
                            : e;
                    }),
                    (An.prototype.getChild = function(e) {
                        var t = Tt(e);
                        return null === t ? this : this.getImmediateChild(t).getChild(Pt(e));
                    }),
                    (An.prototype.hasChild = function(e) {
                        return null !== this.children_.get(e);
                    }),
                    (An.prototype.updateImmediateChild = function(e, t) {
                        if ((g(t, 'We should always be passing snapshot nodes'), '.priority' === e))
                            return this.updatePriority(t);
                        var n = new Yt(e, t),
                            r = void 0,
                            i = t.isEmpty()
                                ? ((r = this.children_.remove(e)),
                                  this.indexMap_.removeFromIndexes(n, this.children_))
                                : ((r = this.children_.insert(e, t)),
                                  this.indexMap_.addToIndexes(n, this.children_)),
                            n = r.isEmpty() ? Pn : this.priorityNode_;
                        return new An(r, n, i);
                    }),
                    (An.prototype.updateChild = function(e, t) {
                        var n = Tt(e);
                        return null === n
                            ? t
                            : (g(
                                  '.priority' !== Tt(e) || 1 === It(e),
                                  '.priority must be the last token in a path'
                              ),
                              (t = this.getImmediateChild(n).updateChild(Pt(e), t)),
                              this.updateImmediateChild(n, t));
                    }),
                    (An.prototype.isEmpty = function() {
                        return this.children_.isEmpty();
                    }),
                    (An.prototype.numChildren = function() {
                        return this.children_.count();
                    }),
                    (An.prototype.val = function(n) {
                        if (this.isEmpty()) return null;
                        var r = {},
                            i = 0,
                            o = 0,
                            s = !0;
                        if (
                            (this.forEachChild(bn, function(e, t) {
                                (r[e] = t.val(n)),
                                    i++,
                                    s && An.INTEGER_REGEXP_.test(e)
                                        ? (o = Math.max(o, Number(e)))
                                        : (s = !1);
                            }),
                            !n && s && o < 2 * i)
                        ) {
                            var e,
                                t = [];
                            for (e in r) t[e] = r[e];
                            return t;
                        }
                        return (
                            n &&
                                !this.getPriority().isEmpty() &&
                                (r['.priority'] = this.getPriority().val()),
                            r
                        );
                    }),
                    (An.prototype.hash = function() {
                        var n;
                        return (
                            null === this.lazyHash_ &&
                                ((n = ''),
                                this.getPriority().isEmpty() ||
                                    (n += 'priority:' + pn(this.getPriority().val()) + ':'),
                                this.forEachChild(bn, function(e, t) {
                                    '' !== (t = t.hash()) && (n += ':' + e + ':' + t);
                                }),
                                (this.lazyHash_ = '' === n ? '' : oe(n))),
                            this.lazyHash_
                        );
                    }),
                    (An.prototype.getPredecessorChildName = function(e, t, n) {
                        return (n = this.resolveIndex_(n))
                            ? (t = n.getPredecessorKey(new Yt(e, t)))
                                ? t.name
                                : null
                            : this.children_.getPredecessorKey(e);
                    }),
                    (An.prototype.getFirstChildName = function(e) {
                        return (e = this.resolveIndex_(e))
                            ? (e = e.minKey()) && e.name
                            : this.children_.minKey();
                    }),
                    (An.prototype.getFirstChild = function(e) {
                        return (e = this.getFirstChildName(e))
                            ? new Yt(e, this.children_.get(e))
                            : null;
                    }),
                    (An.prototype.getLastChildName = function(e) {
                        return (e = this.resolveIndex_(e))
                            ? (e = e.maxKey()) && e.name
                            : this.children_.maxKey();
                    }),
                    (An.prototype.getLastChild = function(e) {
                        return (e = this.getLastChildName(e))
                            ? new Yt(e, this.children_.get(e))
                            : null;
                    }),
                    (An.prototype.forEachChild = function(e, t) {
                        return (e = this.resolveIndex_(e))
                            ? e.inorderTraversal(function(e) {
                                  return t(e.name, e.node);
                              })
                            : this.children_.inorderTraversal(t);
                    }),
                    (An.prototype.getIterator = function(e) {
                        return this.getIteratorFrom(e.minPost(), e);
                    }),
                    (An.prototype.getIteratorFrom = function(e, t) {
                        var n = this.resolveIndex_(t);
                        if (n)
                            return n.getIteratorFrom(e, function(e) {
                                return e;
                            });
                        for (
                            var r = this.children_.getIteratorFrom(e.name, Yt.Wrap), i = r.peek();
                            null != i && t.compare(i, e) < 0;

                        )
                            r.getNext(), (i = r.peek());
                        return r;
                    }),
                    (An.prototype.getReverseIterator = function(e) {
                        return this.getReverseIteratorFrom(e.maxPost(), e);
                    }),
                    (An.prototype.getReverseIteratorFrom = function(e, t) {
                        var n = this.resolveIndex_(t);
                        if (n)
                            return n.getReverseIteratorFrom(e, function(e) {
                                return e;
                            });
                        for (
                            var r = this.children_.getReverseIteratorFrom(e.name, Yt.Wrap),
                                i = r.peek();
                            null != i && 0 < t.compare(i, e);

                        )
                            r.getNext(), (i = r.peek());
                        return r;
                    }),
                    (An.prototype.compareTo = function(e) {
                        return this.isEmpty()
                            ? e.isEmpty()
                                ? 0
                                : -1
                            : e.isLeafNode() || e.isEmpty()
                            ? 1
                            : e === Mn
                            ? -1
                            : 0;
                    }),
                    (An.prototype.withIndex = function(e) {
                        return e === tn || this.indexMap_.hasIndex(e)
                            ? this
                            : ((e = this.indexMap_.addIndex(e, this.children_)),
                              new An(this.children_, this.priorityNode_, e));
                    }),
                    (An.prototype.isIndexed = function(e) {
                        return e === tn || this.indexMap_.hasIndex(e);
                    }),
                    (An.prototype.equals = function(e) {
                        if (e === this) return !0;
                        if (e.isLeafNode()) return !1;
                        if (this.getPriority().equals(e.getPriority())) {
                            if (this.children_.count() !== e.children_.count()) return !1;
                            for (
                                var t = this.getIterator(bn),
                                    n = e.getIterator(bn),
                                    r = t.getNext(),
                                    i = n.getNext();
                                r && i;

                            ) {
                                if (r.name !== i.name || !r.node.equals(i.node)) return !1;
                                (r = t.getNext()), (i = n.getNext());
                            }
                            return null === r && null === i;
                        }
                        return !1;
                    }),
                    (An.prototype.resolveIndex_ = function(e) {
                        return e === tn ? null : this.indexMap_.get(e.toString());
                    }),
                    (An.INTEGER_REGEXP_ = /^(0|[1-9]\d*)$/),
                    An);
            function An(e, t, n) {
                (this.children_ = e),
                    (this.priorityNode_ = t),
                    (this.indexMap_ = n),
                    (this.lazyHash_ = null),
                    this.priorityNode_ && gn(this.priorityNode_),
                    this.children_.isEmpty() &&
                        g(
                            !this.priorityNode_ || this.priorityNode_.isEmpty(),
                            'An empty node cannot have a priority'
                        );
            }
            function Ln() {
                return Dn.call(this, new ln(dn), On.EMPTY_NODE, xn.Default) || this;
            }
            var Mn =
                (n(Ln, (Dn = On)),
                (Ln.prototype.compareTo = function(e) {
                    return e === this ? 0 : 1;
                }),
                (Ln.prototype.equals = function(e) {
                    return e === this;
                }),
                (Ln.prototype.getPriority = function() {
                    return this;
                }),
                (Ln.prototype.getImmediateChild = function(e) {
                    return On.EMPTY_NODE;
                }),
                (Ln.prototype.isEmpty = function() {
                    return !1;
                }),
                new Ln());
            Object.defineProperties(Yt, {
                MIN: {value: new Yt(Se, On.EMPTY_NODE)},
                MAX: {value: new Yt(Te, Mn)},
            }),
                (Z.__EMPTY_NODE = On.EMPTY_NODE),
                (mn.__childrenNodeConstructor = On),
                (yn = un = Mn);
            var Fn = !0;
            function qn(n, e) {
                if ((void 0 === e && (e = null), null === n)) return On.EMPTY_NODE;
                if (
                    ('object' == typeof n && '.priority' in n && (e = n['.priority']),
                    g(
                        null === e ||
                            'string' == typeof e ||
                            'number' == typeof e ||
                            ('object' == typeof e && '.sv' in e),
                        'Invalid priority type found: ' + typeof e
                    ),
                    'object' == typeof n &&
                        '.value' in n &&
                        null !== n['.value'] &&
                        (n = n['.value']),
                    'object' != typeof n || '.sv' in n)
                )
                    return new mn(n, qn(e));
                if (n instanceof Array || !Fn) {
                    var r = On.EMPTY_NODE;
                    return (
                        Ne(n, function(e, t) {
                            x(n, e) &&
                                '.' !== e.substring(0, 1) &&
                                ((!(t = qn(t)).isLeafNode() && t.isEmpty()) ||
                                    (r = r.updateImmediateChild(e, t)));
                        }),
                        r.updatePriority(qn(e))
                    );
                }
                var i = [],
                    o = !1;
                if (
                    (Ne(n, function(e, t) {
                        '.' !== e.substring(0, 1) &&
                            ((t = qn(t)).isEmpty() ||
                                ((o = o || !t.getPriority().isEmpty()), i.push(new Yt(e, t))));
                    }),
                    0 === i.length)
                )
                    return On.EMPTY_NODE;
                var t = Nn(
                    i,
                    cn,
                    function(e) {
                        return e.name;
                    },
                    dn
                );
                if (o) {
                    var s = Nn(i, bn.getCompare());
                    return new On(t, qn(e), new xn({'.priority': s}, {'.priority': bn}));
                }
                return new On(t, qn(e), xn.Default);
            }
            _n = qn;
            var Wn,
                Qn,
                jn =
                    (n(Un, (Wn = Xt)),
                    (Un.prototype.extractChild = function(e) {
                        return e.getChild(this.indexPath_);
                    }),
                    (Un.prototype.isDefinedOn = function(e) {
                        return !e.getChild(this.indexPath_).isEmpty();
                    }),
                    (Un.prototype.compare = function(e, t) {
                        var n = this.extractChild(e.node),
                            r = this.extractChild(t.node);
                        return 0 === (r = n.compareTo(r)) ? Ie(e.name, t.name) : r;
                    }),
                    (Un.prototype.makePost = function(e, t) {
                        return (
                            (e = qn(e)),
                            (e = On.EMPTY_NODE.updateChild(this.indexPath_, e)),
                            new Yt(t, e)
                        );
                    }),
                    (Un.prototype.maxPost = function() {
                        var e = On.EMPTY_NODE.updateChild(this.indexPath_, Mn);
                        return new Yt(Te, e);
                    }),
                    (Un.prototype.toString = function() {
                        return Rt(this.indexPath_, 0).join('/');
                    }),
                    Un);
            function Un(e) {
                var t = Wn.call(this) || this;
                return (
                    (t.indexPath_ = e),
                    g(
                        !Dt(e) && '.priority' !== Tt(e),
                        "Can't create PathIndex with empty path or .priority key"
                    ),
                    t
                );
            }
            function Bn() {
                return (null !== Qn && Qn.apply(this, arguments)) || this;
            }
            function Hn(e) {
                if (e === '' + Ae) return '-';
                var t = Le(e);
                if (null != t) return '' + (t + 1);
                for (var n = new Array(e.length), r = 0; r < n.length; r++) n[r] = e.charAt(r);
                if (n.length < 786) return n.push('-'), n.join('');
                for (var i = n.length - 1; 0 <= i && 'z' === n[i]; ) i--;
                return -1 === i
                    ? Te
                    : ((t = n[i]),
                      (t = Gn.charAt(Gn.indexOf(t) + 1)),
                      (n[i] = t),
                      n.slice(0, i + 1).join(''));
            }
            function Vn(e) {
                if (e === '' + Oe) return Se;
                var t = Le(e);
                if (null != t) return '' + (t - 1);
                for (var n = new Array(e.length), r = 0; r < n.length; r++) n[r] = e.charAt(r);
                return '-' === n[n.length - 1]
                    ? 1 === n.length
                        ? '' + Ae
                        : (delete n[n.length - 1], n.join(''))
                    : ((n[n.length - 1] = Gn.charAt(Gn.indexOf(n[n.length - 1]) - 1)),
                      n.join('') + 'z'.repeat(786 - n.length));
            }
            var zn,
                Kn,
                Yn =
                    (n(Bn, (Qn = Xt)),
                    (Bn.prototype.compare = function(e, t) {
                        var n = e.node.compareTo(t.node);
                        return 0 === n ? Ie(e.name, t.name) : n;
                    }),
                    (Bn.prototype.isDefinedOn = function(e) {
                        return !0;
                    }),
                    (Bn.prototype.indexedValueChanged = function(e, t) {
                        return !e.equals(t);
                    }),
                    (Bn.prototype.minPost = function() {
                        return Yt.MIN;
                    }),
                    (Bn.prototype.maxPost = function() {
                        return Yt.MAX;
                    }),
                    (Bn.prototype.makePost = function(e, t) {
                        return (e = qn(e)), new Yt(t, e);
                    }),
                    (Bn.prototype.toString = function() {
                        return '.value';
                    }),
                    new Bn()),
                Gn = '-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz',
                $n =
                    ((zn = 0),
                    (Kn = []),
                    function(e) {
                        var t = e === zn;
                        zn = e;
                        for (var n = new Array(8), r = 7; 0 <= r; r--)
                            (n[r] = Gn.charAt(e % 64)), (e = Math.floor(e / 64));
                        g(0 === e, 'Cannot push at time == 0');
                        var i = n.join('');
                        if (t) {
                            for (r = 11; 0 <= r && 63 === Kn[r]; r--) Kn[r] = 0;
                            Kn[r]++;
                        } else for (r = 0; r < 12; r++) Kn[r] = Math.floor(64 * Math.random());
                        for (r = 0; r < 12; r++) i += Gn.charAt(Kn[r]);
                        return g(20 === i.length, 'nextPushId: Length should be 20.'), i;
                    });
            function Jn(e) {
                return {type: 'value', snapshotNode: e};
            }
            function Xn(e, t) {
                return {type: 'child_added', snapshotNode: t, childName: e};
            }
            function Zn(e, t) {
                return {type: 'child_removed', snapshotNode: t, childName: e};
            }
            function er(e, t, n) {
                return {type: 'child_changed', snapshotNode: t, childName: e, oldSnap: n};
            }
            var tr =
                ((nr.prototype.updateChild = function(e, t, n, r, i, o) {
                    g(
                        e.isIndexed(this.index_),
                        'A node must be indexed if only a child is updated'
                    );
                    var s = e.getImmediateChild(t);
                    return s.getChild(r).equals(n.getChild(r)) && s.isEmpty() === n.isEmpty()
                        ? e
                        : (null != o &&
                              (n.isEmpty()
                                  ? e.hasChild(t)
                                      ? o.trackChildChange(Zn(t, s))
                                      : g(
                                            e.isLeafNode(),
                                            'A child remove without an old child only makes sense on a leaf node'
                                        )
                                  : s.isEmpty()
                                  ? o.trackChildChange(Xn(t, n))
                                  : o.trackChildChange(er(t, n, s))),
                          e.isLeafNode() && n.isEmpty()
                              ? e
                              : e.updateImmediateChild(t, n).withIndex(this.index_));
                }),
                (nr.prototype.updateFullNode = function(r, n, i) {
                    return (
                        null != i &&
                            (r.isLeafNode() ||
                                r.forEachChild(bn, function(e, t) {
                                    n.hasChild(e) || i.trackChildChange(Zn(e, t));
                                }),
                            n.isLeafNode() ||
                                n.forEachChild(bn, function(e, t) {
                                    var n;
                                    r.hasChild(e)
                                        ? (n = r.getImmediateChild(e)).equals(t) ||
                                          i.trackChildChange(er(e, t, n))
                                        : i.trackChildChange(Xn(e, t));
                                })),
                        n.withIndex(this.index_)
                    );
                }),
                (nr.prototype.updatePriority = function(e, t) {
                    return e.isEmpty() ? On.EMPTY_NODE : e.updatePriority(t);
                }),
                (nr.prototype.filtersNodes = function() {
                    return !1;
                }),
                (nr.prototype.getIndexedFilter = function() {
                    return this;
                }),
                (nr.prototype.getIndex = function() {
                    return this.index_;
                }),
                nr);
            function nr(e) {
                this.index_ = e;
            }
            var rr =
                ((ir.prototype.getStartPost = function() {
                    return this.startPost_;
                }),
                (ir.prototype.getEndPost = function() {
                    return this.endPost_;
                }),
                (ir.prototype.matches = function(e) {
                    return (
                        this.index_.compare(this.getStartPost(), e) <= 0 &&
                        this.index_.compare(e, this.getEndPost()) <= 0
                    );
                }),
                (ir.prototype.updateChild = function(e, t, n, r, i, o) {
                    return (
                        this.matches(new Yt(t, n)) || (n = On.EMPTY_NODE),
                        this.indexedFilter_.updateChild(e, t, n, r, i, o)
                    );
                }),
                (ir.prototype.updateFullNode = function(e, t, n) {
                    t.isLeafNode() && (t = On.EMPTY_NODE);
                    var r = (r = t.withIndex(this.index_)).updatePriority(On.EMPTY_NODE),
                        i = this;
                    return (
                        t.forEachChild(bn, function(e, t) {
                            i.matches(new Yt(e, t)) ||
                                (r = r.updateImmediateChild(e, On.EMPTY_NODE));
                        }),
                        this.indexedFilter_.updateFullNode(e, r, n)
                    );
                }),
                (ir.prototype.updatePriority = function(e, t) {
                    return e;
                }),
                (ir.prototype.filtersNodes = function() {
                    return !0;
                }),
                (ir.prototype.getIndexedFilter = function() {
                    return this.indexedFilter_;
                }),
                (ir.prototype.getIndex = function() {
                    return this.index_;
                }),
                (ir.getStartPost_ = function(e) {
                    if (e.hasStart()) {
                        var t = e.getIndexStartName();
                        return e.getIndex().makePost(e.getIndexStartValue(), t);
                    }
                    return e.getIndex().minPost();
                }),
                (ir.getEndPost_ = function(e) {
                    if (e.hasEnd()) {
                        var t = e.getIndexEndName();
                        return e.getIndex().makePost(e.getIndexEndValue(), t);
                    }
                    return e.getIndex().maxPost();
                }),
                ir);
            function ir(e) {
                (this.indexedFilter_ = new tr(e.getIndex())),
                    (this.index_ = e.getIndex()),
                    (this.startPost_ = ir.getStartPost_(e)),
                    (this.endPost_ = ir.getEndPost_(e));
            }
            var or =
                ((sr.prototype.updateChild = function(e, t, n, r, i, o) {
                    return (
                        this.rangedFilter_.matches(new Yt(t, n)) || (n = On.EMPTY_NODE),
                        e.getImmediateChild(t).equals(n)
                            ? e
                            : e.numChildren() < this.limit_
                            ? this.rangedFilter_.getIndexedFilter().updateChild(e, t, n, r, i, o)
                            : this.fullLimitUpdateChild_(e, t, n, i, o)
                    );
                }),
                (sr.prototype.updateFullNode = function(e, t, n) {
                    if (t.isLeafNode() || t.isEmpty()) r = On.EMPTY_NODE.withIndex(this.index_);
                    else if (2 * this.limit_ < t.numChildren() && t.isIndexed(this.index_)) {
                        var r = On.EMPTY_NODE.withIndex(this.index_),
                            i = void 0;
                        i = this.reverse_
                            ? t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(), this.index_)
                            : t.getIteratorFrom(this.rangedFilter_.getStartPost(), this.index_);
                        for (var o = 0; i.hasNext() && o < this.limit_; ) {
                            var s = i.getNext();
                            if (
                                !(this.reverse_
                                    ? this.index_.compare(this.rangedFilter_.getStartPost(), s) <= 0
                                    : this.index_.compare(s, this.rangedFilter_.getEndPost()) <= 0)
                            )
                                break;
                            (r = r.updateImmediateChild(s.name, s.node)), o++;
                        }
                    } else {
                        r = (r = t.withIndex(this.index_)).updatePriority(On.EMPTY_NODE);
                        for (
                            var a,
                                u = void 0,
                                l = void 0,
                                h = void 0,
                                i = void 0,
                                h = this.reverse_
                                    ? ((i = r.getReverseIterator(this.index_)),
                                      (u = this.rangedFilter_.getEndPost()),
                                      (l = this.rangedFilter_.getStartPost()),
                                      (a = this.index_.getCompare()),
                                      function(e, t) {
                                          return a(t, e);
                                      })
                                    : ((i = r.getIterator(this.index_)),
                                      (u = this.rangedFilter_.getStartPost()),
                                      (l = this.rangedFilter_.getEndPost()),
                                      this.index_.getCompare()),
                                o = 0,
                                c = !1;
                            i.hasNext();

                        )
                            (s = i.getNext()),
                                (c = (!c && h(u, s) <= 0) || c) && o < this.limit_ && h(s, l) <= 0
                                    ? o++
                                    : (r = r.updateImmediateChild(s.name, On.EMPTY_NODE));
                    }
                    return this.rangedFilter_.getIndexedFilter().updateFullNode(e, r, n);
                }),
                (sr.prototype.updatePriority = function(e, t) {
                    return e;
                }),
                (sr.prototype.filtersNodes = function() {
                    return !0;
                }),
                (sr.prototype.getIndexedFilter = function() {
                    return this.rangedFilter_.getIndexedFilter();
                }),
                (sr.prototype.getIndex = function() {
                    return this.index_;
                }),
                (sr.prototype.fullLimitUpdateChild_ = function(e, t, n, r, i) {
                    var o,
                        s = this.reverse_
                            ? ((o = this.index_.getCompare()),
                              function(e, t) {
                                  return o(t, e);
                              })
                            : this.index_.getCompare(),
                        a = e;
                    g(a.numChildren() === this.limit_, '');
                    var u = new Yt(t, n),
                        l = this.reverse_
                            ? a.getFirstChild(this.index_)
                            : a.getLastChild(this.index_),
                        h = this.rangedFilter_.matches(u);
                    if (a.hasChild(t)) {
                        for (
                            var c = a.getImmediateChild(t),
                                d = r.getChildAfterChild(this.index_, l, this.reverse_);
                            null != d && (d.name === t || a.hasChild(d.name));

                        )
                            d = r.getChildAfterChild(this.index_, d, this.reverse_);
                        var p = null == d ? 1 : s(d, u);
                        return h && !n.isEmpty() && 0 <= p
                            ? (null != i && i.trackChildChange(er(t, n, c)),
                              a.updateImmediateChild(t, n))
                            : (null != i && i.trackChildChange(Zn(t, c)),
                              (c = a.updateImmediateChild(t, On.EMPTY_NODE)),
                              null != d && this.rangedFilter_.matches(d)
                                  ? (null != i && i.trackChildChange(Xn(d.name, d.node)),
                                    c.updateImmediateChild(d.name, d.node))
                                  : c);
                    }
                    return !n.isEmpty() && h && 0 <= s(l, u)
                        ? (null != i &&
                              (i.trackChildChange(Zn(l.name, l.node)),
                              i.trackChildChange(Xn(t, n))),
                          a.updateImmediateChild(t, n).updateImmediateChild(l.name, On.EMPTY_NODE))
                        : e;
                }),
                sr);
            function sr(e) {
                (this.rangedFilter_ = new rr(e)),
                    (this.index_ = e.getIndex()),
                    (this.limit_ = e.getLimit()),
                    (this.reverse_ = !e.isViewFromLeft());
            }
            var ar =
                ((ur.prototype.hasStart = function() {
                    return this.startSet_;
                }),
                (ur.prototype.hasStartAfter = function() {
                    return this.startAfterSet_;
                }),
                (ur.prototype.hasEndBefore = function() {
                    return this.endBeforeSet_;
                }),
                (ur.prototype.isViewFromLeft = function() {
                    return '' === this.viewFrom_ ? this.startSet_ : 'l' === this.viewFrom_;
                }),
                (ur.prototype.getIndexStartValue = function() {
                    return (
                        g(this.startSet_, 'Only valid if start has been set'), this.indexStartValue_
                    );
                }),
                (ur.prototype.getIndexStartName = function() {
                    return (
                        g(this.startSet_, 'Only valid if start has been set'),
                        this.startNameSet_ ? this.indexStartName_ : Se
                    );
                }),
                (ur.prototype.hasEnd = function() {
                    return this.endSet_;
                }),
                (ur.prototype.getIndexEndValue = function() {
                    return g(this.endSet_, 'Only valid if end has been set'), this.indexEndValue_;
                }),
                (ur.prototype.getIndexEndName = function() {
                    return (
                        g(this.endSet_, 'Only valid if end has been set'),
                        this.endNameSet_ ? this.indexEndName_ : Te
                    );
                }),
                (ur.prototype.hasLimit = function() {
                    return this.limitSet_;
                }),
                (ur.prototype.hasAnchoredLimit = function() {
                    return this.limitSet_ && '' !== this.viewFrom_;
                }),
                (ur.prototype.getLimit = function() {
                    return g(this.limitSet_, 'Only valid if limit has been set'), this.limit_;
                }),
                (ur.prototype.getIndex = function() {
                    return this.index_;
                }),
                (ur.prototype.loadsAllData = function() {
                    return !(this.startSet_ || this.endSet_ || this.limitSet_);
                }),
                (ur.prototype.isDefault = function() {
                    return this.loadsAllData() && this.index_ === bn;
                }),
                (ur.prototype.copy = function() {
                    var e = new ur();
                    return (
                        (e.limitSet_ = this.limitSet_),
                        (e.limit_ = this.limit_),
                        (e.startSet_ = this.startSet_),
                        (e.indexStartValue_ = this.indexStartValue_),
                        (e.startNameSet_ = this.startNameSet_),
                        (e.indexStartName_ = this.indexStartName_),
                        (e.endSet_ = this.endSet_),
                        (e.indexEndValue_ = this.indexEndValue_),
                        (e.endNameSet_ = this.endNameSet_),
                        (e.indexEndName_ = this.indexEndName_),
                        (e.index_ = this.index_),
                        (e.viewFrom_ = this.viewFrom_),
                        e
                    );
                }),
                ur);
            function ur() {
                (this.limitSet_ = !1),
                    (this.startSet_ = !1),
                    (this.startNameSet_ = !1),
                    (this.startAfterSet_ = !1),
                    (this.endSet_ = !1),
                    (this.endNameSet_ = !1),
                    (this.endBeforeSet_ = !1),
                    (this.limit_ = 0),
                    (this.viewFrom_ = ''),
                    (this.indexStartValue_ = null),
                    (this.indexStartName_ = ''),
                    (this.indexEndValue_ = null),
                    (this.indexEndName_ = ''),
                    (this.index_ = bn);
            }
            function lr(e, t, n) {
                return (
                    ((e = e.copy()).startSet_ = !0),
                    void 0 === t && (t = null),
                    (e.indexStartValue_ = t),
                    null != n
                        ? ((e.startNameSet_ = !0), (e.indexStartName_ = n))
                        : ((e.startNameSet_ = !1), (e.indexStartName_ = '')),
                    e
                );
            }
            function hr(e, t, n) {
                return (
                    ((e = e.copy()).endSet_ = !0),
                    void 0 === t && (t = null),
                    (e.indexEndValue_ = t),
                    void 0 !== n
                        ? ((e.endNameSet_ = !0), (e.indexEndName_ = n))
                        : ((e.endNameSet_ = !1), (e.indexEndName_ = '')),
                    e
                );
            }
            function cr(e, t) {
                return ((e = e.copy()).index_ = t), e;
            }
            function dr(e) {
                var t,
                    n = {};
                return (
                    e.isDefault() ||
                        ((t =
                            e.index_ === bn
                                ? '$priority'
                                : e.index_ === Yn
                                ? '$value'
                                : e.index_ === tn
                                ? '$key'
                                : (g(e.index_ instanceof jn, 'Unrecognized index type!'),
                                  e.index_.toString())),
                        (n.orderBy = N(t)),
                        e.startSet_ &&
                            ((n.startAt = N(e.indexStartValue_)),
                            e.startNameSet_ && (n.startAt += ',' + N(e.indexStartName_))),
                        e.endSet_ &&
                            ((n.endAt = N(e.indexEndValue_)),
                            e.endNameSet_ && (n.endAt += ',' + N(e.indexEndName_))),
                        e.limitSet_ &&
                            (e.isViewFromLeft()
                                ? (n.limitToFirst = e.limit_)
                                : (n.limitToLast = e.limit_))),
                    n
                );
            }
            var pr,
                fr =
                    (n(_r, (pr = _t)),
                    (_r.prototype.reportStats = function(e) {
                        throw new Error('Method not implemented.');
                    }),
                    (_r.getListenId_ = function(e, t) {
                        return void 0 !== t
                            ? 'tag$' + t
                            : (g(
                                  e.getQueryParams().isDefault(),
                                  "should have a tag if it's not a default query."
                              ),
                              e.path.toString());
                    }),
                    (_r.prototype.listen = function(e, t, n, r) {
                        var i = this,
                            o = e.path.toString();
                        this.log_('Listen called for ' + o + ' ' + e.queryIdentifier());
                        var s = _r.getListenId_(e, n),
                            a = {};
                        (this.listens_[s] = a),
                            (e = dr(e.getQueryParams())),
                            this.restRequest_(o + '.json', e, function(e, t) {
                                null === (e = 404 === e ? (t = null) : e) &&
                                    i.onDataUpdate_(o, t, !1, n),
                                    k(i.listens_, s) === a &&
                                        r(
                                            e
                                                ? 401 === e
                                                    ? 'permission_denied'
                                                    : 'rest_error:' + e
                                                : 'ok',
                                            null
                                        );
                            });
                    }),
                    (_r.prototype.unlisten = function(e, t) {
                        (t = _r.getListenId_(e, t)), delete this.listens_[t];
                    }),
                    (_r.prototype.get = function(e) {
                        var n = this,
                            t = dr(e.getQueryParams()),
                            r = e.path.toString(),
                            i = new d();
                        return (
                            this.restRequest_(r + '.json', t, function(e, t) {
                                null === (e = 404 === e ? (t = null) : e)
                                    ? (n.onDataUpdate_(r, t, !1, null), i.resolve(t))
                                    : i.reject(new Error(t));
                            }),
                            i.promise
                        );
                    }),
                    (_r.prototype.refreshAuthToken = function(e) {}),
                    (_r.prototype.restRequest_ = function(r, i, o) {
                        var s = this;
                        ((i = void 0 === i ? {} : i).format = 'export'),
                            this.authTokenProvider_.getToken(!1).then(function(e) {
                                (e = e && e.accessToken) && (i.auth = e);
                                var t =
                                    (s.repoInfo_.secure ? 'https://' : 'http://') +
                                    s.repoInfo_.host +
                                    r +
                                    '?ns=' +
                                    s.repoInfo_.namespace +
                                    (function(e) {
                                        for (
                                            var n = [], t = 0, r = Object.entries(e);
                                            t < r.length;
                                            t++
                                        ) {
                                            var i = r[t];
                                            !(function(t, e) {
                                                Array.isArray(e)
                                                    ? e.forEach(function(e) {
                                                          n.push(
                                                              encodeURIComponent(t) +
                                                                  '=' +
                                                                  encodeURIComponent(e)
                                                          );
                                                      })
                                                    : n.push(
                                                          encodeURIComponent(t) +
                                                              '=' +
                                                              encodeURIComponent(e)
                                                      );
                                            })(i[0], i[1]);
                                        }
                                        return n.length ? '&' + n.join('&') : '';
                                    })(i);
                                s.log_('Sending REST request for ' + t);
                                var n = new XMLHttpRequest();
                                (n.onreadystatechange = function() {
                                    if (o && 4 === n.readyState) {
                                        s.log_(
                                            'REST Response for ' + t + ' received. status:',
                                            n.status,
                                            'response:',
                                            n.responseText
                                        );
                                        var e = null;
                                        if (200 <= n.status && n.status < 300) {
                                            try {
                                                e = P(n.responseText);
                                            } catch (e) {
                                                Ee(
                                                    'Failed to parse JSON response for ' +
                                                        t +
                                                        ': ' +
                                                        n.responseText
                                                );
                                            }
                                            o(null, e);
                                        } else
                                            401 !== n.status &&
                                                404 !== n.status &&
                                                Ee(
                                                    'Got unsuccessful REST response for ' +
                                                        t +
                                                        ' Status: ' +
                                                        n.status
                                                ),
                                                o(n.status);
                                        o = null;
                                    }
                                }),
                                    n.open('GET', t, !0),
                                    n.send();
                            });
                    }),
                    _r);
            function _r(e, t, n) {
                var r = pr.call(this) || this;
                return (
                    (r.repoInfo_ = e),
                    (r.onDataUpdate_ = t),
                    (r.authTokenProvider_ = n),
                    (r.log_ = be('p:rest:')),
                    (r.listens_ = {}),
                    r
                );
            }
            var yr =
                ((vr.prototype.getNode = function(e) {
                    return this.rootNode_.getChild(e);
                }),
                (vr.prototype.updateSnapshot = function(e, t) {
                    this.rootNode_ = this.rootNode_.updateChild(e, t);
                }),
                vr);
            function vr() {
                this.rootNode_ = On.EMPTY_NODE;
            }
            function gr() {
                return {value: null, children: new Map()};
            }
            function mr(e, t, n) {
                var r;
                Dt(t)
                    ? ((e.value = n), e.children.clear())
                    : null !== e.value
                    ? (e.value = e.value.updateChild(t, n))
                    : ((r = Tt(t)),
                      e.children.has(r) || e.children.set(r, gr()),
                      mr(e.children.get(r), (t = Pt(t)), n));
            }
            function wr(e, n, r) {
                var i;
                null !== e.value
                    ? r(n, e.value)
                    : ((i = function(e, t) {
                          wr(t, new bt(n.toString() + '/' + e), r);
                      }),
                      e.children.forEach(function(e, t) {
                          i(t, e);
                      }));
            }
            var Cr =
                ((br.prototype.get = function() {
                    var e = this.collection_.get(),
                        n = l({}, e);
                    return (
                        this.last_ &&
                            Ne(this.last_, function(e, t) {
                                n[e] = n[e] - t;
                            }),
                        (this.last_ = e),
                        n
                    );
                }),
                br);
            function br(e) {
                (this.collection_ = e), (this.last_ = null);
            }
            var Er,
                Sr =
                    ((Tr.prototype.reportStats_ = function() {
                        var n = this,
                            e = this.statsListener_.get(),
                            r = {},
                            i = !1;
                        Ne(e, function(e, t) {
                            0 < t && x(n.statsToReport_, e) && ((r[e] = t), (i = !0));
                        }),
                            i && this.server_.reportStats(r),
                            xe(this.reportStats_.bind(this), Math.floor(2 * Math.random() * 3e5));
                    }),
                    Tr);
            function Tr(e, t) {
                (this.server_ = t),
                    (this.statsToReport_ = {}),
                    (this.statsListener_ = new Cr(e)),
                    (e = 1e4 + 2e4 * Math.random()),
                    xe(this.reportStats_.bind(this), Math.floor(e));
            }
            function Ir() {
                return {fromUser: !0, fromServer: !1, queryId: null, tagged: !1};
            }
            function Pr() {
                return {fromUser: !1, fromServer: !0, queryId: null, tagged: !1};
            }
            function Nr(e) {
                return {fromUser: !1, fromServer: !0, queryId: e, tagged: !0};
            }
            ((_t = Er = Er || {})[(_t.OVERWRITE = 0)] = 'OVERWRITE'),
                (_t[(_t.MERGE = 1)] = 'MERGE'),
                (_t[(_t.ACK_USER_WRITE = 2)] = 'ACK_USER_WRITE'),
                (_t[(_t.LISTEN_COMPLETE = 3)] = 'LISTEN_COMPLETE');
            var Rr =
                ((xr.prototype.operationForChild = function(e) {
                    if (Dt(this.path)) {
                        if (null != this.affectedTree.value)
                            return (
                                g(
                                    this.affectedTree.children.isEmpty(),
                                    'affectedTree should not have overlapping affected paths.'
                                ),
                                this
                            );
                        var t = this.affectedTree.subtree(new bt(e));
                        return new xr(St(), t, this.revert);
                    }
                    return (
                        g(Tt(this.path) === e, 'operationForChild called for unrelated child.'),
                        new xr(Pt(this.path), this.affectedTree, this.revert)
                    );
                }),
                xr);
            function xr(e, t, n) {
                (this.path = e),
                    (this.affectedTree = t),
                    (this.revert = n),
                    (this.type = Er.ACK_USER_WRITE),
                    (this.source = Ir());
            }
            var kr =
                ((Dr.prototype.operationForChild = function(e) {
                    return Dt(this.path)
                        ? new Dr(this.source, St())
                        : new Dr(this.source, Pt(this.path));
                }),
                Dr);
            function Dr(e, t) {
                (this.source = e), (this.path = t), (this.type = Er.LISTEN_COMPLETE);
            }
            var Or =
                ((Ar.prototype.operationForChild = function(e) {
                    return Dt(this.path)
                        ? new Ar(this.source, St(), this.snap.getImmediateChild(e))
                        : new Ar(this.source, Pt(this.path), this.snap);
                }),
                Ar);
            function Ar(e, t, n) {
                (this.source = e), (this.path = t), (this.snap = n), (this.type = Er.OVERWRITE);
            }
            var Lr =
                ((Mr.prototype.operationForChild = function(e) {
                    if (Dt(this.path)) {
                        var t = this.children.subtree(new bt(e));
                        return t.isEmpty()
                            ? null
                            : t.value
                            ? new Or(this.source, St(), t.value)
                            : new Mr(this.source, St(), t);
                    }
                    return (
                        g(
                            Tt(this.path) === e,
                            "Can't get a merge for a child not on the path of the operation"
                        ),
                        new Mr(this.source, Pt(this.path), this.children)
                    );
                }),
                (Mr.prototype.toString = function() {
                    return (
                        'Operation(' +
                        this.path +
                        ': ' +
                        this.source.toString() +
                        ' merge: ' +
                        this.children.toString() +
                        ')'
                    );
                }),
                Mr);
            function Mr(e, t, n) {
                (this.source = e), (this.path = t), (this.children = n), (this.type = Er.MERGE);
            }
            var Fr =
                ((qr.prototype.isFullyInitialized = function() {
                    return this.fullyInitialized_;
                }),
                (qr.prototype.isFiltered = function() {
                    return this.filtered_;
                }),
                (qr.prototype.isCompleteForPath = function(e) {
                    return Dt(e)
                        ? this.isFullyInitialized() && !this.filtered_
                        : ((e = Tt(e)), this.isCompleteForChild(e));
                }),
                (qr.prototype.isCompleteForChild = function(e) {
                    return (this.isFullyInitialized() && !this.filtered_) || this.node_.hasChild(e);
                }),
                (qr.prototype.getNode = function() {
                    return this.node_;
                }),
                qr);
            function qr(e, t, n) {
                (this.node_ = e), (this.fullyInitialized_ = t), (this.filtered_ = n);
            }
            function Wr(e) {
                (this.query_ = e), (this.index_ = this.query_.getQueryParams().getIndex());
            }
            var Qr;
            function jr(r, i, t, e, o, s) {
                (e = e.filter(function(e) {
                    return e.type === t;
                })).sort(function(e, t) {
                    return (function(e, t, n) {
                        if (null == t.childName || null == n.childName)
                            throw m('Should only compare child_ events.');
                        return (
                            (t = new Yt(t.childName, t.snapshotNode)),
                            (n = new Yt(n.childName, n.snapshotNode)),
                            e.index_.compare(t, n)
                        );
                    })(r, e, t);
                }),
                    e.forEach(function(t) {
                        var e,
                            n =
                                ('value' === (e = t).type ||
                                    'child_removed' === e.type ||
                                    (e.prevName = s.getPredecessorChildName(
                                        e.childName,
                                        e.snapshotNode,
                                        r.index_
                                    )),
                                e);
                        o.forEach(function(e) {
                            e.respondsTo(t.type) && i.push(e.createEvent(n, r.query_));
                        });
                    });
            }
            function Ur(e, t) {
                return {eventCache: e, serverCache: t};
            }
            function Br(e, t, n, r) {
                return Ur(new Fr(t, n, r), e.serverCache);
            }
            function Hr(e, t, n, r) {
                return Ur(e.eventCache, new Fr(t, n, r));
            }
            function Vr(e) {
                return e.eventCache.isFullyInitialized() ? e.eventCache.getNode() : null;
            }
            function zr(e) {
                return e.serverCache.isFullyInitialized() ? e.serverCache.getNode() : null;
            }
            var Kr =
                ((Yr.fromObject = function(e) {
                    var n = new Yr(null);
                    return (
                        Ne(e, function(e, t) {
                            n = n.set(new bt(e), t);
                        }),
                        n
                    );
                }),
                (Yr.prototype.isEmpty = function() {
                    return null === this.value && this.children.isEmpty();
                }),
                (Yr.prototype.findRootMostMatchingPathAndValue = function(e, t) {
                    if (null != this.value && t(this.value)) return {path: St(), value: this.value};
                    if (Dt(e)) return null;
                    var n = Tt(e),
                        r = this.children.get(n);
                    return null === r || null == (t = r.findRootMostMatchingPathAndValue(Pt(e), t))
                        ? null
                        : {path: kt(new bt(n), t.path), value: t.value};
                }),
                (Yr.prototype.findRootMostValueAndPath = function(e) {
                    return this.findRootMostMatchingPathAndValue(e, function() {
                        return !0;
                    });
                }),
                (Yr.prototype.subtree = function(e) {
                    if (Dt(e)) return this;
                    var t = Tt(e);
                    return null !== (t = this.children.get(t)) ? t.subtree(Pt(e)) : new Yr(null);
                }),
                (Yr.prototype.set = function(e, t) {
                    if (Dt(e)) return new Yr(t, this.children);
                    var n = Tt(e),
                        t = (this.children.get(n) || new Yr(null)).set(Pt(e), t),
                        t = this.children.insert(n, t);
                    return new Yr(this.value, t);
                }),
                (Yr.prototype.remove = function(e) {
                    if (Dt(e))
                        return this.children.isEmpty() ? new Yr(null) : new Yr(null, this.children);
                    var t = Tt(e),
                        n = this.children.get(t);
                    return n
                        ? ((n = n.remove(Pt(e))),
                          (e = void 0),
                          (e = n.isEmpty() ? this.children.remove(t) : this.children.insert(t, n)),
                          null === this.value && e.isEmpty() ? new Yr(null) : new Yr(this.value, e))
                        : this;
                }),
                (Yr.prototype.get = function(e) {
                    if (Dt(e)) return this.value;
                    var t = Tt(e);
                    return (t = this.children.get(t)) ? t.get(Pt(e)) : null;
                }),
                (Yr.prototype.setTree = function(e, t) {
                    if (Dt(e)) return t;
                    var n = Tt(e),
                        e = (this.children.get(n) || new Yr(null)).setTree(Pt(e), t),
                        t = void 0,
                        t = e.isEmpty() ? this.children.remove(n) : this.children.insert(n, e);
                    return new Yr(this.value, t);
                }),
                (Yr.prototype.fold = function(e) {
                    return this.fold_(St(), e);
                }),
                (Yr.prototype.fold_ = function(n, r) {
                    var i = {};
                    return (
                        this.children.inorderTraversal(function(e, t) {
                            i[e] = t.fold_(kt(n, e), r);
                        }),
                        r(n, this.value, i)
                    );
                }),
                (Yr.prototype.findOnPath = function(e, t) {
                    return this.findOnPath_(e, St(), t);
                }),
                (Yr.prototype.findOnPath_ = function(e, t, n) {
                    var r = !!this.value && n(t, this.value);
                    if (r) return r;
                    if (Dt(e)) return null;
                    var i = Tt(e);
                    return (r = this.children.get(i)) ? r.findOnPath_(Pt(e), kt(t, i), n) : null;
                }),
                (Yr.prototype.foreachOnPath = function(e, t) {
                    return this.foreachOnPath_(e, St(), t);
                }),
                (Yr.prototype.foreachOnPath_ = function(e, t, n) {
                    if (Dt(e)) return this;
                    this.value && n(t, this.value);
                    var r = Tt(e),
                        i = this.children.get(r);
                    return i ? i.foreachOnPath_(Pt(e), kt(t, r), n) : new Yr(null);
                }),
                (Yr.prototype.foreach = function(e) {
                    this.foreach_(St(), e);
                }),
                (Yr.prototype.foreach_ = function(n, r) {
                    this.children.inorderTraversal(function(e, t) {
                        t.foreach_(kt(n, e), r);
                    }),
                        this.value && r(n, this.value);
                }),
                (Yr.prototype.foreachChild = function(n) {
                    this.children.inorderTraversal(function(e, t) {
                        t.value && n(e, t.value);
                    });
                }),
                Yr);
            function Yr(e, t) {
                void 0 === t && (t = Qr = Qr || new ln(le)), (this.value = e), (this.children = t);
            }
            var Gr =
                (($r.empty = function() {
                    return new $r(new Kr(null));
                }),
                $r);
            function $r(e) {
                this.writeTree_ = e;
            }
            function Jr(e, t, n) {
                if (Dt(t)) return new Gr(new Kr(n));
                if (null == (o = e.writeTree_.findRootMostValueAndPath(t)))
                    return (n = new Kr(n)), (n = e.writeTree_.setTree(t, n)), new Gr(n);
                var r = o.path,
                    i = o.value,
                    o = Ot(r, t),
                    i = i.updateChild(o, n);
                return new Gr(e.writeTree_.set(r, i));
            }
            function Xr(e, n, t) {
                var r = e;
                return (
                    Ne(t, function(e, t) {
                        r = Jr(r, kt(n, e), t);
                    }),
                    r
                );
            }
            function Zr(e, t) {
                return Dt(t)
                    ? Gr.empty()
                    : ((t = e.writeTree_.setTree(t, new Kr(null))), new Gr(t));
            }
            function ei(e, t) {
                return null != ti(e, t);
            }
            function ti(e, t) {
                var n = e.writeTree_.findRootMostValueAndPath(t);
                return null != n ? e.writeTree_.get(n.path).getChild(Ot(n.path, t)) : null;
            }
            function ni(e) {
                var n = [],
                    t = e.writeTree_.value;
                return (
                    null != t
                        ? t.isLeafNode() ||
                          t.forEachChild(bn, function(e, t) {
                              n.push(new Yt(e, t));
                          })
                        : e.writeTree_.children.inorderTraversal(function(e, t) {
                              null != t.value && n.push(new Yt(e, t.value));
                          }),
                    n
                );
            }
            function ri(e, t) {
                if (Dt(t)) return e;
                var n = ti(e, t);
                return new Gr(null != n ? new Kr(n) : e.writeTree_.subtree(t));
            }
            function ii(e) {
                return e.writeTree_.isEmpty();
            }
            function oi(e, t) {
                return (function n(r, e, i) {
                    if (null != e.value) return i.updateChild(r, e.value);
                    var o = null;
                    return (
                        e.children.inorderTraversal(function(e, t) {
                            '.priority' === e
                                ? (g(null !== t.value, 'Priority writes must always be leaf nodes'),
                                  (o = t.value))
                                : (i = n(kt(r, e), t, i));
                        }),
                        (i =
                            i.getChild(r).isEmpty() || null === o
                                ? i
                                : i.updateChild(kt(r, '.priority'), o))
                    );
                })(St(), e.writeTree_, t);
            }
            function si(e, t) {
                return yi(t, e);
            }
            function ai(e) {
                return e.visible;
            }
            function ui(e, t, n) {
                for (var r = Gr.empty(), i = 0; i < e.length; ++i) {
                    var o = e[i];
                    if (t(o)) {
                        var s = o.path,
                            a = void 0;
                        if (o.snap)
                            Mt(n, s)
                                ? (r = Jr(r, (a = Ot(n, s)), o.snap))
                                : Mt(s, n) &&
                                  ((a = Ot(s, n)), (r = Jr(r, St(), o.snap.getChild(a))));
                        else {
                            if (!o.children) throw m('WriteRecord should have .snap or .children');
                            Mt(n, s)
                                ? (r = Xr(r, (a = Ot(n, s)), o.children))
                                : Mt(s, n) &&
                                  (Dt((a = Ot(s, n)))
                                      ? (r = Xr(r, St(), o.children))
                                      : (o = k(o.children, Tt(a))) &&
                                        ((a = o.getChild(Pt(a))), (r = Jr(r, St(), a))));
                        }
                    }
                }
                return r;
            }
            function li(e, t, n, r, i) {
                if (r || i) {
                    var o = ri(e.visibleWrites, t);
                    return !i && ii(o)
                        ? n
                        : i || null != n || ei(o, St())
                        ? oi(
                              ui(
                                  e.allWrites,
                                  function(e) {
                                      return (
                                          (e.visible || i) &&
                                          (!r || !~r.indexOf(e.writeId)) &&
                                          (Mt(e.path, t) || Mt(t, e.path))
                                      );
                                  },
                                  t
                              ),
                              n || On.EMPTY_NODE
                          )
                        : null;
                }
                return null != (o = ti(e.visibleWrites, t))
                    ? o
                    : ii((e = ri(e.visibleWrites, t)))
                    ? n
                    : null != n || ei(e, St())
                    ? oi(e, n || On.EMPTY_NODE)
                    : null;
            }
            function hi(e, t, n, r) {
                return li(e.writeTree, e.treePath, t, n, r);
            }
            function ci(e, t) {
                return (function(e, t, n) {
                    var r = On.EMPTY_NODE,
                        i = ti(e.visibleWrites, t);
                    if (i)
                        return (
                            i.isLeafNode() ||
                                i.forEachChild(bn, function(e, t) {
                                    r = r.updateImmediateChild(e, t);
                                }),
                            r
                        );
                    if (n) {
                        var o = ri(e.visibleWrites, t);
                        return (
                            n.forEachChild(bn, function(e, t) {
                                (t = oi(ri(o, new bt(e)), t)), (r = r.updateImmediateChild(e, t));
                            }),
                            ni(o).forEach(function(e) {
                                r = r.updateImmediateChild(e.name, e.node);
                            }),
                            r
                        );
                    }
                    return (
                        ni(ri(e.visibleWrites, t)).forEach(function(e) {
                            r = r.updateImmediateChild(e.name, e.node);
                        }),
                        r
                    );
                })(e.writeTree, e.treePath, t);
            }
            function di(e, t, n, r) {
                return (
                    (i = e.writeTree),
                    (e = e.treePath),
                    g(n || r, 'Either existingEventSnap or existingServerSnap must exist'),
                    (e = kt(e, t)),
                    ei(i.visibleWrites, e)
                        ? null
                        : ii((e = ri(i.visibleWrites, e)))
                        ? r.getChild(t)
                        : oi(e, r.getChild(t))
                );
                var i;
            }
            function pi(e, t) {
                return (n = e.writeTree), (t = kt(e.treePath, t)), ti(n.visibleWrites, t);
                var n;
            }
            function fi(e, t, n) {
                return (
                    (r = e.writeTree),
                    (i = e.treePath),
                    (e = n),
                    (t = kt(i, (n = t))),
                    null != (i = ti(r.visibleWrites, t))
                        ? i
                        : e.isCompleteForChild(n)
                        ? oi(ri(r.visibleWrites, t), e.getNode().getImmediateChild(n))
                        : null
                );
                var r, i;
            }
            function _i(e, t) {
                return yi(kt(e.treePath, t), e.writeTree);
            }
            function yi(e, t) {
                return {treePath: e, writeTree: t};
            }
            var vi =
                ((gi.prototype.trackChildChange = function(e) {
                    var t = e.type,
                        n = e.childName;
                    g(
                        'child_added' === t || 'child_changed' === t || 'child_removed' === t,
                        'Only child changes supported for tracking'
                    ),
                        g('.priority' !== n, 'Only non-priority child changes can be tracked.');
                    var r = this.changeMap.get(n);
                    if (r) {
                        var i = r.type;
                        if ('child_added' === t && 'child_removed' === i)
                            this.changeMap.set(n, er(n, e.snapshotNode, r.snapshotNode));
                        else if ('child_removed' === t && 'child_added' === i)
                            this.changeMap.delete(n);
                        else if ('child_removed' === t && 'child_changed' === i)
                            this.changeMap.set(n, Zn(n, r.oldSnap));
                        else if ('child_changed' === t && 'child_added' === i)
                            this.changeMap.set(n, Xn(n, e.snapshotNode));
                        else {
                            if ('child_changed' !== t || 'child_changed' !== i)
                                throw m(
                                    'Illegal combination of changes: ' + e + ' occurred after ' + r
                                );
                            this.changeMap.set(n, er(n, e.snapshotNode, r.oldSnap));
                        }
                    } else this.changeMap.set(n, e);
                }),
                (gi.prototype.getChanges = function() {
                    return Array.from(this.changeMap.values());
                }),
                gi);
            function gi() {
                this.changeMap = new Map();
            }
            function mi() {}
            var wi =
                    ((mi.prototype.getCompleteChild = function(e) {
                        return null;
                    }),
                    (mi.prototype.getChildAfterChild = function(e, t, n) {
                        return null;
                    }),
                    new mi()),
                Ci =
                    ((bi.prototype.getCompleteChild = function(e) {
                        var t = this.viewCache_.eventCache;
                        return t.isCompleteForChild(e)
                            ? t.getNode().getImmediateChild(e)
                            : ((t =
                                  null != this.optCompleteServerCache_
                                      ? new Fr(this.optCompleteServerCache_, !0, !1)
                                      : this.viewCache_.serverCache),
                              fi(this.writes_, e, t));
                    }),
                    (bi.prototype.getChildAfterChild = function(e, t, n) {
                        var r,
                            i,
                            o,
                            s =
                                null != this.optCompleteServerCache_
                                    ? this.optCompleteServerCache_
                                    : zr(this.viewCache_);
                        return 0 ===
                            (e =
                                ((r = this.writes_),
                                (i = s),
                                (o = t),
                                (s = 1),
                                (t = n),
                                (n = e),
                                (function(e, t, n, r, i, o, s) {
                                    var a;
                                    if (null != (t = ti((e = ri(e.visibleWrites, t)), St()))) a = t;
                                    else {
                                        if (null == n) return [];
                                        a = oi(e, n);
                                    }
                                    if ((a = a.withIndex(s)).isEmpty() || a.isLeafNode()) return [];
                                    for (
                                        var u = [],
                                            l = s.getCompare(),
                                            h = o
                                                ? a.getReverseIteratorFrom(r, s)
                                                : a.getIteratorFrom(r, s),
                                            c = h.getNext();
                                        c && u.length < i;

                                    )
                                        0 !== l(c, r) && u.push(c), (c = h.getNext());
                                    return u;
                                })(r.writeTree, r.treePath, i, o, s, t, n))).length
                            ? null
                            : e[0];
                    }),
                    bi);
            function bi(e, t, n) {
                void 0 === n && (n = null),
                    (this.writes_ = e),
                    (this.viewCache_ = t),
                    (this.optCompleteServerCache_ = n);
            }
            function Ei(e, t, n, r, i, o) {
                var s = t.eventCache;
                if (null != pi(r, n)) return t;
                var a,
                    u,
                    l,
                    h,
                    c = void 0,
                    d = Dt(n)
                        ? (g(
                              t.serverCache.isFullyInitialized(),
                              'If change path is empty, we must have complete server data'
                          ),
                          t.serverCache.isFiltered()
                              ? ((a = ci(r, (a = zr(t)) instanceof On ? a : On.EMPTY_NODE)),
                                e.filter.updateFullNode(t.eventCache.getNode(), a, o))
                              : ((u = hi(r, zr(t))),
                                e.filter.updateFullNode(t.eventCache.getNode(), u, o)))
                        : '.priority' === (u = Tt(n))
                        ? (g(1 === It(n), "Can't have a priority with additional path components"),
                          null != (h = di(r, n, (l = s.getNode()), (c = t.serverCache.getNode())))
                              ? e.filter.updatePriority(l, h)
                              : s.getNode())
                        : ((l = Pt(n)),
                          (h = void 0),
                          null !=
                          (h = s.isCompleteForChild(u)
                              ? ((c = t.serverCache.getNode()),
                                null != (c = di(r, n, s.getNode(), c))
                                    ? s
                                          .getNode()
                                          .getImmediateChild(u)
                                          .updateChild(l, c)
                                    : s.getNode().getImmediateChild(u))
                              : fi(r, u, t.serverCache))
                              ? e.filter.updateChild(s.getNode(), u, h, l, i, o)
                              : s.getNode());
                return Br(t, d, s.isFullyInitialized() || Dt(n), e.filter.filtersNodes());
            }
            function Si(e, t, n, r, i, o, s, a) {
                var u = t.serverCache,
                    l = s ? e.filter : e.filter.getIndexedFilter();
                if (Dt(n)) c = l.updateFullNode(u.getNode(), r, null);
                else if (l.filtersNodes() && !u.isFiltered())
                    var h = u.getNode().updateChild(n, r),
                        c = l.updateFullNode(u.getNode(), h, null);
                else {
                    if (((s = Tt(n)), !u.isCompleteForPath(n) && 1 < It(n))) return t;
                    (h = Pt(n)),
                        (r = u
                            .getNode()
                            .getImmediateChild(s)
                            .updateChild(h, r)),
                        (c =
                            '.priority' === s
                                ? l.updatePriority(u.getNode(), r)
                                : l.updateChild(u.getNode(), s, r, h, wi, null));
                }
                return Ei(
                    e,
                    (l = Hr(t, c, u.isFullyInitialized() || Dt(n), l.filtersNodes())),
                    n,
                    i,
                    new Ci(i, l, o),
                    a
                );
            }
            function Ti(e, t, n, r, i, o, s) {
                var a,
                    u,
                    l = t.eventCache,
                    h = new Ci(i, t, o);
                return Dt(n)
                    ? ((u = e.filter.updateFullNode(t.eventCache.getNode(), r, s)),
                      Br(t, u, !0, e.filter.filtersNodes()))
                    : '.priority' === (a = Tt(n))
                    ? ((u = e.filter.updatePriority(t.eventCache.getNode(), r)),
                      Br(t, u, l.isFullyInitialized(), l.isFiltered()))
                    : ((i = Pt(n)),
                      (o = l.getNode().getImmediateChild(a)),
                      (u = void 0),
                      (u = Dt(i)
                          ? r
                          : null != (n = h.getCompleteChild(a))
                          ? '.priority' === Nt(i) && n.getChild(xt(i)).isEmpty()
                              ? n
                              : n.updateChild(i, r)
                          : On.EMPTY_NODE),
                      o.equals(u)
                          ? t
                          : Br(
                                t,
                                e.filter.updateChild(l.getNode(), a, u, i, h, s),
                                l.isFullyInitialized(),
                                e.filter.filtersNodes()
                            ));
            }
            function Ii(e, t) {
                return e.eventCache.isCompleteForChild(t);
            }
            function Pi(e, n, t) {
                return (
                    t.foreach(function(e, t) {
                        n = n.updateChild(e, t);
                    }),
                    n
                );
            }
            function Ni(r, i, e, t, o, s, a, u) {
                if (i.serverCache.getNode().isEmpty() && !i.serverCache.isFullyInitialized())
                    return i;
                var l = i,
                    t = Dt(e) ? t : new Kr(null).setTree(e, t),
                    h = i.serverCache.getNode();
                return (
                    t.children.inorderTraversal(function(e, t) {
                        h.hasChild(e) &&
                            ((t = Pi(0, i.serverCache.getNode().getImmediateChild(e), t)),
                            (l = Si(r, l, new bt(e), t, o, s, a, u)));
                    }),
                    t.children.inorderTraversal(function(e, t) {
                        var n = !i.serverCache.isCompleteForChild(e) && void 0 === t.value;
                        h.hasChild(e) ||
                            n ||
                            ((t = Pi(0, i.serverCache.getNode().getImmediateChild(e), t)),
                            (l = Si(r, l, new bt(e), t, o, s, a, u)));
                    }),
                    l
                );
            }
            var Ri,
                xi =
                    (Object.defineProperty(ki.prototype, 'query', {
                        get: function() {
                            return this.query_;
                        },
                        enumerable: !1,
                        configurable: !0,
                    }),
                    ki);
            function ki(e, t) {
                (this.query_ = e), (this.eventRegistrations_ = []);
                var n = this.query_.getQueryParams(),
                    r = new tr(n.getIndex()),
                    i = (o = n).loadsAllData()
                        ? new tr(o.getIndex())
                        : new (o.hasLimit() ? or : rr)(o);
                this.processor_ = {filter: i};
                var e = t.serverCache,
                    n = t.eventCache,
                    o = r.updateFullNode(On.EMPTY_NODE, e.getNode(), null),
                    t = i.updateFullNode(On.EMPTY_NODE, n.getNode(), null),
                    r = new Fr(o, e.isFullyInitialized(), r.filtersNodes()),
                    i = new Fr(t, n.isFullyInitialized(), i.filtersNodes());
                (this.viewCache_ = Ur(i, r)), (this.eventGenerator_ = new Wr(this.query_));
            }
            function Di(e) {
                return 0 === e.eventRegistrations_.length;
            }
            function Oi(e, t, n) {
                var r,
                    i = [];
                if (
                    (n &&
                        (g(null == t, 'A cancel should cancel all event registrations.'),
                        (r = e.query.path),
                        e.eventRegistrations_.forEach(function(e) {
                            (e = e.createCancelEvent(n, r)) && i.push(e);
                        })),
                    t)
                ) {
                    for (var o = [], s = 0; s < e.eventRegistrations_.length; ++s) {
                        var a = e.eventRegistrations_[s];
                        if (a.matches(t)) {
                            if (t.hasAnyCallback()) {
                                o = o.concat(e.eventRegistrations_.slice(s + 1));
                                break;
                            }
                        } else o.push(a);
                    }
                    e.eventRegistrations_ = o;
                } else e.eventRegistrations_ = [];
                return i;
            }
            function Ai(e, t, n, r) {
                t.type === Er.MERGE &&
                    null !== t.source.queryId &&
                    (g(
                        zr(e.viewCache_),
                        'We should always have a full cache before handling merges'
                    ),
                    g(Vr(e.viewCache_), 'Missing event cache, even though we have a server cache'));
                var i = e.viewCache_,
                    t = (function(e, t, n, r, i) {
                        var o,
                            s,
                            a,
                            u,
                            l,
                            h,
                            c,
                            d,
                            p = new vi();
                        if (n.type === Er.OVERWRITE)
                            var f = n,
                                _ = f.source.fromUser
                                    ? Ti(e, t, f.path, f.snap, r, i, p)
                                    : (g(f.source.fromServer, 'Unknown source.'),
                                      (o =
                                          f.source.tagged ||
                                          (t.serverCache.isFiltered() && !Dt(f.path))),
                                      Si(e, t, f.path, f.snap, r, i, o, p));
                        else if (n.type === Er.MERGE)
                            var y = n,
                                _ = y.source.fromUser
                                    ? ((s = e),
                                      (a = t),
                                      (u = y.path),
                                      (f = y.children),
                                      (l = r),
                                      (h = i),
                                      (c = p),
                                      (d = a),
                                      f.foreach(function(e, t) {
                                          (e = kt(u, e)),
                                              Ii(a, Tt(e)) && (d = Ti(s, d, e, t, l, h, c));
                                      }),
                                      f.foreach(function(e, t) {
                                          (e = kt(u, e)),
                                              Ii(a, Tt(e)) || (d = Ti(s, d, e, t, l, h, c));
                                      }),
                                      d)
                                    : (g(y.source.fromServer, 'Unknown source.'),
                                      (o = y.source.tagged || t.serverCache.isFiltered()),
                                      Ni(e, t, y.path, y.children, r, i, o, p));
                        else if (n.type === Er.ACK_USER_WRITE) {
                            var v = n;
                            _ = v.revert
                                ? (function(e, t, n, r, i, o) {
                                      var s;
                                      if (null != pi(r, n)) return t;
                                      var a,
                                          u,
                                          l = new Ci(r, t, i),
                                          h = t.eventCache.getNode(),
                                          i = void 0;
                                      return (
                                          Dt(n) || '.priority' === Tt(n)
                                              ? ((u = void 0),
                                                (u = t.serverCache.isFullyInitialized()
                                                    ? hi(r, zr(t))
                                                    : ((a = t.serverCache.getNode()),
                                                      g(
                                                          a instanceof On,
                                                          'serverChildren would be complete if leaf node'
                                                      ),
                                                      ci(r, a))),
                                                (i = e.filter.updateFullNode(h, u, o)))
                                              : (null == (u = fi(r, (a = Tt(n)), t.serverCache)) &&
                                                    t.serverCache.isCompleteForChild(a) &&
                                                    (u = h.getImmediateChild(a)),
                                                (i =
                                                    null != u
                                                        ? e.filter.updateChild(h, a, u, Pt(n), l, o)
                                                        : t.eventCache.getNode().hasChild(a)
                                                        ? e.filter.updateChild(
                                                              h,
                                                              a,
                                                              On.EMPTY_NODE,
                                                              Pt(n),
                                                              l,
                                                              o
                                                          )
                                                        : h).isEmpty() &&
                                                    t.serverCache.isFullyInitialized() &&
                                                    (s = hi(r, zr(t))).isLeafNode() &&
                                                    (i = e.filter.updateFullNode(i, s, o))),
                                          (s =
                                              t.serverCache.isFullyInitialized() ||
                                              null != pi(r, St())),
                                          Br(t, i, s, e.filter.filtersNodes())
                                      );
                                  })(e, t, v.path, r, i, p)
                                : (function(e, t, r, n, i, o, s) {
                                      if (null != pi(i, r)) return t;
                                      var a = t.serverCache.isFiltered(),
                                          u = t.serverCache;
                                      if (null != n.value) {
                                          if (
                                              (Dt(r) && u.isFullyInitialized()) ||
                                              u.isCompleteForPath(r)
                                          )
                                              return Si(
                                                  e,
                                                  t,
                                                  r,
                                                  u.getNode().getChild(r),
                                                  i,
                                                  o,
                                                  a,
                                                  s
                                              );
                                          if (Dt(r)) {
                                              var l = new Kr(null);
                                              return (
                                                  u.getNode().forEachChild(tn, function(e, t) {
                                                      l = l.set(new bt(e), t);
                                                  }),
                                                  Ni(e, t, r, l, i, o, a, s)
                                              );
                                          }
                                          return t;
                                      }
                                      var h = new Kr(null);
                                      return (
                                          n.foreach(function(e, t) {
                                              var n = kt(r, e);
                                              u.isCompleteForPath(n) &&
                                                  (h = h.set(e, u.getNode().getChild(n)));
                                          }),
                                          Ni(e, t, r, h, i, o, a, s)
                                      );
                                  })(e, t, v.path, v.affectedTree, r, i, p);
                        } else {
                            if (n.type !== Er.LISTEN_COMPLETE)
                                throw m('Unknown operation type: ' + n.type);
                            (o = e),
                                (v = t),
                                (i = n.path),
                                (e = r),
                                (n = p),
                                (_ = Ei(
                                    o,
                                    (r = Hr(
                                        v,
                                        (r = v.serverCache).getNode(),
                                        r.isFullyInitialized() || Dt(i),
                                        r.isFiltered()
                                    )),
                                    i,
                                    e,
                                    wi,
                                    n
                                ));
                        }
                        return (
                            (p = p.getChanges()),
                            (v = t),
                            (r = p),
                            (e = (i = _).eventCache).isFullyInitialized() &&
                                ((n = e.getNode().isLeafNode() || e.getNode().isEmpty()),
                                (t = Vr(v)),
                                (0 < r.length ||
                                    !v.eventCache.isFullyInitialized() ||
                                    (n && !e.getNode().equals(t)) ||
                                    !e
                                        .getNode()
                                        .getPriority()
                                        .equals(t.getPriority())) &&
                                    r.push(Jn(Vr(i)))),
                            {viewCache: _, changes: p}
                        );
                    })(e.processor_, i, t, n, r);
                return (
                    (n = e.processor_),
                    (r = t.viewCache),
                    g(
                        r.eventCache.getNode().isIndexed(n.filter.getIndex()),
                        'Event snap not indexed'
                    ),
                    g(
                        r.serverCache.getNode().isIndexed(n.filter.getIndex()),
                        'Server snap not indexed'
                    ),
                    g(
                        t.viewCache.serverCache.isFullyInitialized() ||
                            !i.serverCache.isFullyInitialized(),
                        'Once a server snap is complete, it should never go back'
                    ),
                    (e.viewCache_ = t.viewCache),
                    Li(e, t.changes, t.viewCache.eventCache.getNode(), null)
                );
            }
            function Li(e, t, n, r) {
                return (
                    (r = r ? [r] : e.eventRegistrations_),
                    (i = e.eventGenerator_),
                    (e = n),
                    (n = r),
                    (r = []),
                    (o = []),
                    (t = t).forEach(function(e) {
                        var t;
                        'child_changed' === e.type &&
                            i.index_.indexedValueChanged(e.oldSnap, e.snapshotNode) &&
                            o.push(
                                ((t = e.childName),
                                {type: 'child_moved', snapshotNode: e.snapshotNode, childName: t})
                            );
                    }),
                    jr(i, r, 'child_removed', t, n, e),
                    jr(i, r, 'child_added', t, n, e),
                    jr(i, r, 'child_moved', o, n, e),
                    jr(i, r, 'child_changed', t, n, e),
                    jr(i, r, 'value', t, n, e),
                    r
                );
                var i, o;
            }
            var Mi = function() {
                this.views = new Map();
            };
            function Fi(e, t, n, r) {
                var i,
                    o,
                    s = t.source.queryId;
                if (null !== s) {
                    var a = e.views.get(s);
                    return (
                        g(null != a, 'SyncTree gave us an op for an invalid query.'), Ai(a, t, n, r)
                    );
                }
                var u = [];
                try {
                    for (var l = _(e.views.values()), h = l.next(); !h.done; h = l.next())
                        (a = h.value), (u = u.concat(Ai(a, t, n, r)));
                } catch (e) {
                    i = {error: e};
                } finally {
                    try {
                        h && !h.done && (o = l.return) && o.call(l);
                    } finally {
                        if (i) throw i.error;
                    }
                }
                return u;
            }
            function qi(e, t, n, r, i) {
                var o = t.queryIdentifier();
                return (e = e.views.get(o))
                    ? e
                    : ((e = !1),
                      (e =
                          !!(o = hi(n, i ? r : null)) ||
                          ((o = r instanceof On ? ci(n, r) : On.EMPTY_NODE), !1)),
                      (i = Ur(new Fr(o, e, !1), new Fr(r, i, !1))),
                      new xi(t, i));
            }
            function Wi(e) {
                var t,
                    n,
                    r = [];
                try {
                    for (var i = _(e.views.values()), o = i.next(); !o.done; o = i.next()) {
                        var s = o.value;
                        s.query.getQueryParams().loadsAllData() || r.push(s);
                    }
                } catch (e) {
                    t = {error: e};
                } finally {
                    try {
                        o && !o.done && (n = i.return) && n.call(i);
                    } finally {
                        if (t) throw t.error;
                    }
                }
                return r;
            }
            function Qi(e, t) {
                var n,
                    r,
                    i,
                    o,
                    s = null;
                try {
                    for (var a = _(e.views.values()), u = a.next(); !u.done; u = a.next())
                        var l = u.value,
                            s =
                                s ||
                                ((i = t),
                                (o = void 0),
                                (o = zr(l.viewCache_)) &&
                                (l.query.getQueryParams().loadsAllData() ||
                                    (!Dt(i) && !o.getImmediateChild(Tt(i)).isEmpty()))
                                    ? o.getChild(i)
                                    : null);
                } catch (e) {
                    n = {error: e};
                } finally {
                    try {
                        u && !u.done && (r = a.return) && r.call(a);
                    } finally {
                        if (n) throw n.error;
                    }
                }
                return s;
            }
            function ji(e, t) {
                return t.getQueryParams().loadsAllData()
                    ? Hi(e)
                    : ((t = t.queryIdentifier()), e.views.get(t));
            }
            function Ui(e, t) {
                return null != ji(e, t);
            }
            function Bi(e) {
                return null != Hi(e);
            }
            function Hi(e) {
                var t, n;
                try {
                    for (var r = _(e.views.values()), i = r.next(); !i.done; i = r.next()) {
                        var o = i.value;
                        if (o.query.getQueryParams().loadsAllData()) return o;
                    }
                } catch (e) {
                    t = {error: e};
                } finally {
                    try {
                        i && !i.done && (n = r.return) && n.call(r);
                    } finally {
                        if (t) throw t.error;
                    }
                }
                return null;
            }
            function Vi(e) {
                (this.listenProvider_ = e),
                    (this.syncPointTree_ = new Kr(null)),
                    (this.pendingWriteTree_ = {
                        visibleWrites: Gr.empty(),
                        allWrites: [],
                        lastWriteId: -1,
                    }),
                    (this.tagToQueryMap = new Map()),
                    (this.queryToTagMap = new Map());
            }
            var zi = 1;
            function Ki(e, t, n, r, i) {
                var o = e.pendingWriteTree_,
                    s = t,
                    a = n,
                    u = i;
                return (
                    g(r > o.lastWriteId, 'Stacking an older write on top of newer ones'),
                    void 0 === u && (u = !0),
                    o.allWrites.push({path: s, snap: a, writeId: r, visible: u}),
                    u && (o.visibleWrites = Jr(o.visibleWrites, s, a)),
                    (o.lastWriteId = r),
                    i ? Zi(e, new Or(Ir(), t, n)) : []
                );
            }
            function Yi(e, t, n) {
                void 0 === n && (n = !1);
                var r = (function(e, t) {
                    for (var n = 0; n < e.allWrites.length; n++) {
                        var r = e.allWrites[n];
                        if (r.writeId === t) return r;
                    }
                    return null;
                })(e.pendingWriteTree_, t);
                if (
                    (function(t, n) {
                        var e = t.allWrites.findIndex(function(e) {
                            return e.writeId === n;
                        });
                        g(0 <= e, 'removeWrite called with nonexistent writeId.');
                        var r = t.allWrites[e];
                        t.allWrites.splice(e, 1);
                        for (
                            var i, o = r.visible, s = !1, a = t.allWrites.length - 1;
                            o && 0 <= a;

                        ) {
                            var u = t.allWrites[a];
                            u.visible &&
                                (e <= a &&
                                (function(e, t) {
                                    if (e.snap) return Mt(e.path, t);
                                    for (var n in e.children)
                                        if (e.children.hasOwnProperty(n) && Mt(kt(e.path, n), t))
                                            return 1;
                                })(u, r.path)
                                    ? (o = !1)
                                    : Mt(r.path, u.path) && (s = !0)),
                                a--;
                        }
                        return (
                            o &&
                            (s
                                ? (((i = t).visibleWrites = ui(i.allWrites, ai, St())),
                                  0 < i.allWrites.length
                                      ? (i.lastWriteId =
                                            i.allWrites[i.allWrites.length - 1].writeId)
                                      : (i.lastWriteId = -1))
                                : r.snap
                                ? (t.visibleWrites = Zr(t.visibleWrites, r.path))
                                : Ne(r.children, function(e) {
                                      t.visibleWrites = Zr(t.visibleWrites, kt(r.path, e));
                                  }),
                            1)
                        );
                    })(e.pendingWriteTree_, t)
                ) {
                    var i = new Kr(null);
                    return (
                        null != r.snap
                            ? (i = i.set(St(), !0))
                            : Ne(r.children, function(e) {
                                  i = i.set(new bt(e), !0);
                              }),
                        Zi(e, new Rr(r.path, i, n))
                    );
                }
                return [];
            }
            function Gi(e, t, n) {
                return Zi(e, new Or(Pr(), t, n));
            }
            function $i(n, e, t, r) {
                var i = e.path,
                    o = n.syncPointTree_.get(i),
                    s = [];
                if (o && ('default' === e.queryIdentifier() || Ui(o, e))) {
                    var a = (function(e, t, n, r) {
                        var i,
                            o,
                            s = t.queryIdentifier(),
                            a = [],
                            u = [],
                            l = Bi(e);
                        if ('default' === s)
                            try {
                                for (
                                    var h = _(e.views.entries()), c = h.next();
                                    !c.done;
                                    c = h.next()
                                ) {
                                    var d = y(c.value, 2),
                                        p = d[0],
                                        f = d[1],
                                        u = u.concat(Oi(f, n, r));
                                    Di(f) &&
                                        (e.views.delete(p),
                                        f.query.getQueryParams().loadsAllData() || a.push(f.query));
                                }
                            } catch (e) {
                                i = {error: e};
                            } finally {
                                try {
                                    c && !c.done && (o = h.return) && o.call(h);
                                } finally {
                                    if (i) throw i.error;
                                }
                            }
                        else
                            (f = e.views.get(s)) &&
                                ((u = u.concat(Oi(f, n, r))),
                                Di(f) &&
                                    (e.views.delete(s),
                                    f.query.getQueryParams().loadsAllData() || a.push(f.query)));
                        return (
                            l &&
                                !Bi(e) &&
                                a.push(
                                    (g(Ri, 'Reference.ts has not been loaded'),
                                    new Ri(t.database, t.path))
                                ),
                            {removed: a, events: u}
                        );
                    })(o, e, t, r);
                    if (
                        (0 === o.views.size && (n.syncPointTree_ = n.syncPointTree_.remove(i)),
                        (t = a.removed),
                        (s = a.events),
                        (o =
                            -1 !==
                            t.findIndex(function(e) {
                                return e.getQueryParams().loadsAllData();
                            })),
                        (a = n.syncPointTree_.findOnPath(i, function(e, t) {
                            return Bi(t);
                        })),
                        o && !a && !(i = n.syncPointTree_.subtree(i)).isEmpty())
                    )
                        for (
                            var u = i.fold(function(e, t, n) {
                                    if (t && Bi(t)) return [Hi(t)];
                                    var r = [];
                                    return (
                                        t && (r = Wi(t)),
                                        Ne(n, function(e, t) {
                                            r = r.concat(t);
                                        }),
                                        r
                                    );
                                }),
                                l = 0;
                            l < u.length;
                            ++l
                        ) {
                            var h = (c = u[l]).query,
                                c = eo(n, c);
                            n.listenProvider_.startListening(
                                so(h),
                                to(n, h),
                                c.hashFn,
                                c.onComplete
                            );
                        }
                    !a &&
                        0 < t.length &&
                        !r &&
                        (o
                            ? n.listenProvider_.stopListening(so(e), null)
                            : t.forEach(function(e) {
                                  var t = n.queryToTagMap.get(no(e));
                                  n.listenProvider_.stopListening(so(e), t);
                              })),
                        (function(e, t) {
                            for (var n = 0; n < t.length; ++n) {
                                var r,
                                    i = t[n];
                                i.getQueryParams().loadsAllData() ||
                                    ((r = no(i)),
                                    (i = e.queryToTagMap.get(r)),
                                    e.queryToTagMap.delete(r),
                                    e.tagToQueryMap.delete(i));
                            }
                        })(n, t);
                }
                return s;
            }
            function Ji(e, t, n) {
                var r = t.path,
                    i = null,
                    o = !1;
                e.syncPointTree_.foreachOnPath(r, function(e, t) {
                    (e = Ot(e, r)), (i = i || Qi(t, e)), (o = o || Bi(t));
                });
                var s = e.syncPointTree_.get(r);
                s
                    ? ((o = o || Bi(s)), (i = i || Qi(s, St())))
                    : ((s = new Mi()), (e.syncPointTree_ = e.syncPointTree_.set(r, s))),
                    null != i
                        ? (d = !0)
                        : ((d = !1),
                          (i = On.EMPTY_NODE),
                          e.syncPointTree_.subtree(r).foreachChild(function(e, t) {
                              (t = Qi(t, St())) && (i = i.updateImmediateChild(e, t));
                          }));
                var a = Ui(s, t);
                a ||
                    t.getQueryParams().loadsAllData() ||
                    ((h = no(t)),
                    g(!e.queryToTagMap.has(h), 'View does not exist, but we have a tag'),
                    (l = zi++),
                    e.queryToTagMap.set(h, l),
                    e.tagToQueryMap.set(l, h));
                var u,
                    l,
                    h,
                    c,
                    d =
                        ((u = s),
                        (l = t),
                        (h = n),
                        (n = si(e.pendingWriteTree_, r)),
                        (n = qi(u, l, n, i, (n = d))),
                        u.views.has(l.queryIdentifier()) || u.views.set(l.queryIdentifier(), n),
                        (l = h),
                        n.eventRegistrations_.push(l),
                        (l = h),
                        (n = (h = n).viewCache_.eventCache),
                        (c = []),
                        n.getNode().isLeafNode() ||
                            n.getNode().forEachChild(bn, function(e, t) {
                                c.push(Xn(e, t));
                            }),
                        n.isFullyInitialized() && c.push(Jn(n.getNode())),
                        Li(h, c, n.getNode(), l));
                return (
                    a ||
                        o ||
                        ((s = ji(s, t)),
                        (d = d.concat(
                            (function(e, t, n) {
                                var r = t.path,
                                    i = to(e, t),
                                    n = eo(e, n),
                                    n = e.listenProvider_.startListening(
                                        so(t),
                                        i,
                                        n.hashFn,
                                        n.onComplete
                                    ),
                                    r = e.syncPointTree_.subtree(r);
                                if (i)
                                    g(
                                        !Bi(r.value),
                                        "If we're adding a query, it shouldn't be shadowed"
                                    );
                                else
                                    for (
                                        var o = r.fold(function(e, t, n) {
                                                if (!Dt(e) && t && Bi(t)) return [Hi(t).query];
                                                var r = [];
                                                return (
                                                    t &&
                                                        (r = r.concat(
                                                            Wi(t).map(function(e) {
                                                                return e.query;
                                                            })
                                                        )),
                                                    Ne(n, function(e, t) {
                                                        r = r.concat(t);
                                                    }),
                                                    r
                                                );
                                            }),
                                            s = 0;
                                        s < o.length;
                                        ++s
                                    ) {
                                        var a = o[s];
                                        e.listenProvider_.stopListening(so(a), to(e, a));
                                    }
                                return n;
                            })(e, t, s)
                        ))),
                    d
                );
            }
            function Xi(e, n, t) {
                var r = e.pendingWriteTree_,
                    e = e.syncPointTree_.findOnPath(n, function(e, t) {
                        if ((e = Qi(t, Ot(e, n)))) return e;
                    });
                return li(r, n, e, t, !0);
            }
            function Zi(e, t) {
                return (function e(t, n, r, i) {
                    if (Dt(t.path))
                        return (function i(o, e, s, a) {
                            var t = e.get(St());
                            null == s && null != t && (s = Qi(t, St()));
                            var u = [];
                            return (
                                e.children.inorderTraversal(function(e, t) {
                                    var n = s ? s.getImmediateChild(e) : null,
                                        r = _i(a, e),
                                        e = o.operationForChild(e);
                                    e && (u = u.concat(i(e, t, n, r)));
                                }),
                                (u = t ? u.concat(Fi(t, o, a, s)) : u)
                            );
                        })(t, n, r, i);
                    var o = n.get(St());
                    null == r && null != o && (r = Qi(o, St()));
                    var s = [],
                        a = Tt(t.path),
                        u = t.operationForChild(a),
                        l = n.children.get(a);
                    return (
                        l &&
                            u &&
                            ((n = r ? r.getImmediateChild(a) : null),
                            (a = _i(i, a)),
                            (s = s.concat(e(u, l, n, a)))),
                        o ? s.concat(Fi(o, t, i, r)) : s
                    );
                })(t, e.syncPointTree_, null, si(e.pendingWriteTree_, St()));
            }
            function eo(o, e) {
                var s = e.query,
                    a = to(o, s);
                return {
                    hashFn: function() {
                        return (e.viewCache_.serverCache.getNode() || On.EMPTY_NODE).hash();
                    },
                    onComplete: function(e) {
                        if ('ok' === e)
                            return a
                                ? ((t = o),
                                  (i = s.path),
                                  (r = ro(t, (n = a)))
                                      ? ((r = (n = io(r)).path),
                                        (n = n.queryId),
                                        (i = Ot(r, i)),
                                        oo(t, r, new kr(Nr(n), i)))
                                      : [])
                                : ((i = s.path), Zi(o, new kr(Pr(), i)));
                        var t,
                            n,
                            r,
                            i,
                            e = ke(e, s);
                        return $i(o, s, null, e);
                    },
                };
            }
            function to(e, t) {
                return (t = no(t)), e.queryToTagMap.get(t);
            }
            function no(e) {
                return e.path.toString() + '$' + e.queryIdentifier();
            }
            function ro(e, t) {
                return e.tagToQueryMap.get(t);
            }
            function io(e) {
                var t = e.indexOf('$');
                return (
                    g(-1 !== t && t < e.length - 1, 'Bad queryKey.'),
                    {queryId: e.substr(t + 1), path: new bt(e.substr(0, t))}
                );
            }
            function oo(e, t, n) {
                var r = e.syncPointTree_.get(t);
                return (
                    g(r, "Missing sync point for query tag that we're tracking"),
                    Fi(r, n, si(e.pendingWriteTree_, t), null)
                );
            }
            function so(e) {
                return e.getQueryParams().loadsAllData() && !e.getQueryParams().isDefault()
                    ? e.getRef()
                    : e;
            }
            var ao =
                ((uo.prototype.getImmediateChild = function(e) {
                    return new uo(this.node_.getImmediateChild(e));
                }),
                (uo.prototype.node = function() {
                    return this.node_;
                }),
                uo);
            function uo(e) {
                this.node_ = e;
            }
            var lo =
                ((ho.prototype.getImmediateChild = function(e) {
                    return (e = kt(this.path_, e)), new ho(this.syncTree_, e);
                }),
                (ho.prototype.node = function() {
                    return Xi(this.syncTree_, this.path_);
                }),
                ho);
            function ho(e, t) {
                (this.syncTree_ = e), (this.path_ = t);
            }
            var co = function(e) {
                    return ((e = e || {}).timestamp = e.timestamp || new Date().getTime()), e;
                },
                po = function(e, t, n) {
                    return e && 'object' == typeof e
                        ? (g('.sv' in e, 'Unexpected leaf node or priority contents'),
                          'string' == typeof e['.sv']
                              ? fo(e['.sv'], t, n)
                              : 'object' == typeof e['.sv']
                              ? _o(e['.sv'], t)
                              : void g(
                                    !1,
                                    'Unexpected server value: ' + JSON.stringify(e, null, 2)
                                ))
                        : e;
                },
                fo = function(e, t, n) {
                    if ('timestamp' === e) return n.timestamp;
                    g(!1, 'Unexpected server value: ' + e);
                },
                _o = function(e, t, n) {
                    return (
                        e.hasOwnProperty('increment') ||
                            g(!1, 'Unexpected server value: ' + JSON.stringify(e, null, 2)),
                        'number' != typeof (e = e.increment) &&
                            g(!1, 'Unexpected increment value: ' + e),
                        (t = t.node()),
                        g(null != t, 'Expected ChildrenNode.EMPTY_NODE for nulls'),
                        !t.isLeafNode() || 'number' != typeof (t = t.getValue()) ? e : t + e
                    );
                },
                yo = function(e, t, n, r) {
                    return go(t, new lo(n, e), r);
                },
                vo = function(e, t, n) {
                    return go(e, new ao(t), n);
                };
            function go(e, r, i) {
                var t = e.getPriority().val(),
                    n = po(t, r.getImmediateChild('.priority'), i);
                if (e.isLeafNode()) {
                    var o = e;
                    return (t = po(o.getValue(), r, i)) !== o.getValue() ||
                        n !== o.getPriority().val()
                        ? new mn(t, qn(n))
                        : e;
                }
                var s = (e = e);
                return (
                    n !== e.getPriority().val() && (s = s.updatePriority(new mn(n))),
                    e.forEachChild(bn, function(e, t) {
                        var n = go(t, r.getImmediateChild(e), i);
                        n !== t && (s = s.updateImmediateChild(e, n));
                    }),
                    s
                );
            }
            var mo = function(e, t, n) {
                void 0 === e && (e = ''),
                    void 0 === t && (t = null),
                    void 0 === n && (n = {children: {}, childCount: 0}),
                    (this.name = e),
                    (this.parent = t),
                    (this.node = n);
            };
            function wo(e, t) {
                for (var n = t instanceof bt ? t : new bt(t), r = e, i = Tt(n); null !== i; )
                    var o = k(r.node.children, i) || {children: {}, childCount: 0},
                        r = new mo(i, r, o),
                        i = Tt((n = Pt(n)));
                return r;
            }
            function Co(e) {
                return e.node.value;
            }
            function bo(e, t) {
                (e.node.value = t),
                    (function e(t) {
                        var n, r, i, o;
                        null !== t.parent &&
                            ((n = t.parent),
                            (r = t.name),
                            (o = (function(e) {
                                return void 0 === Co(e) && !Eo(e);
                            })((i = t))),
                            (t = x(n.node.children, r)),
                            o && t
                                ? (delete n.node.children[r], n.node.childCount--, e(n))
                                : o ||
                                  t ||
                                  ((n.node.children[r] = i.node), n.node.childCount++, e(n)));
                    })(e);
            }
            function Eo(e) {
                return 0 < e.node.childCount;
            }
            function So(n, r) {
                Ne(n.node.children, function(e, t) {
                    r(new mo(e, n, t));
                });
            }
            function To(e) {
                return new bt(null === e.parent ? e.name : To(e.parent) + '/' + e.name);
            }
            function Io(e) {
                return 'string' == typeof e && 0 !== e.length && !qo.test(e);
            }
            function Po(e) {
                return 'string' == typeof e && 0 !== e.length && !Wo.test(e);
            }
            function No(e) {
                return (
                    null === e ||
                    'string' == typeof e ||
                    ('number' == typeof e && !ue(e)) ||
                    (e && 'object' == typeof e && x(e, '.sv'))
                );
            }
            function Ro(e, t, n, r, i) {
                (i && void 0 === n) || jo(F(e, t, i), n, r);
            }
            function xo(e, t, n, r, i) {
                if (!i || void 0 !== n) {
                    var o = F(e, t, i);
                    if (!n || 'object' != typeof n || Array.isArray(n))
                        throw new Error(
                            o + ' must be an object containing the children to replace.'
                        );
                    var s = [];
                    Ne(n, function(e, t) {
                        if (((e = new bt(e)), jo(o, t, kt(r, e)), '.priority' === Nt(e) && !No(t)))
                            throw new Error(
                                o +
                                    "contains an invalid value for '" +
                                    e.toString() +
                                    "', which must be a valid Firebase priority (a string, finite number, server value, or null)."
                            );
                        s.push(e);
                    }),
                        (function(e, t) {
                            for (var n = 0; n < t.length; n++)
                                for (var r, i = Rt((r = t[n])), o = 0; o < i.length; o++)
                                    if (('.priority' !== i[o] || o !== i.length - 1) && !Io(i[o]))
                                        throw new Error(
                                            e +
                                                'contains an invalid key (' +
                                                i[o] +
                                                ') in path ' +
                                                r.toString() +
                                                '. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"'
                                        );
                            t.sort(At);
                            for (var s = null, n = 0; n < t.length; n++) {
                                if (((r = t[n]), null !== s && Mt(s, r)))
                                    throw new Error(
                                        e +
                                            'contains a path ' +
                                            s.toString() +
                                            ' that is ancestor of another path ' +
                                            r.toString()
                                    );
                                s = r;
                            }
                        })(o, s);
                }
            }
            function ko(e, t, n, r) {
                if (!r || void 0 !== n) {
                    if (ue(n))
                        throw new Error(
                            F(e, t, r) +
                                'is ' +
                                n.toString() +
                                ', but must be a valid Firebase priority (a string, finite number, server value, or null).'
                        );
                    if (!No(n))
                        throw new Error(
                            F(e, t, r) +
                                'must be a valid Firebase priority (a string, finite number, server value, or null).'
                        );
                }
            }
            function Do(e, t, n, r) {
                if (!r || void 0 !== n)
                    switch (n) {
                        case 'value':
                        case 'child_added':
                        case 'child_removed':
                        case 'child_changed':
                        case 'child_moved':
                            break;
                        default:
                            throw new Error(
                                F(e, t, r) +
                                    'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".'
                            );
                    }
            }
            function Oo(e, t, n, r) {
                if (!((r && void 0 === n) || Io(n)))
                    throw new Error(
                        F(e, t, r) +
                            'was an invalid key = "' +
                            n +
                            '".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").'
                    );
            }
            function Ao(e, t, n, r) {
                if (!((r && void 0 === n) || Po(n)))
                    throw new Error(
                        F(e, t, r) +
                            'was an invalid path = "' +
                            n +
                            '". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"'
                    );
            }
            function Lo(e, t) {
                if ('.info' === Tt(t))
                    throw new Error(e + " failed = Can't modify data under /.info/");
            }
            function Mo(e, t, n) {
                var r = n.path.toString();
                if (
                    'string' != typeof n.repoInfo.host ||
                    0 === n.repoInfo.host.length ||
                    (!Io(n.repoInfo.namespace) && 'localhost' !== n.repoInfo.host.split(':')[0]) ||
                    (0 !== r.length && !Po((r = r && r.replace(/^\/*\.info(\/|$)/, '/'))))
                )
                    throw new Error(
                        F(e, t, !1) +
                            'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".'
                    );
            }
            function Fo() {
                (this.eventLists_ = []), (this.recursionDepth_ = 0);
            }
            var qo = /[\[\].#$\/\u0000-\u001F\u007F]/,
                Wo = /[\[\].#$\u0000-\u001F\u007F]/,
                Qo = 10485760,
                jo = function(r, e, t) {
                    var i = t instanceof bt ? new Ft(t, r) : t;
                    if (void 0 === e) throw new Error(r + 'contains undefined ' + Wt(i));
                    if ('function' == typeof e)
                        throw new Error(
                            r + 'contains a function ' + Wt(i) + ' with contents = ' + e.toString()
                        );
                    if (ue(e)) throw new Error(r + 'contains ' + e.toString() + ' ' + Wt(i));
                    if ('string' == typeof e && e.length > Qo / 3 && Q(e) > Qo)
                        throw new Error(
                            r +
                                'contains a string greater than ' +
                                Qo +
                                ' utf8 bytes ' +
                                Wt(i) +
                                " ('" +
                                e.substring(0, 50) +
                                "...')"
                        );
                    if (e && 'object' == typeof e) {
                        var o = !1,
                            s = !1;
                        if (
                            (Ne(e, function(e, t) {
                                if ('.value' === e) o = !0;
                                else if ('.priority' !== e && '.sv' !== e && ((s = !0), !Io(e)))
                                    throw new Error(
                                        r +
                                            ' contains an invalid key (' +
                                            e +
                                            ') ' +
                                            Wt(i) +
                                            '.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"'
                                    );
                                var n = e;
                                0 < (e = i).parts_.length && (e.byteLength_ += 1),
                                    e.parts_.push(n),
                                    (e.byteLength_ += Q(n)),
                                    qt(e),
                                    jo(r, t, i),
                                    (t = (e = i).parts_.pop()),
                                    (e.byteLength_ -= Q(t)),
                                    0 < e.parts_.length && --e.byteLength_;
                            }),
                            o && s)
                        )
                            throw new Error(
                                r +
                                    ' contains ".value" child ' +
                                    Wt(i) +
                                    ' in addition to actual children.'
                            );
                    }
                };
            function Uo(e, t) {
                for (var n = null, r = 0; r < t.length; r++) {
                    var i = t[r],
                        o = i.getPath();
                    null === n || Lt(o, n.path) || (e.eventLists_.push(n), (n = null)),
                        (n = null === n ? {events: [], path: o} : n).events.push(i);
                }
                n && e.eventLists_.push(n);
            }
            function Bo(e, t, n) {
                Uo(e, n),
                    Vo(e, function(e) {
                        return Lt(e, t);
                    });
            }
            function Ho(e, t, n) {
                Uo(e, n),
                    Vo(e, function(e) {
                        return Mt(e, t) || Mt(t, e);
                    });
            }
            function Vo(e, t) {
                e.recursionDepth_++;
                for (var n = !0, r = 0; r < e.eventLists_.length; r++) {
                    var i = e.eventLists_[r];
                    i &&
                        (t(i.path)
                            ? ((function(e) {
                                  for (var t = 0; t < e.events.length; t++) {
                                      var n,
                                          r = e.events[t];
                                      null !== r &&
                                          ((e.events[t] = null),
                                          (n = r.getEventRunner()),
                                          me && Ce('event: ' + r.toString()),
                                          Me(n));
                                  }
                              })(e.eventLists_[r]),
                              (e.eventLists_[r] = null))
                            : (n = !1));
                }
                n && (e.eventLists_ = []), e.recursionDepth_--;
            }
            var zo = 'repo_interrupt',
                Ko = 25,
                Yo =
                    ((Go.prototype.toString = function() {
                        return (
                            (this.repoInfo_.secure ? 'https://' : 'http://') + this.repoInfo_.host
                        );
                    }),
                    Go);
            function Go(e, t, n, r) {
                (this.repoInfo_ = e),
                    (this.forceRestClient_ = t),
                    (this.app = n),
                    (this.authTokenProvider_ = r),
                    (this.dataUpdateCount = 0),
                    (this.statsListener_ = null),
                    (this.eventQueue_ = new Fo()),
                    (this.nextWriteId_ = 1),
                    (this.interceptServerDataCallback_ = null),
                    (this.onDisconnect_ = gr()),
                    (this.transactionQueueTree_ = new mo()),
                    (this.persistentConnection_ = null),
                    (this.key = this.repoInfo_.toURLString());
            }
            function $o(e) {
                return (
                    (e = e.infoData_.getNode(new bt('.info/serverTimeOffset')).val() || 0),
                    new Date().getTime() + e
                );
            }
            function Jo(e) {
                return co({timestamp: $o(e)});
            }
            function Xo(e, t, n, r, i) {
                e.dataUpdateCount++;
                var o = new bt(t);
                n = e.interceptServerDataCallback_ ? e.interceptServerDataCallback_(t, n) : n;
                var s,
                    a,
                    u,
                    l,
                    h,
                    c,
                    d,
                    p,
                    f,
                    _ = o;
                0 <
                    (l = i
                        ? r
                            ? ((s = O(n, function(e) {
                                  return qn(e);
                              })),
                              (h = e.serverSyncTree_),
                              (c = o),
                              (d = s),
                              (f = ro(h, (p = i)))
                                  ? ((f = (p = io(f)).path),
                                    (p = p.queryId),
                                    (c = Ot(f, c)),
                                    (d = Kr.fromObject(d)),
                                    oo(h, f, new Lr(Nr(p), c, d)))
                                  : [])
                            : ((a = o),
                              (u = t = qn(n)),
                              null == (i = ro((s = e.serverSyncTree_), (t = i)))
                                  ? []
                                  : ((i = (t = io(i)).path),
                                    (t = t.queryId),
                                    (a = Ot(i, a)),
                                    oo(s, i, new Or(Nr(t), a, u))))
                        : r
                        ? ((a = O(n, function(e) {
                              return qn(e);
                          })),
                          (u = e.serverSyncTree_),
                          (r = o),
                          (a = Kr.fromObject(a)),
                          Zi(u, new Lr(Pr(), r, a)))
                        : ((n = qn(n)), Gi(e.serverSyncTree_, o, n))).length && (_ = hs(e, o)),
                    Ho(e.eventQueue_, _, l);
            }
            function Zo(e, t) {
                es(e, 'connected', t),
                    !1 === t &&
                        (function(n) {
                            ss(n, 'onDisconnectEvents');
                            var r = Jo(n),
                                i = gr();
                            wr(n.onDisconnect_, St(), function(e, t) {
                                (t = yo(e, t, n.serverSyncTree_, r)), mr(i, e, t);
                            });
                            var o = [];
                            wr(i, St(), function(e, t) {
                                (o = o.concat(Gi(n.serverSyncTree_, e, t))),
                                    (e = fs(n, e)),
                                    hs(n, e);
                            }),
                                (n.onDisconnect_ = gr()),
                                Ho(n.eventQueue_, St(), o);
                        })(e);
            }
            function es(e, t, n) {
                (t = new bt('/.info/' + t)),
                    (n = qn(n)),
                    e.infoData_.updateSnapshot(t, n),
                    (n = Gi(e.infoSyncTree_, t, n)),
                    Ho(e.eventQueue_, t, n);
            }
            function ts(e) {
                return e.nextWriteId_++;
            }
            function ns(r, i, e, t, o) {
                ss(r, 'set', {path: i.toString(), value: e, priority: t});
                var n = Jo(r),
                    e = qn(e, t),
                    t = Xi(r.serverSyncTree_, i),
                    n = vo(e, t, n),
                    s = ts(r),
                    n = Ki(r.serverSyncTree_, i, n, s, !0);
                Uo(r.eventQueue_, n),
                    r.server_.put(i.toString(), e.val(!0), function(e, t) {
                        var n = 'ok' === e;
                        n || Ee('set at ' + i + ' failed: ' + e),
                            (n = Yi(r.serverSyncTree_, s, !n)),
                            Ho(r.eventQueue_, i, n),
                            as(0, o, e, t);
                    }),
                    (e = fs(r, i)),
                    hs(r, e),
                    Ho(r.eventQueue_, e, []);
            }
            function rs(n, r, e, i) {
                var o = qn(e);
                n.server_.onDisconnectPut(r.toString(), o.val(!0), function(e, t) {
                    'ok' === e && mr(n.onDisconnect_, r, o), as(0, i, e, t);
                });
            }
            function is(e, t, n) {
                (n =
                    '.info' === Tt(t.path)
                        ? Ji(e.infoSyncTree_, t, n)
                        : Ji(e.serverSyncTree_, t, n)),
                    Bo(e.eventQueue_, t.path, n);
            }
            function os(e) {
                e.persistentConnection_ && e.persistentConnection_.interrupt(zo);
            }
            function ss(e) {
                for (var t = [], n = 1; n < arguments.length; n++) t[n - 1] = arguments[n];
                var r = '';
                e.persistentConnection_ && (r = e.persistentConnection_.id + ':'),
                    Ce.apply(void 0, s([r], y(t)));
            }
            function as(e, n, r, i) {
                n &&
                    Me(function() {
                        var e, t;
                        'ok' === r
                            ? n(null)
                            : ((t = e = (r || 'error').toUpperCase()),
                              i && (t += ': ' + i),
                              ((t = new Error(t)).code = e),
                              n(t));
                    });
            }
            function us(e, t, n) {
                return Xi(e.serverSyncTree_, t, n) || On.EMPTY_NODE;
            }
            function ls(t, e) {
                var n;
                (e = void 0 === e ? t.transactionQueueTree_ : e) || ps(t, e),
                    Co(e)
                        ? ((n = ds(t, e)),
                          g(0 < n.length, 'Sending zero length transaction queue'),
                          n.every(function(e) {
                              return 0 === e.status;
                          }) &&
                              (function(i, o, s) {
                                  for (
                                      var e = s.map(function(e) {
                                              return e.currentWriteId;
                                          }),
                                          t = (u = us(i, o, e)),
                                          e = u.hash(),
                                          n = 0;
                                      n < s.length;
                                      n++
                                  ) {
                                      var r = s[n];
                                      g(
                                          0 === r.status,
                                          'tryToSendTransactionQueue_: items in queue should all be run.'
                                      ),
                                          (r.status = 1),
                                          r.retryCount++;
                                      var a = Ot(o, r.path),
                                          t = t.updateChild(a, r.currentOutputSnapshotRaw);
                                  }
                                  var u = t.val(!0),
                                      l = o;
                                  i.server_.put(
                                      l.toString(),
                                      u,
                                      function(e) {
                                          ss(i, 'transaction put response', {
                                              path: l.toString(),
                                              status: e,
                                          });
                                          var t = [];
                                          if ('ok' === e) {
                                              for (var n = [], r = 0; r < s.length; r++)
                                                  !(function(e) {
                                                      (s[e].status = 2),
                                                          (t = t.concat(
                                                              Yi(
                                                                  i.serverSyncTree_,
                                                                  s[e].currentWriteId
                                                              )
                                                          )),
                                                          s[e].onComplete &&
                                                              n.push(function() {
                                                                  return s[e].onComplete(
                                                                      null,
                                                                      !0,
                                                                      s[e]
                                                                          .currentOutputSnapshotResolved
                                                                  );
                                                              }),
                                                          s[e].unwatcher();
                                                  })(r);
                                              for (
                                                  ps(i, wo(i.transactionQueueTree_, o)),
                                                      ls(i, i.transactionQueueTree_),
                                                      Ho(i.eventQueue_, o, t),
                                                      r = 0;
                                                  r < n.length;
                                                  r++
                                              )
                                                  Me(n[r]);
                                          } else {
                                              if ('datastale' === e)
                                                  for (r = 0; r < s.length; r++)
                                                      3 === s[r].status
                                                          ? (s[r].status = 4)
                                                          : (s[r].status = 0);
                                              else
                                                  for (
                                                      Ee(
                                                          'transaction at ' +
                                                              l.toString() +
                                                              ' failed: ' +
                                                              e
                                                      ),
                                                          r = 0;
                                                      r < s.length;
                                                      r++
                                                  )
                                                      (s[r].status = 4), (s[r].abortReason = e);
                                              hs(i, o);
                                          }
                                      },
                                      e
                                  );
                              })(t, To(e), n))
                        : Eo(e) &&
                          So(e, function(e) {
                              ls(t, e);
                          });
            }
            function hs(e, t) {
                var n = cs(e, t),
                    t = To(n);
                return (
                    (function(u, l, h) {
                        if (0 !== l.length) {
                            for (
                                var c = [],
                                    d = [],
                                    p = l
                                        .filter(function(e) {
                                            return 0 === e.status;
                                        })
                                        .map(function(e) {
                                            return e.currentWriteId;
                                        }),
                                    e = 0;
                                e < l.length;
                                e++
                            )
                                !(function(e) {
                                    var t,
                                        n,
                                        r,
                                        i,
                                        o = l[e],
                                        s = Ot(h, o.path),
                                        a = !1;
                                    g(
                                        null !== s,
                                        'rerunTransactionsUnderNode_: relativePath should not be null.'
                                    ),
                                        4 === o.status
                                            ? ((a = !0),
                                              (t = o.abortReason),
                                              (d = d.concat(
                                                  Yi(u.serverSyncTree_, o.currentWriteId, !0)
                                              )))
                                            : 0 === o.status &&
                                              (d =
                                                  o.retryCount >= Ko
                                                      ? ((a = !0),
                                                        (t = 'maxretry'),
                                                        d.concat(
                                                            Yi(
                                                                u.serverSyncTree_,
                                                                o.currentWriteId,
                                                                !0
                                                            )
                                                        ))
                                                      : ((n = us(u, o.path, p)),
                                                        (o.currentInputSnapshot = n),
                                                        void 0 !== (i = l[e].update(n.val()))
                                                            ? (jo(
                                                                  'transaction failed: Data returned ',
                                                                  i,
                                                                  o.path
                                                              ),
                                                              (r = qn(i)),
                                                              ('object' == typeof i &&
                                                                  null != i &&
                                                                  x(i, '.priority')) ||
                                                                  (r = r.updatePriority(
                                                                      n.getPriority()
                                                                  )),
                                                              (s = o.currentWriteId),
                                                              (i = Jo(u)),
                                                              (i = vo(r, n, i)),
                                                              (o.currentOutputSnapshotRaw = r),
                                                              (o.currentOutputSnapshotResolved = i),
                                                              (o.currentWriteId = ts(u)),
                                                              p.splice(p.indexOf(s), 1),
                                                              (d = d.concat(
                                                                  Ki(
                                                                      u.serverSyncTree_,
                                                                      o.path,
                                                                      i,
                                                                      o.currentWriteId,
                                                                      o.applyLocally
                                                                  )
                                                              )).concat(
                                                                  Yi(u.serverSyncTree_, s, !0)
                                                              ))
                                                            : ((a = !0),
                                                              (t = 'nodata'),
                                                              d.concat(
                                                                  Yi(
                                                                      u.serverSyncTree_,
                                                                      o.currentWriteId,
                                                                      !0
                                                                  )
                                                              )))),
                                        Ho(u.eventQueue_, h, d),
                                        (d = []),
                                        a &&
                                            ((l[e].status = 2),
                                            (a = l[e].unwatcher),
                                            setTimeout(a, Math.floor(0)),
                                            l[e].onComplete &&
                                                ('nodata' === t
                                                    ? c.push(function() {
                                                          return l[e].onComplete(
                                                              null,
                                                              !1,
                                                              l[e].currentInputSnapshot
                                                          );
                                                      })
                                                    : c.push(function() {
                                                          return l[e].onComplete(
                                                              new Error(t),
                                                              !1,
                                                              null
                                                          );
                                                      })));
                                })(e);
                            for (ps(u, u.transactionQueueTree_), e = 0; e < c.length; e++) Me(c[e]);
                            ls(u, u.transactionQueueTree_);
                        }
                    })(e, ds(e, n), t),
                    t
                );
            }
            function cs(e, t) {
                for (var n = e.transactionQueueTree_, r = Tt(t); null !== r && void 0 === Co(n); )
                    (n = wo(n, r)), (r = Tt((t = Pt(t))));
                return n;
            }
            function ds(e, t) {
                var n = [];
                return (
                    (function t(n, e, r) {
                        var i = Co(e);
                        if (i) for (var o = 0; o < i.length; o++) r.push(i[o]);
                        So(e, function(e) {
                            t(n, e, r);
                        });
                    })(e, t, n),
                    n.sort(function(e, t) {
                        return e.order - t.order;
                    }),
                    n
                );
            }
            function ps(t, e) {
                var n = Co(e);
                if (n) {
                    for (var r = 0, i = 0; i < n.length; i++)
                        2 !== n[i].status && ((n[r] = n[i]), r++);
                    (n.length = r), bo(e, 0 < n.length ? n : void 0);
                }
                So(e, function(e) {
                    ps(t, e);
                });
            }
            function fs(n, e) {
                var t = To(cs(n, e));
                return (
                    (function(e) {
                        for (var t = e.parent; null !== t; ) _s(n, t), (t = t.parent);
                    })((e = wo(n.transactionQueueTree_, e))),
                    _s(n, e),
                    (function t(e, n, r, i) {
                        r && !i && n(e),
                            So(e, function(e) {
                                t(e, n, !0, i);
                            }),
                            r && i && n(e);
                    })(e, function(e) {
                        _s(n, e);
                    }),
                    t
                );
            }
            function _s(e, t) {
                var n = Co(t);
                if (n) {
                    for (var r = [], i = [], o = -1, s = 0; s < n.length; s++)
                        3 === n[s].status ||
                            (1 === n[s].status
                                ? (g(
                                      o === s - 1,
                                      'All SENT items should be at beginning of queue.'
                                  ),
                                  (n[(o = s)].status = 3),
                                  (n[s].abortReason = 'set'))
                                : (g(0 === n[s].status, 'Unexpected transaction status in abort'),
                                  n[s].unwatcher(),
                                  (i = i.concat(Yi(e.serverSyncTree_, n[s].currentWriteId, !0))),
                                  n[s].onComplete &&
                                      r.push(
                                          n[s].onComplete.bind(null, new Error('set'), !1, null)
                                      )));
                    for (
                        -1 === o ? bo(t, void 0) : (n.length = o + 1),
                            Ho(e.eventQueue_, To(t), i),
                            s = 0;
                        s < r.length;
                        s++
                    )
                        Me(r[s]);
                }
            }
            function ys(e, t) {
                var n = vs(e),
                    r = n.namespace;
                return (
                    'firebase.com' === n.domain &&
                        de(
                            n.host +
                                ' is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead'
                        ),
                    (r && 'undefined' !== r) ||
                        'localhost' === n.domain ||
                        de(
                            'Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com'
                        ),
                    n.secure ||
                        ('undefined' != typeof window &&
                            window.location &&
                            window.location.protocol &&
                            -1 !== window.location.protocol.indexOf('https:') &&
                            Ee(
                                'Insecure Firebase access from a secure page. Please use https in calls to new Firebase().'
                            )),
                    (e = 'ws' === n.scheme || 'wss' === n.scheme),
                    {
                        repoInfo: new He(n.host, n.secure, r, t, e, '', r !== n.subdomain),
                        path: new bt(n.pathString),
                    }
                );
            }
            var vs = function(i) {
                    var o,
                        s,
                        e,
                        t = '',
                        n = '',
                        r = '',
                        a = '',
                        u = '',
                        l = !0,
                        h = 'https',
                        c = 443;
                    return (
                        'string' == typeof i &&
                            (0 <= (e = i.indexOf('//')) &&
                                ((h = i.substring(0, e - 1)), (i = i.substring(e + 2))),
                            -1 === (o = i.indexOf('/')) && (o = i.length),
                            -1 === (s = i.indexOf('?')) && (s = i.length),
                            (t = i.substring(0, Math.min(o, s))),
                            o < s &&
                                (a = (function() {
                                    for (
                                        var e = '', t = i.substring(o, s).split('/'), n = 0;
                                        n < t.length;
                                        n++
                                    )
                                        if (0 < t[n].length) {
                                            var r = t[n];
                                            try {
                                                r = decodeURIComponent(r.replace(/\+/g, ' '));
                                            } catch (e) {}
                                            e += '/' + r;
                                        }
                                    return e;
                                })()),
                            (s = (function(e) {
                                var t,
                                    n,
                                    r = {};
                                '?' === e.charAt(0) && (e = e.substring(1));
                                try {
                                    for (
                                        var i = _(e.split('&')), o = i.next();
                                        !o.done;
                                        o = i.next()
                                    ) {
                                        var s,
                                            a = o.value;
                                        0 !== a.length &&
                                            (2 === (s = a.split('=')).length
                                                ? (r[decodeURIComponent(s[0])] = decodeURIComponent(
                                                      s[1]
                                                  ))
                                                : Ee(
                                                      "Invalid query segment '" +
                                                          a +
                                                          "' in query '" +
                                                          e +
                                                          "'"
                                                  ));
                                    }
                                } catch (e) {
                                    t = {error: e};
                                } finally {
                                    try {
                                        o && !o.done && (n = i.return) && n.call(i);
                                    } finally {
                                        if (t) throw t.error;
                                    }
                                }
                                return r;
                            })(i.substring(Math.min(i.length, s)))),
                            0 <= (e = t.indexOf(':'))
                                ? ((l = 'https' === h || 'wss' === h),
                                  (c = parseInt(t.substring(e + 1), 10)))
                                : (e = t.length),
                            'localhost' === (e = t.slice(0, e)).toLowerCase()
                                ? (n = 'localhost')
                                : e.split('.').length <= 2
                                ? (n = e)
                                : ((e = t.indexOf('.')),
                                  (r = t.substring(0, e).toLowerCase()),
                                  (n = t.substring(e + 1)),
                                  (u = r)),
                            'ns' in s && (u = s.ns)),
                        {
                            host: t,
                            port: c,
                            domain: n,
                            subdomain: r,
                            secure: l,
                            scheme: h,
                            pathString: a,
                            namespace: u,
                        }
                    );
                },
                gs =
                    ((ms.prototype.val = function() {
                        return M('DataSnapshot.val', 0, 0, arguments.length), this.node_.val();
                    }),
                    (ms.prototype.exportVal = function() {
                        return (
                            M('DataSnapshot.exportVal', 0, 0, arguments.length), this.node_.val(!0)
                        );
                    }),
                    (ms.prototype.toJSON = function() {
                        return M('DataSnapshot.toJSON', 0, 1, arguments.length), this.exportVal();
                    }),
                    (ms.prototype.exists = function() {
                        return (
                            M('DataSnapshot.exists', 0, 0, arguments.length), !this.node_.isEmpty()
                        );
                    }),
                    (ms.prototype.child = function(e) {
                        M('DataSnapshot.child', 0, 1, arguments.length),
                            Ao('DataSnapshot.child', 1, (e = String(e)), !1);
                        var t = new bt(e),
                            e = this.ref_.child(t);
                        return new ms(this.node_.getChild(t), e, bn);
                    }),
                    (ms.prototype.hasChild = function(e) {
                        return (
                            M('DataSnapshot.hasChild', 1, 1, arguments.length),
                            Ao('DataSnapshot.hasChild', 1, e, !1),
                            (e = new bt(e)),
                            !this.node_.getChild(e).isEmpty()
                        );
                    }),
                    (ms.prototype.getPriority = function() {
                        return (
                            M('DataSnapshot.getPriority', 0, 0, arguments.length),
                            this.node_.getPriority().val()
                        );
                    }),
                    (ms.prototype.forEach = function(n) {
                        var r = this;
                        return (
                            M('DataSnapshot.forEach', 1, 1, arguments.length),
                            q('DataSnapshot.forEach', 1, n, !1),
                            !this.node_.isLeafNode() &&
                                !!this.node_.forEachChild(this.index_, function(e, t) {
                                    return n(new ms(t, r.ref_.child(e), bn));
                                })
                        );
                    }),
                    (ms.prototype.hasChildren = function() {
                        return (
                            M('DataSnapshot.hasChildren', 0, 0, arguments.length),
                            !this.node_.isLeafNode() && !this.node_.isEmpty()
                        );
                    }),
                    Object.defineProperty(ms.prototype, 'key', {
                        get: function() {
                            return this.ref_.getKey();
                        },
                        enumerable: !1,
                        configurable: !0,
                    }),
                    (ms.prototype.numChildren = function() {
                        return (
                            M('DataSnapshot.numChildren', 0, 0, arguments.length),
                            this.node_.numChildren()
                        );
                    }),
                    (ms.prototype.getRef = function() {
                        return M('DataSnapshot.ref', 0, 0, arguments.length), this.ref_;
                    }),
                    Object.defineProperty(ms.prototype, 'ref', {
                        get: function() {
                            return this.getRef();
                        },
                        enumerable: !1,
                        configurable: !0,
                    }),
                    ms);
            function ms(e, t, n) {
                (this.node_ = e), (this.ref_ = t), (this.index_ = n);
            }
            var ws =
                ((Cs.prototype.cancel = function(e) {
                    M('OnDisconnect.cancel', 0, 1, arguments.length),
                        q('OnDisconnect.cancel', 1, e, !0);
                    var n,
                        r,
                        i,
                        t = new d();
                    return (
                        (n = this.repo_),
                        (r = this.path_),
                        (i = t.wrapCallback(e)),
                        n.server_.onDisconnectCancel(r.toString(), function(e, t) {
                            'ok' === e &&
                                !(function e(n, t) {
                                    if (Dt(t)) return (n.value = null), n.children.clear(), !0;
                                    if (null === n.value)
                                        return (
                                            !(0 < n.children.size) ||
                                            ((r = Tt(t)),
                                            (t = Pt(t)),
                                            n.children.has(r) &&
                                                e(n.children.get(r), t) &&
                                                n.children.delete(r),
                                            0 === n.children.size)
                                        );
                                    if (n.value.isLeafNode()) return !1;
                                    var r = n.value;
                                    return (
                                        (n.value = null),
                                        r.forEachChild(bn, function(e, t) {
                                            mr(n, new bt(e), t);
                                        }),
                                        e(n, t)
                                    );
                                })(n.onDisconnect_, r),
                                as(0, i, e, t);
                        }),
                        t.promise
                    );
                }),
                (Cs.prototype.remove = function(e) {
                    M('OnDisconnect.remove', 0, 1, arguments.length),
                        Lo('OnDisconnect.remove', this.path_),
                        q('OnDisconnect.remove', 1, e, !0);
                    var t = new d();
                    return rs(this.repo_, this.path_, null, t.wrapCallback(e)), t.promise;
                }),
                (Cs.prototype.set = function(e, t) {
                    M('OnDisconnect.set', 1, 2, arguments.length),
                        Lo('OnDisconnect.set', this.path_),
                        Ro('OnDisconnect.set', 1, e, this.path_, !1),
                        q('OnDisconnect.set', 2, t, !0);
                    var n = new d();
                    return rs(this.repo_, this.path_, e, n.wrapCallback(t)), n.promise;
                }),
                (Cs.prototype.setWithPriority = function(e, t, n) {
                    M('OnDisconnect.setWithPriority', 2, 3, arguments.length),
                        Lo('OnDisconnect.setWithPriority', this.path_),
                        Ro('OnDisconnect.setWithPriority', 1, e, this.path_, !1),
                        ko('OnDisconnect.setWithPriority', 2, t, !1),
                        q('OnDisconnect.setWithPriority', 3, n, !0);
                    var r = new d(),
                        i = this.repo_,
                        o = this.path_,
                        s = r.wrapCallback(n),
                        a = qn(e, t);
                    return (
                        i.server_.onDisconnectPut(o.toString(), a.val(!0), function(e, t) {
                            'ok' === e && mr(i.onDisconnect_, o, a), as(0, s, e, t);
                        }),
                        r.promise
                    );
                }),
                (Cs.prototype.update = function(e, t) {
                    if (
                        (M('OnDisconnect.update', 1, 2, arguments.length),
                        Lo('OnDisconnect.update', this.path_),
                        Array.isArray(e))
                    ) {
                        for (var n = {}, r = 0; r < e.length; ++r) n['' + r] = e[r];
                        (e = n),
                            Ee(
                                'Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.'
                            );
                    }
                    xo('OnDisconnect.update', 1, e, this.path_, !1),
                        q('OnDisconnect.update', 2, t, !0);
                    var i,
                        o,
                        s,
                        a,
                        u = new d();
                    return (
                        (i = this.repo_),
                        (o = this.path_),
                        (s = e),
                        (a = u.wrapCallback(t)),
                        D(s)
                            ? (Ce(
                                  "onDisconnect().update() called with empty data.  Don't do anything."
                              ),
                              as(0, a, 'ok', void 0))
                            : i.server_.onDisconnectMerge(o.toString(), s, function(e, t) {
                                  'ok' === e &&
                                      Ne(s, function(e, t) {
                                          (t = qn(t)), mr(i.onDisconnect_, kt(o, e), t);
                                      }),
                                      as(0, a, e, t);
                              }),
                        u.promise
                    );
                }),
                Cs);
            function Cs(e, t) {
                (this.repo_ = e), (this.path_ = t);
            }
            var bs =
                ((Es.prototype.getPath = function() {
                    var e = this.snapshot.getRef();
                    return ('value' === this.eventType ? e : e.getParent()).path;
                }),
                (Es.prototype.getEventType = function() {
                    return this.eventType;
                }),
                (Es.prototype.getEventRunner = function() {
                    return this.eventRegistration.getEventRunner(this);
                }),
                (Es.prototype.toString = function() {
                    return (
                        this.getPath().toString() +
                        ':' +
                        this.eventType +
                        ':' +
                        N(this.snapshot.exportVal())
                    );
                }),
                Es);
            function Es(e, t, n, r) {
                (this.eventType = e),
                    (this.eventRegistration = t),
                    (this.snapshot = n),
                    (this.prevName = r);
            }
            var Ss =
                ((Ts.prototype.getPath = function() {
                    return this.path;
                }),
                (Ts.prototype.getEventType = function() {
                    return 'cancel';
                }),
                (Ts.prototype.getEventRunner = function() {
                    return this.eventRegistration.getEventRunner(this);
                }),
                (Ts.prototype.toString = function() {
                    return this.path.toString() + ':cancel';
                }),
                Ts);
            function Ts(e, t, n) {
                (this.eventRegistration = e), (this.error = t), (this.path = n);
            }
            var Is =
                ((Ps.prototype.respondsTo = function(e) {
                    return 'value' === e;
                }),
                (Ps.prototype.createEvent = function(e, t) {
                    var n = t.getQueryParams().getIndex();
                    return new bs('value', this, new gs(e.snapshotNode, t.getRef(), n));
                }),
                (Ps.prototype.getEventRunner = function(e) {
                    var t = this.context_;
                    if ('cancel' === e.getEventType()) {
                        g(
                            this.cancelCallback_,
                            'Raising a cancel event on a listener with no cancel callback'
                        );
                        var n = this.cancelCallback_;
                        return function() {
                            n.call(t, e.error);
                        };
                    }
                    var r = this.callback_;
                    return function() {
                        r.call(t, e.snapshot);
                    };
                }),
                (Ps.prototype.createCancelEvent = function(e, t) {
                    return this.cancelCallback_ ? new Ss(this, e, t) : null;
                }),
                (Ps.prototype.matches = function(e) {
                    return (
                        e instanceof Ps &&
                        (!e.callback_ ||
                            !this.callback_ ||
                            (e.callback_ === this.callback_ && e.context_ === this.context_))
                    );
                }),
                (Ps.prototype.hasAnyCallback = function() {
                    return null !== this.callback_;
                }),
                Ps);
            function Ps(e, t, n) {
                (this.callback_ = e), (this.cancelCallback_ = t), (this.context_ = n);
            }
            var Ns,
                Rs =
                    ((xs.prototype.respondsTo = function(e) {
                        return (
                            (e =
                                'children_removed' ===
                                (e = 'children_added' === e ? 'child_added' : e)
                                    ? 'child_removed'
                                    : e),
                            x(this.callbacks_, e)
                        );
                    }),
                    (xs.prototype.createCancelEvent = function(e, t) {
                        return this.cancelCallback_ ? new Ss(this, e, t) : null;
                    }),
                    (xs.prototype.createEvent = function(e, t) {
                        g(null != e.childName, 'Child events should have a childName.');
                        var n = t.getRef().child(e.childName),
                            t = t.getQueryParams().getIndex();
                        return new bs(e.type, this, new gs(e.snapshotNode, n, t), e.prevName);
                    }),
                    (xs.prototype.getEventRunner = function(e) {
                        var t = this.context_;
                        if ('cancel' === e.getEventType()) {
                            g(
                                this.cancelCallback_,
                                'Raising a cancel event on a listener with no cancel callback'
                            );
                            var n = this.cancelCallback_;
                            return function() {
                                n.call(t, e.error);
                            };
                        }
                        var r = this.callbacks_[e.eventType];
                        return function() {
                            r.call(t, e.snapshot, e.prevName);
                        };
                    }),
                    (xs.prototype.matches = function(t) {
                        var n = this;
                        if (t instanceof xs) {
                            if (!this.callbacks_ || !t.callbacks_) return !0;
                            if (this.context_ === t.context_) {
                                var e = Object.keys(t.callbacks_),
                                    r = Object.keys(this.callbacks_),
                                    i = e.length;
                                if (i === r.length)
                                    return 1 !== i
                                        ? r.every(function(e) {
                                              return t.callbacks_[e] === n.callbacks_[e];
                                          })
                                        : ((e = e[0]),
                                          !(
                                              (r = r[0]) !== e ||
                                              (t.callbacks_[e] &&
                                                  this.callbacks_[r] &&
                                                  t.callbacks_[e] !== this.callbacks_[r])
                                          ));
                            }
                        }
                        return !1;
                    }),
                    (xs.prototype.hasAnyCallback = function() {
                        return null !== this.callbacks_;
                    }),
                    xs);
            function xs(e, t, n) {
                (this.callbacks_ = e), (this.cancelCallback_ = t), (this.context_ = n);
            }
            Object.defineProperty(ks, '__referenceConstructor', {
                get: function() {
                    return g(Ns, 'Reference.ts has not been loaded'), Ns;
                },
                set: function(e) {
                    Ns = e;
                },
                enumerable: !1,
                configurable: !0,
            }),
                (ks.validateQueryEndpoints_ = function(e) {
                    var t = null,
                        n = null;
                    if (
                        (e.hasStart() && (t = e.getIndexStartValue()),
                        e.hasEnd() && (n = e.getIndexEndValue()),
                        e.getIndex() === tn)
                    ) {
                        var r =
                                'Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().',
                            i =
                                'Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.';
                        if (e.hasStart()) {
                            if (e.getIndexStartName() !== Se) throw new Error(r);
                            if ('string' != typeof t) throw new Error(i);
                        }
                        if (e.hasEnd()) {
                            if (e.getIndexEndName() !== Te) throw new Error(r);
                            if ('string' != typeof n) throw new Error(i);
                        }
                    } else if (e.getIndex() === bn) {
                        if ((null != t && !No(t)) || (null != n && !No(n)))
                            throw new Error(
                                'Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).'
                            );
                    } else if (
                        (g(
                            e.getIndex() instanceof jn || e.getIndex() === Yn,
                            'unknown index type.'
                        ),
                        (null != t && 'object' == typeof t) || (null != n && 'object' == typeof n))
                    )
                        throw new Error(
                            'Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.'
                        );
                }),
                (ks.validateLimit_ = function(e) {
                    if (e.hasStart() && e.hasEnd() && e.hasLimit() && !e.hasAnchoredLimit())
                        throw new Error(
                            "Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead."
                        );
                }),
                (ks.prototype.validateNoPreviousOrderByCall_ = function(e) {
                    if (!0 === this.orderByCalled_)
                        throw new Error(e + ": You can't combine multiple orderBy calls.");
                }),
                (ks.prototype.getQueryParams = function() {
                    return this.queryParams_;
                }),
                (ks.prototype.getRef = function() {
                    return (
                        M('Query.ref', 0, 0, arguments.length),
                        new ks.__referenceConstructor(this.database, this.path)
                    );
                }),
                (ks.prototype.on = function(e, t, n, r) {
                    return (
                        M('Query.on', 2, 4, arguments.length),
                        Do('Query.on', 1, e, !1),
                        q('Query.on', 2, t, !1),
                        (n = ks.getCancelAndContextArgs_('Query.on', n, r)),
                        'value' === e
                            ? this.onValueEvent(t, n.cancel, n.context)
                            : (((r = {})[e] = t), this.onChildEvent(r, n.cancel, n.context)),
                        t
                    );
                }),
                (ks.prototype.onValueEvent = function(e, t, n) {
                    (n = new Is(e, t || null, n || null)), is(this.repo, this, n);
                }),
                (ks.prototype.onChildEvent = function(e, t, n) {
                    (n = new Rs(e, t, n)), is(this.repo, this, n);
                }),
                (ks.prototype.off = function(e, t, n) {
                    M('Query.off', 0, 3, arguments.length),
                        Do('Query.off', 1, e, !0),
                        q('Query.off', 2, t, !0),
                        W('Query.off', 3, n, !0);
                    var r = null,
                        i = null;
                    'value' === e
                        ? (r = new Is(t || null, null, n || null))
                        : e && (t && ((i = {})[e] = t), (r = new Rs(i, null, n || null))),
                        (i = this.repo),
                        (n = r),
                        (n =
                            '.info' === Tt((r = this).path)
                                ? $i(i.infoSyncTree_, r, n)
                                : $i(i.serverSyncTree_, r, n)),
                        Bo(i.eventQueue_, r.path, n);
                }),
                (ks.prototype.get = function() {
                    var e,
                        t = this,
                        n = this.repo,
                        r = this;
                    return (null !=
                    (e = (function(e, t) {
                        var n = t.path,
                            r = null;
                        e.syncPointTree_.foreachOnPath(n, function(e, t) {
                            (e = Ot(e, n)), (r = r || Qi(t, e));
                        });
                        var i = e.syncPointTree_.get(n);
                        i
                            ? (r = r || Qi(i, St()))
                            : ((i = new Mi()), (e.syncPointTree_ = e.syncPointTree_.set(n, i)));
                        var o = null != r,
                            s = o ? new Fr(r, !0, !1) : null;
                        return Vr(
                            (o = qi(
                                i,
                                t,
                                si(e.pendingWriteTree_, t.path),
                                o ? s.getNode() : On.EMPTY_NODE,
                                o
                            )).viewCache_
                        );
                    })(n.serverSyncTree_, r))
                        ? Promise.resolve(e)
                        : n.server_.get(r).then(
                              function(e) {
                                  var t = qn(e),
                                      e = Gi(n.serverSyncTree_, r.path, t);
                                  return Bo(n.eventQueue_, r.path, e), Promise.resolve(t);
                              },
                              function(e) {
                                  return (
                                      ss(n, 'get for query ' + N(r) + ' failed: ' + e),
                                      Promise.reject(new Error(e))
                                  );
                              }
                          )
                    ).then(function(e) {
                        return new gs(e, t.getRef(), t.getQueryParams().getIndex());
                    });
                }),
                (ks.prototype.once = function(t, n, e, r) {
                    var i = this;
                    M('Query.once', 1, 4, arguments.length),
                        Do('Query.once', 1, t, !1),
                        q('Query.once', 2, n, !0);
                    var o = ks.getCancelAndContextArgs_('Query.once', e, r),
                        s = !0,
                        a = new d();
                    a.promise.catch(function() {});
                    var u = function(e) {
                        s && ((s = !1), i.off(t, u), n && n.bind(o.context)(e), a.resolve(e));
                    };
                    return (
                        this.on(t, u, function(e) {
                            i.off(t, u), o.cancel && o.cancel.bind(o.context)(e), a.reject(e);
                        }),
                        a.promise
                    );
                }),
                (ks.prototype.limitToFirst = function(e) {
                    if (
                        (M('Query.limitToFirst', 1, 1, arguments.length),
                        'number' != typeof e || Math.floor(e) !== e || e <= 0)
                    )
                        throw new Error(
                            'Query.limitToFirst: First argument must be a positive integer.'
                        );
                    if (this.queryParams_.hasLimit())
                        throw new Error(
                            'Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).'
                        );
                    return new ks(
                        this.database,
                        this.path,
                        (((t = (t = this.queryParams_).copy()).limitSet_ = !0),
                        (t.limit_ = e),
                        (t.viewFrom_ = 'l'),
                        t),
                        this.orderByCalled_
                    );
                    var t;
                }),
                (ks.prototype.limitToLast = function(e) {
                    if (
                        (M('Query.limitToLast', 1, 1, arguments.length),
                        'number' != typeof e || Math.floor(e) !== e || e <= 0)
                    )
                        throw new Error(
                            'Query.limitToLast: First argument must be a positive integer.'
                        );
                    if (this.queryParams_.hasLimit())
                        throw new Error(
                            'Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).'
                        );
                    return new ks(
                        this.database,
                        this.path,
                        (((t = (t = this.queryParams_).copy()).limitSet_ = !0),
                        (t.limit_ = e),
                        (t.viewFrom_ = 'r'),
                        t),
                        this.orderByCalled_
                    );
                    var t;
                }),
                (ks.prototype.orderByChild = function(e) {
                    if ((M('Query.orderByChild', 1, 1, arguments.length), '$key' === e))
                        throw new Error(
                            'Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.'
                        );
                    if ('$priority' === e)
                        throw new Error(
                            'Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.'
                        );
                    if ('$value' === e)
                        throw new Error(
                            'Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.'
                        );
                    if (
                        (Ao('Query.orderByChild', 1, e, !1),
                        this.validateNoPreviousOrderByCall_('Query.orderByChild'),
                        Dt((e = new bt(e))))
                    )
                        throw new Error(
                            'Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.'
                        );
                    return (
                        (e = new jn(e)),
                        (e = cr(this.queryParams_, e)),
                        ks.validateQueryEndpoints_(e),
                        new ks(this.database, this.path, e, !0)
                    );
                }),
                (ks.prototype.orderByKey = function() {
                    M('Query.orderByKey', 0, 0, arguments.length),
                        this.validateNoPreviousOrderByCall_('Query.orderByKey');
                    var e = cr(this.queryParams_, tn);
                    return ks.validateQueryEndpoints_(e), new ks(this.database, this.path, e, !0);
                }),
                (ks.prototype.orderByPriority = function() {
                    M('Query.orderByPriority', 0, 0, arguments.length),
                        this.validateNoPreviousOrderByCall_('Query.orderByPriority');
                    var e = cr(this.queryParams_, bn);
                    return ks.validateQueryEndpoints_(e), new ks(this.database, this.path, e, !0);
                }),
                (ks.prototype.orderByValue = function() {
                    M('Query.orderByValue', 0, 0, arguments.length),
                        this.validateNoPreviousOrderByCall_('Query.orderByValue');
                    var e = cr(this.queryParams_, Yn);
                    return ks.validateQueryEndpoints_(e), new ks(this.database, this.path, e, !0);
                }),
                (ks.prototype.startAt = function(e, t) {
                    void 0 === e && (e = null),
                        M('Query.startAt', 0, 2, arguments.length),
                        Ro('Query.startAt', 1, e, this.path, !0),
                        Oo('Query.startAt', 2, t, !0);
                    var n = lr(this.queryParams_, e, t);
                    if (
                        (ks.validateLimit_(n),
                        ks.validateQueryEndpoints_(n),
                        this.queryParams_.hasStart())
                    )
                        throw new Error(
                            'Query.startAt: Starting point was already set (by another call to startAt or equalTo).'
                        );
                    return (
                        void 0 === e && (t = e = null),
                        new ks(this.database, this.path, n, this.orderByCalled_)
                    );
                }),
                (ks.prototype.startAfter = function(e, t) {
                    void 0 === e && (e = null),
                        M('Query.startAfter', 0, 2, arguments.length),
                        Ro('Query.startAfter', 1, e, this.path, !1),
                        Oo('Query.startAfter', 2, t, !0);
                    var n,
                        t =
                            (((t =
                                (n = this.queryParams_).index_ === tn
                                    ? lr(n, (e = 'string' == typeof e ? Hn(e) : e), t)
                                    : lr(n, e, null == t ? Te : Hn(t))).startAfterSet_ = !0),
                            t);
                    if (
                        (ks.validateLimit_(t),
                        ks.validateQueryEndpoints_(t),
                        this.queryParams_.hasStart())
                    )
                        throw new Error(
                            'Query.startAfter: Starting point was already set (by another call to startAt, startAfter or equalTo).'
                        );
                    return new ks(this.database, this.path, t, this.orderByCalled_);
                }),
                (ks.prototype.endAt = function(e, t) {
                    if (
                        (void 0 === e && (e = null),
                        M('Query.endAt', 0, 2, arguments.length),
                        Ro('Query.endAt', 1, e, this.path, !0),
                        Oo('Query.endAt', 2, t, !0),
                        (t = hr(this.queryParams_, e, t)),
                        ks.validateLimit_(t),
                        ks.validateQueryEndpoints_(t),
                        this.queryParams_.hasEnd())
                    )
                        throw new Error(
                            'Query.endAt: Ending point was already set (by another call to endAt, endBefore, or equalTo).'
                        );
                    return new ks(this.database, this.path, t, this.orderByCalled_);
                }),
                (ks.prototype.endBefore = function(e, t) {
                    void 0 === e && (e = null),
                        M('Query.endBefore', 0, 2, arguments.length),
                        Ro('Query.endBefore', 1, e, this.path, !1),
                        Oo('Query.endBefore', 2, t, !0);
                    var n,
                        t =
                            (((t =
                                (n = this.queryParams_).index_ === tn
                                    ? hr(n, (e = 'string' == typeof e ? Vn(e) : e), t)
                                    : hr(n, e, null == t ? Se : Vn(t))).endBeforeSet_ = !0),
                            t);
                    if (
                        (ks.validateLimit_(t),
                        ks.validateQueryEndpoints_(t),
                        this.queryParams_.hasEnd())
                    )
                        throw new Error(
                            'Query.endBefore: Ending point was already set (by another call to endAt, endBefore, or equalTo).'
                        );
                    return new ks(this.database, this.path, t, this.orderByCalled_);
                }),
                (ks.prototype.equalTo = function(e, t) {
                    if (
                        (M('Query.equalTo', 1, 2, arguments.length),
                        Ro('Query.equalTo', 1, e, this.path, !1),
                        Oo('Query.equalTo', 2, t, !0),
                        this.queryParams_.hasStart())
                    )
                        throw new Error(
                            'Query.equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).'
                        );
                    if (this.queryParams_.hasEnd())
                        throw new Error(
                            'Query.equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).'
                        );
                    return this.startAt(e, t).endAt(e, t);
                }),
                (ks.prototype.toString = function() {
                    return (
                        M('Query.toString', 0, 0, arguments.length),
                        this.repo.toString() +
                            (function(e) {
                                for (var t = '', n = e.pieceNum_; n < e.pieces_.length; n++)
                                    '' !== e.pieces_[n] &&
                                        (t += '/' + encodeURIComponent(String(e.pieces_[n])));
                                return t || '/';
                            })(this.path)
                    );
                }),
                (ks.prototype.toJSON = function() {
                    return M('Query.toJSON', 0, 1, arguments.length), this.toString();
                }),
                (ks.prototype.queryObject = function() {
                    return (
                        (n = {}),
                        (e = this.queryParams_).startSet_ &&
                            ((n.sp = e.indexStartValue_),
                            e.startNameSet_ && (n.sn = e.indexStartName_)),
                        e.endSet_ &&
                            ((n.ep = e.indexEndValue_), e.endNameSet_ && (n.en = e.indexEndName_)),
                        e.limitSet_ &&
                            ((n.l = e.limit_),
                            '' === (t = e.viewFrom_) && (t = e.isViewFromLeft() ? 'l' : 'r'),
                            (n.vf = t)),
                        e.index_ !== bn && (n.i = e.index_.toString()),
                        n
                    );
                    var e, t, n;
                }),
                (ks.prototype.queryIdentifier = function() {
                    var e = this.queryObject();
                    return '{}' === (e = Pe(e)) ? 'default' : e;
                }),
                (ks.prototype.isEqual = function(e) {
                    if ((M('Query.isEqual', 1, 1, arguments.length), !(e instanceof ks)))
                        throw new Error(
                            'Query.isEqual failed: First argument must be an instance of firebase.database.Query.'
                        );
                    var t = this.repo === e.repo,
                        n = Lt(this.path, e.path),
                        e = this.queryIdentifier() === e.queryIdentifier();
                    return t && n && e;
                }),
                (ks.getCancelAndContextArgs_ = function(e, t, n) {
                    var r = {cancel: null, context: null};
                    if (t && n)
                        (r.cancel = t),
                            q(e, 3, r.cancel, !0),
                            (r.context = n),
                            W(e, 4, r.context, !0);
                    else if (t)
                        if ('object' == typeof t && null !== t) r.context = t;
                        else {
                            if ('function' != typeof t)
                                throw new Error(
                                    F(e, 3, !0) +
                                        ' must either be a cancel callback or a context object.'
                                );
                            r.cancel = t;
                        }
                    return r;
                }),
                Object.defineProperty(ks.prototype, 'ref', {
                    get: function() {
                        return this.getRef();
                    },
                    enumerable: !1,
                    configurable: !0,
                }),
                (vt = ks);
            function ks(e, t, n, r) {
                (this.database = e),
                    (this.path = t),
                    (this.queryParams_ = n),
                    (this.orderByCalled_ = r),
                    (this.repo = e.repo_);
            }
            var Ds =
                ((Os.prototype.toJSON = function() {
                    return (
                        M('TransactionResult.toJSON', 0, 1, arguments.length),
                        {committed: this.committed, snapshot: this.snapshot.toJSON()}
                    );
                }),
                Os);
            function Os(e, t) {
                (this.committed = e), (this.snapshot = t);
            }
            var As,
                Ls =
                    (n(Ms, (As = vt)),
                    (Ms.prototype.getKey = function() {
                        return (
                            M('Reference.key', 0, 0, arguments.length),
                            Dt(this.path) ? null : Nt(this.path)
                        );
                    }),
                    (Ms.prototype.child = function(e) {
                        var t;
                        return (
                            M('Reference.child', 1, 1, arguments.length),
                            'number' == typeof e
                                ? (e = String(e))
                                : e instanceof bt ||
                                  (null === Tt(this.path)
                                      ? (0,
                                        Ao(
                                            'Reference.child',
                                            1,
                                            (t = (t = e) && t.replace(/^\/*\.info(\/|$)/, '/')),
                                            !1
                                        ))
                                      : Ao('Reference.child', 1, e, !1)),
                            new Ms(this.database, kt(this.path, e))
                        );
                    }),
                    (Ms.prototype.getParent = function() {
                        M('Reference.parent', 0, 0, arguments.length);
                        var e = xt(this.path);
                        return null === e ? null : new Ms(this.database, e);
                    }),
                    (Ms.prototype.getRoot = function() {
                        M('Reference.root', 0, 0, arguments.length);
                        for (var e = this; null !== e.getParent(); ) e = e.getParent();
                        return e;
                    }),
                    (Ms.prototype.set = function(e, t) {
                        M('Reference.set', 1, 2, arguments.length),
                            Lo('Reference.set', this.path),
                            Ro('Reference.set', 1, e, this.path, !1),
                            q('Reference.set', 2, t, !0);
                        var n = new d();
                        return ns(this.repo, this.path, e, null, n.wrapCallback(t)), n.promise;
                    }),
                    (Ms.prototype.update = function(e, t) {
                        if (
                            (M('Reference.update', 1, 2, arguments.length),
                            Lo('Reference.update', this.path),
                            Array.isArray(e))
                        ) {
                            for (var n = {}, r = 0; r < e.length; ++r) n['' + r] = e[r];
                            (e = n),
                                Ee(
                                    'Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.'
                                );
                        }
                        xo('Reference.update', 1, e, this.path, !1),
                            q('Reference.update', 2, t, !0);
                        var i = new d();
                        return (
                            (function(i, o, e, s) {
                                ss(i, 'update', {path: o.toString(), value: e});
                                var a,
                                    t,
                                    n,
                                    r,
                                    u,
                                    l,
                                    h,
                                    c,
                                    d = !0,
                                    p = Jo(i),
                                    f = {};
                                Ne(e, function(e, t) {
                                    (d = !1), (f[e] = yo(kt(o, e), qn(t), i.serverSyncTree_, p));
                                }),
                                    d
                                        ? (Ce(
                                              "update() called with empty data.  Don't do anything."
                                          ),
                                          as(0, s, 'ok', void 0))
                                        : ((a = ts(i)),
                                          (t = i.serverSyncTree_),
                                          (n = o),
                                          (r = f),
                                          (u = a),
                                          (l = t.pendingWriteTree_),
                                          (h = n),
                                          (c = r),
                                          g(
                                              u > l.lastWriteId,
                                              'Stacking an older merge on top of newer ones'
                                          ),
                                          l.allWrites.push({
                                              path: h,
                                              children: c,
                                              writeId: u,
                                              visible: !0,
                                          }),
                                          (l.visibleWrites = Xr(l.visibleWrites, h, c)),
                                          (l.lastWriteId = u),
                                          (r = Kr.fromObject(r)),
                                          (r = Zi(t, new Lr(Ir(), n, r))),
                                          Uo(i.eventQueue_, r),
                                          i.server_.merge(o.toString(), e, function(e, t) {
                                              (r = 'ok' === e) ||
                                                  Ee('update at ' + o + ' failed: ' + e);
                                              var n = Yi(i.serverSyncTree_, a, !r),
                                                  r = 0 < n.length ? hs(i, o) : o;
                                              Ho(i.eventQueue_, r, n), as(0, s, e, t);
                                          }),
                                          Ne(e, function(e) {
                                              (e = fs(i, kt(o, e))), hs(i, e);
                                          }),
                                          Ho(i.eventQueue_, o, []));
                            })(this.repo, this.path, e, i.wrapCallback(t)),
                            i.promise
                        );
                    }),
                    (Ms.prototype.setWithPriority = function(e, t, n) {
                        if (
                            (M('Reference.setWithPriority', 2, 3, arguments.length),
                            Lo('Reference.setWithPriority', this.path),
                            Ro('Reference.setWithPriority', 1, e, this.path, !1),
                            ko('Reference.setWithPriority', 2, t, !1),
                            q('Reference.setWithPriority', 3, n, !0),
                            '.length' === this.getKey() || '.keys' === this.getKey())
                        )
                            throw 'Reference.setWithPriority failed: ' +
                                this.getKey() +
                                ' is a read-only object.';
                        var r = new d();
                        return ns(this.repo, this.path, e, t, r.wrapCallback(n)), r.promise;
                    }),
                    (Ms.prototype.remove = function(e) {
                        return (
                            M('Reference.remove', 0, 1, arguments.length),
                            Lo('Reference.remove', this.path),
                            q('Reference.remove', 1, e, !0),
                            this.set(null, e)
                        );
                    }),
                    (Ms.prototype.transaction = function(e, r, t) {
                        var i = this;
                        if (
                            (M('Reference.transaction', 1, 3, arguments.length),
                            Lo('Reference.transaction', this.path),
                            q('Reference.transaction', 1, e, !1),
                            q('Reference.transaction', 2, r, !0),
                            (function() {
                                if (void 0 !== t && 'boolean' != typeof t)
                                    throw new Error(
                                        F('Reference.transaction', 3, !0) + 'must be a boolean.'
                                    );
                            })(),
                            '.length' === this.getKey() || '.keys' === this.getKey())
                        )
                            throw 'Reference.transaction failed: ' +
                                this.getKey() +
                                ' is a read-only object.';
                        void 0 === t && (t = !0);
                        var o = new d();
                        function n() {}
                        'function' == typeof r && o.promise.catch(function() {});
                        var s = new Ms(this.database, this.path);
                        return (
                            s.on('value', n),
                            (function(e, t, n, r, i, o) {
                                ss(e, 'transaction on ' + t);
                                var s = {
                                        path: t,
                                        update: n,
                                        onComplete: r,
                                        status: null,
                                        order: ve(),
                                        applyLocally: o,
                                        retryCount: 0,
                                        unwatcher: i,
                                        abortReason: null,
                                        currentWriteId: null,
                                        currentInputSnapshot: null,
                                        currentOutputSnapshotRaw: null,
                                        currentOutputSnapshotResolved: null,
                                    },
                                    n = us(e, t, void 0);
                                (s.currentInputSnapshot = n),
                                    void 0 === (r = s.update(n.val()))
                                        ? (s.unwatcher(),
                                          (s.currentOutputSnapshotRaw = null),
                                          (s.currentOutputSnapshotResolved = null),
                                          s.onComplete &&
                                              s.onComplete(null, !1, s.currentInputSnapshot))
                                        : (jo('transaction failed: Data returned ', r, s.path),
                                          (s.status = 0),
                                          (i = Co((o = wo(e.transactionQueueTree_, t))) || []).push(
                                              s
                                          ),
                                          bo(o, i),
                                          (o = void 0),
                                          'object' == typeof r && null !== r && x(r, '.priority')
                                              ? ((o = k(r, '.priority')),
                                                g(
                                                    No(o),
                                                    'Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.'
                                                ))
                                              : (o = (Xi(e.serverSyncTree_, t) || On.EMPTY_NODE)
                                                    .getPriority()
                                                    .val()),
                                          (i = Jo(e)),
                                          (o = qn(r, o)),
                                          (i = vo(o, n, i)),
                                          (s.currentOutputSnapshotRaw = o),
                                          (s.currentOutputSnapshotResolved = i),
                                          (s.currentWriteId = ts(e)),
                                          (s = Ki(
                                              e.serverSyncTree_,
                                              t,
                                              i,
                                              s.currentWriteId,
                                              s.applyLocally
                                          )),
                                          Ho(e.eventQueue_, t, s),
                                          ls(e, e.transactionQueueTree_));
                            })(
                                this.repo,
                                this.path,
                                e,
                                function(e, t, n) {
                                    e
                                        ? (o.reject(e), 'function' == typeof r && r(e, t, null))
                                        : ((n = new gs(n, new Ms(i.database, i.path), bn)),
                                          o.resolve(new Ds(t, n)),
                                          'function' == typeof r && r(null, t, n));
                                },
                                function() {
                                    s.off('value', n);
                                },
                                t
                            ),
                            o.promise
                        );
                    }),
                    (Ms.prototype.setPriority = function(e, t) {
                        M('Reference.setPriority', 1, 2, arguments.length),
                            Lo('Reference.setPriority', this.path),
                            ko('Reference.setPriority', 1, e, !1),
                            q('Reference.setPriority', 2, t, !0);
                        var n = new d();
                        return (
                            ns(this.repo, kt(this.path, '.priority'), e, null, n.wrapCallback(t)),
                            n.promise
                        );
                    }),
                    (Ms.prototype.push = function(e, t) {
                        M('Reference.push', 0, 2, arguments.length),
                            Lo('Reference.push', this.path),
                            Ro('Reference.push', 1, e, this.path, !0),
                            q('Reference.push', 2, t, !0);
                        var n = $o(this.repo),
                            r = $n(n),
                            n = this.child(r),
                            i = this.child(r),
                            e =
                                null != e
                                    ? n.set(e, t).then(function() {
                                          return i;
                                      })
                                    : Promise.resolve(i);
                        return (
                            (n.then = e.then.bind(e)),
                            (n.catch = e.then.bind(e, void 0)),
                            'function' == typeof t && e.catch(function() {}),
                            n
                        );
                    }),
                    (Ms.prototype.onDisconnect = function() {
                        return (
                            Lo('Reference.onDisconnect', this.path), new ws(this.repo, this.path)
                        );
                    }),
                    Object.defineProperty(Ms.prototype, 'key', {
                        get: function() {
                            return this.getKey();
                        },
                        enumerable: !1,
                        configurable: !0,
                    }),
                    Object.defineProperty(Ms.prototype, 'parent', {
                        get: function() {
                            return this.getParent();
                        },
                        enumerable: !1,
                        configurable: !0,
                    }),
                    Object.defineProperty(Ms.prototype, 'root', {
                        get: function() {
                            return this.getRoot();
                        },
                        enumerable: !1,
                        configurable: !0,
                    }),
                    Ms);
            function Ms(e, t) {
                return As.call(this, e, t, new ar(), !1) || this;
            }
            (Z = vt.__referenceConstructor = Ls),
                g(!Ri, '__referenceConstructor has already been defined'),
                (Ri = Z);
            var Fs = {},
                qs = !1;
            function Ws(e, t, n, r) {
                var i = n || e.options.databaseURL;
                void 0 === i &&
                    (e.options.projectId ||
                        de(
                            "Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."
                        ),
                    Ce('Using default host for project ', e.options.projectId),
                    (i = e.options.projectId + '-default-rtdb.firebaseio.com'));
                var o,
                    s = ys(i, r),
                    a = s.repoInfo,
                    n = void 0;
                return (
                    (n =
                        'undefined' != typeof process
                            ? process.env.FIREBASE_DATABASE_EMULATOR_HOST
                            : n)
                        ? ((o = !0),
                          (i = 'http://' + n + '?ns=' + a.namespace),
                          (a = (s = ys(i, r)).repoInfo))
                        : (o = !s.repoInfo.secure),
                    (t = r && o ? new We() : new Fe(e, t)),
                    Mo('Invalid Firebase Database URL', 1, s),
                    Dt(s.path) ||
                        de(
                            'Database URL must point to the root of a Firebase Database (not including a child path).'
                        ),
                    (t = (function(e, t, n) {
                        var r = k(Fs, t.name);
                        r || ((r = {}), (Fs[t.name] = r));
                        var i = k(r, e.toURLString());
                        return (
                            i &&
                                de(
                                    'Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.'
                                ),
                            (i = new Yo(e, qs, t, n)),
                            (r[e.toURLString()] = i)
                        );
                    })(a, e, t)),
                    new Qs(t)
                );
            }
            var Qs =
                (Object.defineProperty(js.prototype, 'repo_', {
                    get: function() {
                        return (
                            this.instanceStarted_ ||
                                ((function(s) {
                                    if (
                                        ((s.stats_ = Je(s.repoInfo_)),
                                        s.forceRestClient_ ||
                                            0 <=
                                                (
                                                    ('object' == typeof window &&
                                                        window.navigator &&
                                                        window.navigator.userAgent) ||
                                                    ''
                                                ).search(
                                                    /googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i
                                                ))
                                    )
                                        (s.server_ = new fr(
                                            s.repoInfo_,
                                            function(e, t, n, r) {
                                                Xo(s, e, t, n, r);
                                            },
                                            s.authTokenProvider_
                                        )),
                                            setTimeout(function() {
                                                return Zo(s, !0);
                                            }, 0);
                                    else {
                                        var e = s.app.options.databaseAuthVariableOverride;
                                        if (null != e) {
                                            if ('object' != typeof e)
                                                throw new Error(
                                                    'Only objects are supported for option databaseAuthVariableOverride'
                                                );
                                            try {
                                                N(e);
                                            } catch (e) {
                                                throw new Error(
                                                    'Invalid authOverride provided: ' + e
                                                );
                                            }
                                        }
                                        (s.persistentConnection_ = new zt(
                                            s.repoInfo_,
                                            s.app.options.appId,
                                            function(e, t, n, r) {
                                                Xo(s, e, t, n, r);
                                            },
                                            function(e) {
                                                Zo(s, e);
                                            },
                                            function(e) {
                                                var n = s;
                                                Ne(e, function(e, t) {
                                                    es(n, e, t);
                                                });
                                            },
                                            s.authTokenProvider_,
                                            e
                                        )),
                                            (s.server_ = s.persistentConnection_);
                                    }
                                    var t, n;
                                    s.authTokenProvider_.addTokenChangeListener(function(e) {
                                        s.server_.refreshAuthToken(e);
                                    }),
                                        (s.statsReporter_ =
                                            ((n = function() {
                                                return new Sr(s.stats_, s.server_);
                                            }),
                                            (t = (t = s.repoInfo_).toString()),
                                            $e[t] || ($e[t] = n()),
                                            $e[t])),
                                        (s.infoData_ = new yr()),
                                        (s.infoSyncTree_ = new Vi({
                                            startListening: function(e, t, n, r) {
                                                var i = [],
                                                    o = s.infoData_.getNode(e.path);
                                                return (
                                                    o.isEmpty() ||
                                                        ((i = Gi(s.infoSyncTree_, e.path, o)),
                                                        setTimeout(function() {
                                                            r('ok');
                                                        }, 0)),
                                                    i
                                                );
                                            },
                                            stopListening: function() {},
                                        })),
                                        es(s, 'connected', !1),
                                        (s.serverSyncTree_ = new Vi({
                                            startListening: function(n, e, t, r) {
                                                return (
                                                    s.server_.listen(n, t, e, function(e, t) {
                                                        (t = r(e, t)), Ho(s.eventQueue_, n.path, t);
                                                    }),
                                                    []
                                                );
                                            },
                                            stopListening: function(e, t) {
                                                s.server_.unlisten(e, t);
                                            },
                                        }));
                                })(this.repoInternal_),
                                (this.instanceStarted_ = !0)),
                            this.repoInternal_
                        );
                    },
                    enumerable: !1,
                    configurable: !0,
                }),
                Object.defineProperty(js.prototype, 'root_', {
                    get: function() {
                        return (
                            this.rootInternal_ || (this.rootInternal_ = new Ls(this, St())),
                            this.rootInternal_
                        );
                    },
                    enumerable: !1,
                    configurable: !0,
                }),
                Object.defineProperty(js.prototype, 'app', {
                    get: function() {
                        return this.repo_.app;
                    },
                    enumerable: !1,
                    configurable: !0,
                }),
                (js.prototype.useEmulator = function(e, t) {
                    var n;
                    this.checkDeleted_('useEmulator'),
                        this.instanceStarted_
                            ? de(
                                  'Cannot call useEmulator() after instance has already been initialized.'
                              )
                            : (((n = this.repoInternal_).repoInfo_ = new He(
                                  e + ':' + t,
                                  !1,
                                  n.repoInfo_.namespace,
                                  n.repoInfo_.webSocketOnly,
                                  n.repoInfo_.nodeAdmin,
                                  n.repoInfo_.persistenceKey,
                                  n.repoInfo_.includeNamespaceInQueryParams
                              )),
                              n.repoInfo_.nodeAdmin && (n.authTokenProvider_ = new We()));
                }),
                (js.prototype.ref = function(e) {
                    return (
                        this.checkDeleted_('ref'),
                        M('database.ref', 0, 1, arguments.length),
                        e instanceof Ls
                            ? this.refFromURL(e.toString())
                            : void 0 !== e
                            ? this.root_.child(e)
                            : this.root_
                    );
                }),
                (js.prototype.refFromURL = function(e) {
                    var t = 'database.refFromURL';
                    this.checkDeleted_(t), M(t, 1, 1, arguments.length);
                    var n = ys(e, this.repo_.repoInfo_.nodeAdmin);
                    return (
                        Mo(t, 1, n),
                        (e = n.repoInfo),
                        this.repo_.repoInfo_.isCustomHost() ||
                            e.host === this.repo_.repoInfo_.host ||
                            de(
                                t +
                                    ': Host name does not match the current database: (found ' +
                                    e.host +
                                    ' but expected ' +
                                    this.repo_.repoInfo_.host +
                                    ')'
                            ),
                        this.ref(n.path.toString())
                    );
                }),
                (js.prototype.checkDeleted_ = function(e) {
                    null === this.repoInternal_ &&
                        de('Cannot call ' + e + ' on a deleted database.');
                }),
                (js.prototype.goOffline = function() {
                    M('database.goOffline', 0, 0, arguments.length),
                        this.checkDeleted_('goOffline'),
                        os(this.repo_);
                }),
                (js.prototype.goOnline = function() {
                    var e;
                    M('database.goOnline', 0, 0, arguments.length),
                        this.checkDeleted_('goOnline'),
                        (e = this.repo_).persistentConnection_ &&
                            e.persistentConnection_.resume(zo);
                }),
                (js.ServerValue = {
                    TIMESTAMP: {'.sv': 'timestamp'},
                    increment: function(e) {
                        return {'.sv': {increment: e}};
                    },
                }),
                js);
            function js(e) {
                var t = this;
                (this.repoInternal_ = e),
                    (this.instanceStarted_ = !1),
                    (this.INTERNAL = {
                        delete: function() {
                            return i(t, void 0, void 0, function() {
                                return o(this, function(e) {
                                    var t, n;
                                    return (
                                        this.checkDeleted_('delete'),
                                        (t = this.repo_),
                                        ((n = k(Fs, t.app.name)) && k(n, t.key) === t) ||
                                            de(
                                                'Database ' +
                                                    t.app.name +
                                                    '(' +
                                                    t.repoInfo_ +
                                                    ') has already been deleted.'
                                            ),
                                        os(t),
                                        delete n[t.key],
                                        (this.repoInternal_ = null),
                                        (this.rootInternal_ = null),
                                        [2]
                                    );
                                });
                            });
                        },
                    }),
                    e instanceof Yo ||
                        de("Don't call new Database() directly - please use firebase.database().");
            }
            (Xt = Object.freeze({
                __proto__: null,
                forceLongPolling: function() {
                    lt.forceDisallow(), nt.forceAllow();
                },
                forceWebSockets: function() {
                    nt.forceDisallow();
                },
                isWebSocketsAvailable: function() {
                    return lt.isAvailable();
                },
                setSecurityDebugCallback: function(e, t) {
                    e.repo.persistentConnection_.securityDebugCallback_ = t;
                },
                stats: function(e, t) {
                    var i;
                    (e = e.repo),
                        void 0 === t && (t = !1),
                        'undefined' != typeof console &&
                            ((e = t
                                ? (e.statsListener_ || (e.statsListener_ = new Cr(e.stats_)),
                                  e.statsListener_.get())
                                : e.stats_.get()),
                            (i = Object.keys(e).reduce(function(e, t) {
                                return Math.max(t.length, e);
                            }, 0)),
                            Ne(e, function(e, t) {
                                for (var n = e, r = e.length; r < i + 2; r++) n += ' ';
                                console.log(n + t);
                            }));
                },
                statsIncrementCounter: function(e, t) {
                    (e = e.repo).stats_.incrementCounter(t),
                        ((e = e.statsReporter_).statsToReport_[t] = !0);
                },
                dataUpdateCount: function(e) {
                    return e.repo.dataUpdateCount;
                },
                interceptServerData: function(e, t) {
                    (e = e.repo).interceptServerDataCallback_ = t;
                },
                initStandalone: function(e) {
                    var t = e.app,
                        n = e.url,
                        r = e.version,
                        i = e.customAuthImpl,
                        o = e.namespace,
                        e = void 0 !== (e = e.nodeAdmin) && e;
                    return (
                        at(r),
                        (r = new H('auth-internal', new K('database-standalone'))).setComponent(
                            new j(
                                'auth-internal',
                                function() {
                                    return i;
                                },
                                'PRIVATE'
                            )
                        ),
                        {instance: Ws(t, r, n, e), namespace: o}
                    );
                },
            })),
                (_t = zt);
            (zt.prototype.simpleListen = function(e, t) {
                this.sendRequest('q', {p: e}, t);
            }),
                (zt.prototype.echo = function(e, t) {
                    this.sendRequest('echo', {d: e}, t);
                });
            (Z = Object.freeze({
                __proto__: null,
                DataConnection: _t,
                RealTimeConnection: pt,
                hijackHash: function(i) {
                    var o = zt.prototype.put;
                    return (
                        (zt.prototype.put = function(e, t, n, r) {
                            void 0 !== r && (r = i()), o.call(this, e, t, n, r);
                        }),
                        function() {
                            zt.prototype.put = o;
                        }
                    );
                },
                ConnectionTarget: He,
                queryIdentifier: function(e) {
                    return e.queryIdentifier();
                },
                forceRestClient: function(e) {
                    qs = e;
                },
            })),
                (_t = Qs.ServerValue);
            at((t = t.default).SDK_VERSION),
                t.INTERNAL.registerComponent(
                    new j(
                        'database',
                        function(e, t) {
                            return (
                                (t = t.instanceIdentifier),
                                Ws(
                                    e.getProvider('app').getImmediate(),
                                    e.getProvider('auth-internal'),
                                    t,
                                    void 0
                                )
                            );
                        },
                        'PUBLIC'
                    )
                        .setServiceProps({
                            Reference: Ls,
                            Query: vt,
                            Database: Qs,
                            DataSnapshot: gs,
                            enableLogging: se,
                            INTERNAL: Xt,
                            ServerValue: _t,
                            TEST_ACCESS: Z,
                        })
                        .setMultipleInstances(!0)
                ),
                t.registerVersion('@firebase/database', '0.9.7');
        }.apply(this, arguments));
    } catch (e) {
        throw (console.error(e),
        new Error(
            'Cannot instantiate firebase-database.js - be sure to load firebase-app.js first.'
        ));
    }
});
